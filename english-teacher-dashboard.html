<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>English Teacher Dashboard - Professional Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
            --border-color: #e5e7eb;
            --text-primary: #111827;
            --text-secondary: #6b7280;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: var(--text-primary);
        }

        /* Header */
        .teacher-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .header-title h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .header-title p {
            font-size: 0.9rem;
            opacity: 0.9;
            margin: 0;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-assistant-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            backdrop-filter: blur(10px);
        }

        .header-assistant-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .header-assistant-btn:active {
            transform: translateY(0);
        }

        .notification-btn {
            position: relative;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 0.75rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .notification-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger-color);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-section:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .profile-info h6 {
            margin: 0;
            font-weight: 600;
        }

        .profile-info small {
            opacity: 0.8;
        }

        /* Main Content */
        .main-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .stat-icon.primary { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); }
        .stat-icon.success { background: linear-gradient(135deg, var(--success-color), #059669); }
        .stat-icon.warning { background: linear-gradient(135deg, var(--warning-color), #d97706); }
        .stat-icon.danger { background: linear-gradient(135deg, var(--danger-color), #dc2626); }

        .stat-content h3 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0;
            color: var(--text-primary);
        }

        .stat-content p {
            color: var(--text-secondary);
            margin: 0.25rem 0 0 0;
            font-size: 0.9rem;
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .trend-up { color: var(--success-color); }
        .trend-down { color: var(--danger-color); }

        /* Quick Actions */
        .quick-actions {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-title iconify-icon {
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-btn {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.75rem;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
            color: white;
        }

        .action-btn.success {
            background: linear-gradient(135deg, var(--success-color), #059669);
        }

        .action-btn.warning {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
        }

        .action-btn.danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
        }

        .action-btn.info {
            background: linear-gradient(135deg, var(--info-color), #2563eb);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
        }

        .action-btn iconify-icon {
            font-size: 2rem;
        }

        .action-btn h6 {
            margin: 0;
            font-weight: 600;
            font-size: 1rem;
        }

        .action-btn p {
            margin: 0;
            font-size: 0.8rem;
            opacity: 0.9;
        }

        /* Daily Practice Questions Styles */
        .questions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .questions-container {
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid #e9ecef;
            border-radius: 0.375rem;
            padding: 1rem;
            background-color: #f8f9fa;
            width: 100%;
        }

        /* Ensure questions display modal appears above daily practice modal */
        #questionsDisplayModal {
            z-index: 1060 !important;
        }
        
        #questionsDisplayModal .modal-backdrop {
            z-index: 1059 !important;
        }

        .question-creator.compact {
            padding: 0;
            background: transparent;
        }
        .question-creator.compact .form-label {
            font-size: 0.8rem;
            font-weight: 600;
        }
        .question-creator.compact .form-control-sm {
            max-width: 120px;
        }
        
        .question-types-compact {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .question-type-compact {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.875rem;
            padding: 0.375rem 0.75rem;
        }
        
        .question-type-compact.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .question-type-compact:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        /* Weekly Schedule Styles */
        .weekly-schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .day-schedule {
            background: #f8f9fa;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
        }

        .day-header {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-color);
        }

        .session-slot {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .session-slot:last-child {
            margin-bottom: 0;
        }
        
        .question-item {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            padding: 1.5rem;
            width: 100%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .question-item:last-child {
            margin-bottom: 0;
        }
        
        .question-item .form-control {
            width: 100%;
        }
        
        .question-item .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 0.75rem;
            background: white;
            transition: all 0.3s ease;
        }

        .question-item:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--primary-color);
        }

        .question-content {
            flex: 1;
            margin-right: 1rem;
        }

        .question-content h6 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .question-content p {
            margin-bottom: 0.75rem;
            color: var(--text-primary);
        }

        .question-meta {
            display: flex;
            gap: 0.5rem;
        }

        .question-actions {
            display: flex;
            gap: 0.5rem;
        }

        .stat-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        /* Tabs */
        .content-tabs {
            background: white;
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .tab-nav {
            display: flex;
            background: var(--light-color);
            border-bottom: 1px solid var(--border-color);
        }

        .tab-btn {
            flex: 1;
            background: none;
            border: none;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-color);
        }

        .tab-content {
            padding: 2rem;
            min-height: 500px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Assessment Cards */
        .assessments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .assessment-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
        }

        .assessment-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .assessment-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .assessment-type {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .assessment-type.quiz { background: var(--success-color); }
        .assessment-type.exam { background: var(--warning-color); }

        .assessment-menu {
            position: relative;
        }

        .menu-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .menu-btn:hover {
            background: var(--light-color);
            color: var(--text-primary);
        }

        .assessment-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .assessment-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .assessment-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .assessment-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Grading Table */
        .grading-table {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .table {
            margin: 0;
        }

        .table thead th {
            background: var(--light-color);
            border: none;
            padding: 1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .table tbody td {
            padding: 1rem;
            border-top: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .student-details h6 {
            margin: 0;
            font-weight: 600;
            color: var(--text-primary);
        }

        .student-details small {
            color: var(--text-secondary);
        }

        .grade-input {
            width: 80px;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            text-align: center;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-graded {
            background: #d1fae5;
            color: #065f46;
        }

        .status-late {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Modal Styles */
        .modal-content {
            border-radius: 16px;
            border: none;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: 16px 16px 0 0;
            padding: 1.5rem;
        }

        .modal-title {
            font-weight: 700;
            margin: 0;
        }

        .btn-close {
            filter: invert(1);
        }

        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-control {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Question Creator */
        .question-creator {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border-color);
        }

        .question-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .question-type-btn {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question-type-btn:hover {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }

        .question-type-btn.active {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }

        .question-type-btn iconify-icon {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .question-type-btn h6 {
            margin: 0;
            font-weight: 600;
        }

        .question-type-btn p {
            margin: 0.25rem 0 0 0;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 1rem;
                flex-direction: column;
                gap: 1rem;
            }

            .main-content {
                padding: 1rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .actions-grid {
                grid-template-columns: 1fr;
            }

            .tab-nav {
                flex-direction: column;
            }

            .assessments-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
            min-width: 300px;
        }

        .toast-header {
            background: var(--light-color);
            border-bottom: 1px solid var(--border-color);
            padding: 0.75rem 1rem;
            border-radius: 8px 8px 0 0;
        }

        .toast-body {
            padding: 1rem;
        }

        .toast.success .toast-header {
            background: #d1fae5;
            color: #065f46;
        }

        .toast.error .toast-header {
            background: #fee2e2;
            color: #991b1b;
        }

        .toast.warning .toast-header {
            background: #fef3c7;
            color: #92400e;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="teacher-header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <iconify-icon icon="material-symbols:menu-book"></iconify-icon>
                </div>
                <div class="header-title">
                    <h1>English Teacher Dashboard</h1>
                    <p id="teacherWelcome">Professional Assessment & Grading System</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="header-assistant-btn" onclick="openChatChoiceModal()" style="text-decoration: none; background: none; border: none; cursor: pointer;">
                    <iconify-icon icon="material-symbols:forum" style="font-size: 1.2rem;"></iconify-icon>
                    <span>English Community</span>
                </button>
                <button class="header-assistant-btn" onclick="showCourseAssistants()">
                    <iconify-icon icon="material-symbols:people" style="font-size: 1.2rem;"></iconify-icon>
                    <span>Course Assistants</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Dashboard Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-icon danger">
                    <iconify-icon icon="material-symbols:grading"></iconify-icon>
                    </div>
                    <div class="stat-trend trend-up">
                        <iconify-icon icon="material-symbols:trending-up"></iconify-icon>
                        +15%
                    </div>
                </div>
                <div class="stat-content">
                    <h3 id="pendingGrading">0</h3>
                    <p>Pending Grading</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h2 class="section-title">
                <iconify-icon icon="material-symbols:flash-on"></iconify-icon>
                Quick Actions
            </h2>
            <div class="actions-grid">
                <button class="action-btn danger" onclick="openGradingPanel()">
                    <iconify-icon icon="material-symbols:grading"></iconify-icon>
                    <h6>Grade Submissions</h6>
                    <p>Review & grade work</p>
                </button>
                <button class="action-btn info" onclick="openLiveSessionModal()">
                    <iconify-icon icon="material-symbols:video-call"></iconify-icon>
                    <h6>Start Live Session</h6>
                    <p>Create Zoom meeting</p>
                </button>
                <button class="action-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;" onclick="openPushLecturesModal()">
                    <iconify-icon icon="material-symbols:upload"></iconify-icon>
                    <h6>Push Lectures</h6>
                    <p>Upload to lecture page</p>
                </button>
                <button class="action-btn primary" onclick="openPracticeQuestionModal()">
                    <iconify-icon icon="material-symbols:edit-note"></iconify-icon>
                    <h6>Practice Questions</h6>
                    <p>Create today's questions</p>
                </button>
                <button class="action-btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;" onclick="openFlashcardsModal()">
                    <iconify-icon icon="material-symbols:style"></iconify-icon>
                    <h6>Flashcards</h6>
                    <p>Create study cards</p>
                </button>
                <button class="action-btn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;" onclick="openChatChoiceModal()">
                    <iconify-icon icon="material-symbols:forum"></iconify-icon>
                    <h6>Community Chat</h6>
                    <p>Join subject discussion</p>
                </button>
                <button class="action-btn" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;" onclick="navigateToPastPapers()">
                    <iconify-icon icon="material-symbols:description"></iconify-icon>
                    <h6>Past Papers</h6>
                    <p>View exam papers</p>
                </button>
            </div>
        </div>

        <!-- Practice Questions & Live Sessions Section -->
        <div class="row mb-5">
            <!-- Practice Questions Card -->
            <div class="col-md-6 mb-4">
                <div class="modern-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <iconify-icon icon="material-symbols:quiz" class="me-2"></iconify-icon>
                            Practice Questions
                        </h5>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-outline-primary" onclick="openPracticeQuestionModal()">
                                <iconify-icon icon="material-symbols:add" class="me-1"></iconify-icon>
                                Create
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="viewAllPracticeQuestions()">
                                <iconify-icon icon="material-symbols:visibility" class="me-1"></iconify-icon>
                                View All
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="practiceQuestionsPreview">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading practice questions...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Sessions Card -->
            <div class="col-md-6 mb-4">
                <div class="modern-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <iconify-icon icon="material-symbols:video-call" class="me-2"></iconify-icon>
                            Live Sessions
                        </h5>
                        <div class="d-flex gap-2">
                            <button class="btn btn-sm btn-primary" onclick="openLiveSessionModal()">
                                <iconify-icon icon="material-symbols:video-call" class="me-1"></iconify-icon>
                                Start Session
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="viewAllLiveSessions()">
                                <iconify-icon icon="material-symbols:visibility" class="me-1"></iconify-icon>
                                View All
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="liveSessionsPreview">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading live sessions...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <div class="content-tabs">
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('grading')">
                    <iconify-icon icon="material-symbols:grading"></iconify-icon>
                    Grading Center
                </button>
                <button class="tab-btn" onclick="switchTab('analytics')">
                    <iconify-icon icon="material-symbols:analytics"></iconify-icon>
                    Analytics
                </button>
                <button class="tab-btn" onclick="switchTab('students')">
                    <iconify-icon icon="material-symbols:groups"></iconify-icon>
                    Students
                </button>
                <button class="tab-btn" onclick="switchTab('schedule')">
                    <iconify-icon icon="material-symbols:schedule"></iconify-icon>
                    Session Schedule
                            </button>
                </div>

            <div class="tab-content">
                <!-- Grading Tab -->
                <div id="grading" class="tab-pane active">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3>Grading Center</h3>
                        <div class="d-flex gap-2">
                            <select class="form-control" style="width: auto;" onchange="filterGrading(this.value)">
                                <option value="all">All Submissions</option>
                                <option value="pending">Pending</option>
                                <option value="graded">Graded</option>
                                <option value="late">Late</option>
                            </select>
                        </div>
                    </div>
                    <div id="gradingContainer">
                        <!-- Grading content will be loaded here -->
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="analytics" class="tab-pane">
                    <h3>Analytics & Reports</h3>
                    <div class="loading">
                        <div class="spinner"></div>
                        Analytics dashboard coming soon...
                    </div>
                </div>

                <!-- Students Tab -->
                <div id="students" class="tab-pane">
                    <h3>Student Management</h3>
                    <div class="loading">
                        <div class="spinner"></div>
                        Student management coming soon...
                    </div>
                </div>

                <!-- Session Schedule Tab -->
                <div id="schedule" class="tab-pane">
                    <div class="section-header">
                        <h3>
                            <iconify-icon icon="material-symbols:schedule"></iconify-icon>
                            Session Schedule Management
                        </h3>
                        <p>Set up and manage your class session schedules</p>
                    </div>

                    <!-- Add New Session Button -->
                    <div class="mb-4">
                        <button class="btn btn-primary me-2" onclick="openSessionScheduleModal()">
                            <iconify-icon icon="material-symbols:add"></iconify-icon>
                            Add New Session
                        </button>
                        <button class="btn btn-outline-primary" onclick="openWeeklyScheduleModal()">
                            <iconify-icon icon="material-symbols:calendar-month"></iconify-icon>
                            Set Weekly Schedule
                        </button>
                    </div>

                    <!-- Schedule Overview -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-primary" id="totalSessions">0</h5>
                                    <p class="card-text">Total Sessions</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-success" id="upcomingSessions">0</h5>
                                    <p class="card-text">Upcoming</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-warning" id="todaySessions">0</h5>
                                    <p class="card-text">Today</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h5 class="card-title text-info" id="weeklySessions">0</h5>
                                    <p class="card-text">This Week</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly Overview (auto-filled after saving weekly schedule) -->
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h5 class="mb-0">Weekly Overview</h5>
                                <small id="weeklyOverviewRange" class="text-muted"></small>
                            </div>
                            <div class="row" id="weeklyOverview"></div>
                        </div>
                    </div>

                    <!-- Sessions List -->
                    <div class="sessions-list" id="sessionsList">
                        <div class="loading">
                            <div class="spinner"></div>
                            Loading sessions...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Daily Practice Questions & Assistant Section -->
        <div class="row mb-5">
            <!-- Daily Practice Questions Card -->
            <div class="col-md-6 mb-4">
                <div class="modern-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <iconify-icon icon="material-symbols:edit-note" class="me-2"></iconify-icon>
                            Daily Practice Questions
                        </h5>
                        <button class="btn btn-sm btn-primary" onclick="openDailyPracticeModal()">
                            <iconify-icon icon="material-symbols:add" class="me-1"></iconify-icon>
                            Add Question
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="dailyQuestionsPreview">
                            <div class="loading">
                                <div class="spinner"></div>
                                Loading daily questions...
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Assistant Card -->
            <div class="col-md-6 mb-4">
                <div class="modern-card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <iconify-icon icon="material-symbols:person-add" class="me-2"></iconify-icon>
                            Course Assistant
                        </h5>
                        <button class="btn btn-sm btn-success" onclick="openAddAssistantModal()">
                            <iconify-icon icon="material-symbols:person-add" class="me-1"></iconify-icon>
                            Add Assistant
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="assistantPreview">
                            <div class="text-center py-3">
                                <iconify-icon icon="material-symbols:person-add" style="font-size: 2rem; color: #6c757d;"></iconify-icon>
                                <p class="text-muted mt-2 mb-0">No assistant assigned yet</p>
                                <small class="text-muted">Click "Add Assistant" to get started</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Create Assessment Modal -->
    <div class="modal fade" id="createModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="createModalTitle">Create Assessment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createForm">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label class="form-label">Assessment Title</label>
                                    <input type="text" class="form-control" id="assessmentTitle" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Description</label>
                                    <textarea class="form-control" id="assessmentDescription" rows="3"></textarea>
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Total Points</label>
                                            <input type="number" class="form-control" id="totalPoints" min="1" value="100">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Time Limit (minutes)</label>
                                            <input type="number" class="form-control" id="timeLimit" placeholder="Optional">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="mb-3">
                                            <label class="form-label">Number of Questions</label>
                                            <div class="input-group">
                                                <input type="number" class="form-control" id="numberOfQuestions" min="1" max="50" value="5" placeholder="Auto-generate questions">
                                                <div class="input-group-text">
                                                    <input type="checkbox" class="form-check-input" id="autoGenerateQuestions" checked>
                                                    <label class="form-check-label ms-2" for="autoGenerateQuestions">Auto-generate</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Due Date</label>
                                            <input type="datetime-local" class="form-control" id="dueDate" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Difficulty</label>
                                            <select class="form-control" id="difficulty">
                                                <option value="easy">Easy</option>
                                                <option value="medium" selected>Medium</option>
                                                <option value="hard">Hard</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="question-creator">
                                    <h6 class="mb-3">Question Types</h6>
                                    <div class="question-types">
                                        <div class="question-type-btn active" data-type="multiple-select" onclick="selectQuestionType('multiple-select')">
                                            <iconify-icon icon="material-symbols:check-box"></iconify-icon>
                                            <h6>Multiple Select</h6>
                                            <p>Multiple answers</p>
                                        </div>
                                        <div class="question-type-btn" data-type="short-answer" onclick="selectQuestionType('short-answer')">
                                            <iconify-icon icon="material-symbols:short-text"></iconify-icon>
                                            <h6>Short Answer</h6>
                                            <p>Text response</p>
                                        </div>
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button type="button" class="btn btn-primary flex-fill" onclick="addQuestion()">
                                            <iconify-icon icon="material-symbols:add"></iconify-icon>
                                            Add Question
                                        </button>
                                        <button type="button" class="btn btn-success flex-fill" onclick="generateQuestions()">
                                            <iconify-icon icon="material-symbols:auto-awesome"></iconify-icon>
                                            Generate
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="questionsContainer" class="mt-4">
                            <!-- Questions will be added here -->
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveAssessment()">
                        <iconify-icon icon="material-symbols:save"></iconify-icon>
                        Save Draft
                    </button>
                    <button type="button" class="btn btn-success" id="publishBtn">
                        <iconify-icon icon="material-symbols:publish"></iconify-icon>
                        Publish to Course
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Grading Modal -->
    <div class="modal fade" id="gradingModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="gradingModalTitle">Grade Submission</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="gradingModalBody">
                    <!-- Grading content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" onclick="saveGrade()">
                        <iconify-icon icon="material-symbols:save"></iconify-icon>
                        Save Grade
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Daily Practice Questions Modal -->
    <div class="modal fade" id="dailyPracticeModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <iconify-icon icon="material-symbols:quiz" style="margin-right: 0.5rem;"></iconify-icon>
                        Daily Practice Questions
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="dailyPracticeForm">
                        <!-- Question Type Selection (Compact) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold mb-2">Question Type</label>
                            <div class="question-types-compact">
                                <button type="button" class="btn btn-outline-primary btn-sm question-type-compact active" data-type="multiple-choice" onclick="selectDailyPracticeQuestionType('multiple-choice')">
                                    <iconify-icon icon="material-symbols:check-box"></iconify-icon>
                                    Multiple Choice
                                            </button>
                                <button type="button" class="btn btn-outline-primary btn-sm question-type-compact" data-type="short-answer" onclick="selectDailyPracticeQuestionType('short-answer')">
                                    <iconify-icon icon="material-symbols:short-text"></iconify-icon>
                                    Short Answer
                                            </button>
                                <button type="button" class="btn btn-outline-primary btn-sm question-type-compact" data-type="file-based" onclick="selectDailyPracticeQuestionType('file-based')">
                                    <iconify-icon icon="material-symbols:upload-file"></iconify-icon>
                                    File-Based
                                            </button>
                                                    </div>
                                            </div>
                                    
                        <!-- Question Creator (Compact) -->
                        <div class="question-creator compact d-flex align-items-end gap-2 mb-3">
                            <div>
                                <label class="form-label mb-1 small">Questions</label>
                                <input type="number" class="form-control form-control-sm" id="questionCountInput" min="1" max="50" value="1" placeholder="Count">
                                        </div>
                            <button type="button" class="btn btn-sm btn-primary" onclick="addDailyPracticeQuestions()">
                                <iconify-icon icon="material-symbols:add"></iconify-icon>
                                Add
                                        </button>
                                                    </div>
                                    
                        <!-- Questions Container -->
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0">Created Questions</h6>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-sm btn-success" onclick="saveCurrentlyCreatingQuestions()" title="Save current questions">
                                        <iconify-icon icon="material-symbols:save"></iconify-icon>
                                        Save Questions
                                    </button>
                                    <div class="btn-group" role="group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="showAllQuestions()">
                                            All Questions
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-success" onclick="showQuestionsByDifficulty('Easy')">
                                            Easy
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-warning" onclick="showQuestionsByDifficulty('Medium')">
                                            Medium
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="showQuestionsByDifficulty('Hard')">
                                            Hard
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div id="dailyPracticeQuestionsContainer" class="questions-container" style="display: block;">
                                <!-- Questions will be added here -->
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <div class="d-flex justify-content-between w-100">
                        <button type="button" class="btn btn-outline-danger" onclick="clearAllDailyPracticeQuestions()" id="clearAllBtn" style="display: none;">
                            <iconify-icon icon="material-symbols:delete-forever"></iconify-icon>
                            Delete All Questions
                                            </button>
                        <div>
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="saveDailyPracticeQuestions()">
                                <iconify-icon icon="material-symbols:save"></iconify-icon>
                                Save Questions
                            </button>
                            <button type="button" class="btn btn-success" onclick="publishDailyPracticeQuestions()">
                                <iconify-icon icon="material-symbols:publish"></iconify-icon>
                                Publish to Course
                            </button>
                        </div>
                    </div>
                </div>
            </div>
                                        </div>
                                    </div>
                                    
    <!-- Practice Questions Modal -->
    <div class="modal fade" id="practiceQuestionModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <iconify-icon icon="material-symbols:quiz" style="margin-right: 0.5rem;"></iconify-icon>
                        Practice Questions
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="practiceQuestionForm">
                        <!-- Question Type Selection -->
                        <div class="mb-4">
                            <label class="form-label fw-bold mb-3">Question Type</label>
                            <div class="question-types">
                                <button type="button" class="btn btn-outline-primary question-type active" data-type="multiple-choice" onclick="selectPracticeQuestionType('multiple-choice')">
                                    <iconify-icon icon="material-symbols:check-box"></iconify-icon>
                                    Multiple Choice
                                </button>
                                <button type="button" class="btn btn-outline-primary question-type" data-type="short-answer" onclick="selectPracticeQuestionType('short-answer')">
                                    <iconify-icon icon="material-symbols:short-text"></iconify-icon>
                                    Short Answer
                                </button>
                                <button type="button" class="btn btn-outline-primary question-type" data-type="file-based" onclick="selectPracticeQuestionType('file-based')">
                                    <iconify-icon icon="material-symbols:upload-file"></iconify-icon>
                                    File-Based
                                </button>
                                <button type="button" class="btn btn-outline-primary question-type" data-type="bullet-points" onclick="selectPracticeQuestionType('bullet-points')">
                                    <iconify-icon icon="material-symbols:format-list-bulleted"></iconify-icon>
                                    Bullet Points
                                </button>
                            </div>
                        </div>

                        <!-- Question Creator -->
                        <div class="question-creator mb-4">
                            <div class="d-flex align-items-end gap-3 mb-3">
                                <div class="flex-grow-1">
                                    <label class="form-label fw-bold">Question Content</label>
                                    <textarea class="form-control" id="practiceQuestionText" rows="3" placeholder="Enter your question here..."></textarea>
                                </div>
                                <div>
                                    <label class="form-label fw-bold">Points</label>
                                    <input type="number" class="form-control" id="practiceQuestionPoints" value="10" min="1" max="100">
                                </div>
                                <div>
                                    <label class="form-label fw-bold">Difficulty</label>
                                    <select class="form-control" id="practiceQuestionDifficulty">
                                        <option value="Easy">Easy</option>
                                        <option value="Medium" selected>Medium</option>
                                        <option value="Hard">Hard</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="form-label fw-bold">Topic</label>
                                    <input type="text" class="form-control" id="practiceQuestionTopic" placeholder="Topic">
                                </div>
                            </div>

                            <!-- Answer Options (Dynamic based on type) -->
                            <div id="practiceAnswerOptions">
                                <!-- Multiple Choice Options -->
                                <div id="practiceMultipleChoiceOptions" class="answer-options">
                                    <label class="form-label fw-bold">Answer Options</label>
                                    <div id="practiceMultipleChoiceList">
                                        <div class="d-flex align-items-center mb-2">
                                            <input type="text" class="form-control me-2" placeholder="Option A">
                                            <input type="radio" name="practiceCorrectAnswer" value="A" class="me-2">
                                            <label class="form-label mb-0">Correct</label>
                                        </div>
                                        <div class="d-flex align-items-center mb-2">
                                            <input type="text" class="form-control me-2" placeholder="Option B">
                                            <input type="radio" name="practiceCorrectAnswer" value="B" class="me-2">
                                            <label class="form-label mb-0">Correct</label>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addPracticeOption()">
                                        <iconify-icon icon="material-symbols:add"></iconify-icon>
                                        Add Option
                                    </button>
                                </div>

                                <!-- Short Answer Options -->
                                <div id="practiceShortAnswerOptions" class="answer-options" style="display: none;">
                                    <label class="form-label fw-bold">Expected Answer</label>
                                    <input type="text" class="form-control" id="practiceExpectedAnswer" placeholder="Enter expected answer">
                                </div>

                                <!-- File-Based Options -->
                                <div id="practiceFileBasedOptions" class="answer-options" style="display: none;">
                                    <label class="form-label fw-bold">File Upload Settings</label>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <label class="form-label">Allowed File Types</label>
                                            <select class="form-control" id="practiceAllowedFileTypes" multiple>
                                                <option value="jpg">JPG</option>
                                                <option value="png">PNG</option>
                                                <option value="pdf">PDF</option>
                                                <option value="doc">DOC</option>
                                                <option value="docx">DOCX</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label">Max File Size (MB)</label>
                                            <input type="number" class="form-control" id="practiceMaxFileSize" value="5" min="1" max="50">
                                        </div>
                                    </div>
                                </div>

                                <!-- Bullet Points Options -->
                                <div id="practiceBulletPointsOptions" class="answer-options" style="display: none;">
                                    <label class="form-label fw-bold">Expected Bullet Points</label>
                                    <div id="practiceBulletPointsList">
                                        <div class="d-flex align-items-center mb-2">
                                            <input type="text" class="form-control me-2" placeholder="Bullet point 1">
                                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removePracticeBulletPoint(this)">
                                                <iconify-icon icon="material-symbols:close"></iconify-icon>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="addPracticeBulletPoint()">
                                        <iconify-icon icon="material-symbols:add"></iconify-icon>
                                        Add Bullet Point
                                    </button>
                                </div>
                            </div>

                            <!-- Time Limit -->
                            <div class="row mt-3">
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Time Limit (minutes)</label>
                                    <input type="number" class="form-control" id="practiceTimeLimit" placeholder="Optional" min="1" max="120">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label fw-bold">Explanation</label>
                                    <textarea class="form-control" id="practiceQuestionExplanation" rows="2" placeholder="Optional explanation for the answer"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Questions List -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <h6 class="mb-0">Created Questions</h6>
                                <div class="d-flex gap-2">
                                    <button type="button" class="btn btn-sm btn-success" onclick="savePracticeQuestion()">
                                        <iconify-icon icon="material-symbols:save"></iconify-icon>
                                        Save Question
                                    </button>
                                    <button type="button" class="btn btn-sm btn-primary" onclick="addPracticeQuestion()">
                                        <iconify-icon icon="material-symbols:add"></iconify-icon>
                                        Add Another
                                    </button>
                                </div>
                            </div>
                            <div id="practiceQuestionsList" class="questions-list">
                                <!-- Questions will be added here -->
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="saveAllPracticeQuestions()">
                        <iconify-icon icon="material-symbols:save"></iconify-icon>
                        Save All Questions
                    </button>
                </div>
            </div>
        </div>
    </div>
                                    
    <!-- Start Live Session Modal -->
    <div class="modal fade" id="liveSessionModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <iconify-icon icon="material-symbols:video-call" style="margin-right: 0.5rem;"></iconify-icon>
                        Start Live Session
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="liveSessionForm">
                        <div class="mb-3">
                            <label class="form-label">Session Title</label>
                            <input type="text" class="form-control" id="sessionTitle" placeholder="e.g., English Literature - Poetry Analysis" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Topic</label>
                            <input type="text" class="form-control" id="sessionTopic" placeholder="e.g., Literature, Grammar, Writing" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Description</label>
                            <textarea class="form-control" id="sessionDescription" rows="3" placeholder="Brief description of what will be covered in this session"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Duration (minutes)</label>
                                    <select class="form-control" id="sessionDuration" required>
                                        <option value="30">30 minutes</option>
                                        <option value="45">45 minutes</option>
                                        <option value="60" selected>60 minutes</option>
                                        <option value="90">90 minutes</option>
                                        <option value="120">120 minutes</option>
                                    </select>
                                                    </div>
                                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Max Participants</label>
                                    <input type="number" class="form-control" id="maxParticipants" value="50" min="1" max="100">
                                        </div>
                                                    </div>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="recordSession">
                                <label class="form-check-label" for="recordSession">
                                    Record this session
                                                </label>
                                            </div>
                                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="createLiveSession()">
                        <iconify-icon icon="material-symbols:video-call"></iconify-icon>
                        Start Live Session
                    </button>
                                            </div>
                                        </div>
    </div>
</div>

<!-- Questions Display Modal -->
<div class="modal fade" id="questionsDisplayModal" tabindex="-1" style="z-index: 1060;">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="questionsModalTitle">
                    <iconify-icon icon="material-symbols:quiz" style="margin-right: 0.5rem;"></iconify-icon>
                    Questions
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="questionsDisplayContainer">
                    <!-- Questions will be displayed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    <!-- Chat Choice Modal -->
    <div class="modal fade" id="chatChoiceModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border: none; border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 2rem;">
                    <h5 class="modal-title d-flex align-items-center">
                        <div class="me-3" style="background: rgba(255,255,255,0.2); width: 50px; height: 50px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                            <iconify-icon icon="material-symbols:forum" style="font-size: 1.8rem;"></iconify-icon>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.25rem;">Choose Chat Type</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Select how you'd like to connect</div>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" style="font-size: 1.5rem; opacity: 0.8;"></button>
                </div>
                <div class="modal-body" style="padding: 2.5rem; background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);">
                    <p class="text-center mb-4" style="font-size: 1.1rem; color: #64748b; font-weight: 500;">
                        Choose your preferred chat experience:
                    </p>
                    <div class="d-grid gap-4">
                        <a href="community-chat.html?subject=English" class="btn btn-lg text-decoration-none p-4 chat-option-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 16px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                            <div class="d-flex align-items-center">
                                <div class="me-4" style="background: rgba(255,255,255,0.2); width: 60px; height: 60px; border-radius: 20px; display: flex; align-items: center; justify-content: center;">
                                    <iconify-icon icon="material-symbols:forum" style="font-size: 2rem;"></iconify-icon>
                                </div>
                                <div class="text-start flex-grow-1">
                                    <div style="font-size: 1.3rem; font-weight: 600; margin-bottom: 0.5rem;">Community Chat</div>
                                    <div style="font-size: 0.95rem; opacity: 0.9;">Join subject discussions with students</div>
                                </div>
                                <div>
                                    <iconify-icon icon="material-symbols:arrow-forward" style="font-size: 1.5rem;"></iconify-icon>
                                </div>
                            </div>
                            <div class="chat-option-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0; transition: opacity 0.3s ease;"></div>
                        </a>
                        <a href="resources-chat.html?subject=English" class="btn btn-lg text-decoration-none p-4 chat-option-btn" style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none; border-radius: 16px; transition: all 0.3s ease; position: relative; overflow: hidden;">
                            <div class="d-flex align-items-center">
                                <div class="me-4" style="background: rgba(255,255,255,0.2); width: 60px; height: 60px; border-radius: 20px; display: flex; align-items: center; justify-content: center;">
                                    <iconify-icon icon="material-symbols:library-books" style="font-size: 2rem;"></iconify-icon>
                                </div>
                                <div class="text-start flex-grow-1">
                                    <div style="font-size: 1.3rem; font-weight: 600; margin-bottom: 0.5rem;">Resources Chat</div>
                                    <div style="font-size: 0.95rem; opacity: 0.9;">Share and access study materials</div>
                                </div>
                                <div>
                                    <iconify-icon icon="material-symbols:arrow-forward" style="font-size: 1.5rem;"></iconify-icon>
                                </div>
                            </div>
                            <div class="chat-option-overlay" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.1); opacity: 0; transition: opacity 0.3s ease;"></div>
                        </a>
                    </div>
                </div>
                <div class="modal-footer" style="background: #f8fafc; border: none; padding: 1.5rem 2.5rem;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="padding: 0.75rem 2rem; border-radius: 12px; font-weight: 500;">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Past Papers Management Modal -->
    <div class="modal fade" id="pastPapersModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none;">
                    <h5 class="modal-title d-flex align-items-center">
                        <div class="me-3" style="background: rgba(255,255,255,0.2); width: 50px; height: 50px; border-radius: 15px; display: flex; align-items: center; justify-content: center;">
                            <iconify-icon icon="material-symbols:description" style="font-size: 1.8rem;"></iconify-icon>
                        </div>
                        <div>
                            <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.25rem;">Past Papers Management</div>
                            <div style="font-size: 0.9rem; opacity: 0.9;">Upload and manage exam papers by year and category</div>
                        </div>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" style="font-size: 1.5rem; opacity: 0.8;"></button>
                </div>
                <div class="modal-body" style="padding: 2rem; background: #f8fafc;">
                    <div class="row">
                        <!-- Years Sidebar -->
                        <div class="col-md-3">
                            <div class="card" style="border: none; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                                <div class="card-header bg-white" style="border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                    <h6 class="mb-0" style="color: #1e293b; font-weight: 700;">
                                        <iconify-icon icon="material-symbols:calendar-today" style="margin-right: 0.5rem;"></iconify-icon>
                                        Select Year
                                    </h6>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush" id="yearsList">
                                        <!-- Years will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Categories and Upload Area -->
                        <div class="col-md-9">
                            <div class="card" style="border: none; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
                                <div class="card-header bg-white" style="border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                    <h6 class="mb-0" style="color: #1e293b; font-weight: 700;">
                                        <iconify-icon icon="material-symbols:folder" style="margin-right: 0.5rem;"></iconify-icon>
                                        <span id="selectedYearDisplay">Select a year</span>
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div id="categoriesContainer">
                                        <!-- Categories will be populated here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer" style="background: white; border-top: 1px solid #e2e8f0;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                        Close
                    </button>
                    <button type="button" class="btn btn-primary" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border: none;" onclick="refreshPastPapersData()">
                        <iconify-icon icon="material-symbols:refresh"></iconify-icon>
                        Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        .chat-option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .chat-option-btn:hover .chat-option-overlay {
            opacity: 1;
        }
        
        .chat-option-btn:active {
            transform: translateY(0);
        }
        
        #chatChoiceModal .modal-dialog {
            max-width: 600px;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #chatChoiceModal .modal-body .chat-option-btn {
            animation: slideIn 0.5s ease forwards;
            opacity: 0;
        }
        
        #chatChoiceModal .modal-body .chat-option-btn:nth-child(1) {
            animation-delay: 0.1s;
        }
        
        #chatChoiceModal .modal-body .chat-option-btn:nth-child(2) {
            animation-delay: 0.2s;
        }
    </style>
    
    <!-- Weekly Schedule Modal -->
    <div class="modal fade" id="weeklyScheduleModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <iconify-icon icon="material-symbols:calendar-month" style="margin-right: 0.5rem;"></iconify-icon>
                        Set Weekly Schedule
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="weeklyScheduleForm">
                        <div class="row mb-4">
                                        <div class="col-md-6">
                                <label class="form-label fw-bold">Week Starting Date</label>
                                <input type="date" class="form-control" id="weekStartDate" required>
                                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Schedule Name</label>
                                <input type="text" class="form-control" id="scheduleName" placeholder="e.g., Fall 2024 Schedule" required>
                            </div>
                        </div>

                        <div class="weekly-schedule-grid">
                            <!-- Sunday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Sunday</h6>
                                <div class="session-slots" id="sunday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="sunday-name">
                                        </div>
                                        <div class="col-md-3">
                                                <input type="time" class="form-control" name="sunday-time">
                                        </div>
                                        <div class="col-md-3">
                                                <select class="form-control" name="sunday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                            </select>
                                        </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('sunday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                </button>
                                    </div>
                                    
                            <!-- Monday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Monday</h6>
                                <div class="session-slots" id="monday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="monday-name">
                                            </div>
                                            <div class="col-md-3">
                                                <input type="time" class="form-control" name="monday-time">
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-control" name="monday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                                <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                            </button>
                                        </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('monday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                        </button>
                                    </div>
                                    
                            <!-- Tuesday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Tuesday</h6>
                                <div class="session-slots" id="tuesday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="tuesday-name">
                                    </div>
                                            <div class="col-md-3">
                                                <input type="time" class="form-control" name="tuesday-time">
                                </div>
                                            <div class="col-md-3">
                                                <select class="form-control" name="tuesday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('tuesday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                </button>
                            </div>
                            
                            <!-- Wednesday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Wednesday</h6>
                                <div class="session-slots" id="wednesday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="wednesday-name">
                                    </div>
                                            <div class="col-md-3">
                                                <input type="time" class="form-control" name="wednesday-time">
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-control" name="wednesday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                                </select>
                                        </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                                </button>
                                            </div>
                                        </div>
                                            </div>
                                        </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('wednesday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                </button>
                                            </div>

                            <!-- Thursday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Thursday</h6>
                                <div class="session-slots" id="thursday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="thursday-name">
                                        </div>
                                            <div class="col-md-3">
                                                <input type="time" class="form-control" name="thursday-time">
                                    </div>
                                            <div class="col-md-3">
                                                <select class="form-control" name="thursday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('thursday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                </button>
                                </div>
                                
                            <!-- Friday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Friday</h6>
                                <div class="session-slots" id="friday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="friday-name">
                                    </div>
                                            <div class="col-md-3">
                                                <input type="time" class="form-control" name="friday-time">
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-control" name="friday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                        </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('friday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                        </button>
                            </div>

                            <!-- Saturday -->
                            <div class="day-schedule">
                                <h6 class="day-header">Saturday</h6>
                                <div class="session-slots" id="saturday-slots">
                                    <div class="session-slot">
                                        <div class="row">
                                            <div class="col-md-4">
                                                <input type="text" class="form-control" placeholder="Session Name" name="saturday-name">
                                            </div>
                                            <div class="col-md-3">
                                                <input type="time" class="form-control" name="saturday-time">
                                            </div>
                                            <div class="col-md-3">
                                                <select class="form-control" name="saturday-type">
                                                    <option value="">Select Type</option>
                                                    <option value="lecture">Lecture</option>
                                                    <option value="practice">Practice</option>
                                                    <option value="quiz">Quiz</option>
                                                    <option value="exam">Exam</option>
                                                    <option value="review">Review</option>
                                                </select>
                                            </div>
                                            <div class="col-md-2">
                                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                                            <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                        </button>
                                    </div>
                                </div>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="addSessionSlot('saturday-slots')">
                                    <iconify-icon icon="material-symbols:add"></iconify-icon>
                                    Add Session
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveWeeklySchedule()">
                        <iconify-icon icon="material-symbols:save"></iconify-icon>
                        Save Weekly Schedule
                            </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentAssessmentType = 'assignment';
        let currentQuestionType = 'multiple-choice';
        let questionCounter = 0;
        let assessments = [];
        let submissions = [];
        let englishQuizzes = [];
        let englishAssignments = [];
        let englishExams = [];
        
        // Daily Practice variables
        let currentDailyPracticeQuestionType = 'multiple-choice';
        let dailyPracticeQuestionCounter = 0;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Authentication guard
            const userLoggedIn = localStorage.getItem('userLoggedIn');
            const userRole = localStorage.getItem('userRole');
            const teacherSubject = localStorage.getItem('teacherSubject');
            
            // Check if user is logged in and is a teacher
            if (!userLoggedIn || userRole !== 'teacher') {
                alert('Access denied. Please login as a teacher.');
                window.location.href = 'backend/public/index.html';
                return;
            }
            
            // Check if teacher's subject matches this dashboard
            if (teacherSubject && teacherSubject.toLowerCase() !== 'english') {
                alert('Access denied. This dashboard is for English teachers only.');
                window.location.href = 'backend/public/index.html';
                return;
            }
            
            // Load teacher name
            const teacherName = localStorage.getItem('userName');
            if (teacherName) {
                document.getElementById('teacherWelcome').textContent = `Welcome, ${teacherName}!`;
                // Update profile section
                const profileNameEl = document.getElementById('profileTeacherName');
                const profileRoleEl = document.getElementById('profileTeacherRole');
                if (profileNameEl) profileNameEl.textContent = teacherName;
                if (profileRoleEl && teacherSubject) profileRoleEl.textContent = `${teacherSubject} Teacher`;
            }
            }
            
            loadEnglishData();
            loadAssessments();
            updateStats();
            loadDailyQuestions();
            loadPracticeQuestions();
            loadLiveSessions();
            
            // Add event listener for publish button
            document.getElementById('publishBtn').addEventListener('click', function() {
                console.log('Publish button clicked via event listener!');
                publishAssessment();
            });
        });

        // Refresh data when page becomes visible (user navigates back)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadEnglishData();
                loadAssessments();
                updateStats();
            }
        });

        // Load English data from course pages - will be loaded from backend or localStorage
        function loadEnglishData() {
            // Load English assignments from localStorage
            const assignmentsData = localStorage.getItem('englishAssignments');
            englishAssignments = assignmentsData ? JSON.parse(assignmentsData) : [];
            
            // Load English quizzes from localStorage
            const quizzesData = localStorage.getItem('englishQuizzes');
            englishQuizzes = quizzesData ? JSON.parse(quizzesData) : [];
            
            // Load English exams from localStorage
            const examsData = localStorage.getItem('englishExams');
            englishExams = examsData ? JSON.parse(examsData) : [];
            
            console.log('Loaded English data:', {
                assignments: englishAssignments.length,
                quizzes: englishQuizzes.length,
                exams: englishExams.length
            });
        }

        // Tab switching
        function switchTab(tabName) {
            // Remove active class from all tabs and panes
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            // Add active class to selected tab and pane
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Load content based on tab
            if (tabName === 'grading') {
                loadGradingContent();
            }
        }

        // Open create modal
        function openCreateModal(type) {
            currentAssessmentType = type;
            const modal = new bootstrap.Modal(document.getElementById('createModal'));
            const title = document.getElementById('createModalTitle');
            
            switch(type) {
                case 'assignment':
                    title.textContent = 'Create English Assignment';
                    break;
                case 'quiz':
                    title.textContent = 'Create English Quiz';
                    break;
                case 'exam':
                    title.textContent = 'Create English Exam';
                    break;
            }
            
            // Reset form
            document.getElementById('createForm').reset();
            document.getElementById('questionsContainer').innerHTML = '';
            questionCounter = 0;
            
            modal.show();
        }

        // Question type selection
        function selectQuestionType(type) {
            currentQuestionType = type;
            document.querySelectorAll('.question-type-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.question-type-btn').classList.add('active');
        }

        // Add question
        function addQuestion() {
            questionCounter++;
            const container = document.getElementById('questionsContainer');
            
            const questionHtml = `
                <div class="question-item mb-4 p-3 border rounded" id="question-${questionCounter}">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6>Question ${questionCounter}</h6>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeQuestion(${questionCounter})">
                            <iconify-icon icon="material-symbols:delete"></iconify-icon>
                        </button>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Question Text</label>
                        <textarea class="form-control" name="questionText" rows="3" placeholder="Enter your question..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Points</label>
                        <input type="number" class="form-control" name="questionPoints" min="1" value="10">
                    </div>
                    <div id="questionOptions-${questionCounter}">
                        ${generateQuestionOptions(currentQuestionType, questionCounter)}
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', questionHtml);
        }

        // Generate question options based on type
        function generateQuestionOptions(type, questionId, options = []) {
            switch(type) {
                case 'multiple-choice':
                case 'multiple-select':
                    const optionHtml = options.length > 0 ? 
                        options.map((option, index) => `
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" placeholder="Option ${index + 1}" value="${option}">
                                <div class="input-group-text">
                                    <input type="radio" name="correct-${questionId}" value="${index}">
                                </div>
                            </div>
                        `).join('') :
                        `
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" placeholder="Option 1">
                                <div class="input-group-text">
                                    <input type="radio" name="correct-${questionId}" value="0">
                                </div>
                            </div>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" placeholder="Option 2">
                                <div class="input-group-text">
                                    <input type="radio" name="correct-${questionId}" value="1">
                                </div>
                            </div>
                        `;
                    
                    return `
                        <div class="mb-3">
                            <label class="form-label">Options</label>
                            <div id="options-${questionId}">
                                ${optionHtml}
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addOption(${questionId})">
                                <iconify-icon icon="material-symbols:add"></iconify-icon>
                                Add Option
                            </button>
                        </div>
                    `;
                case 'true-false':
                    return `
                        <div class="mb-3">
                            <label class="form-label">Correct Answer</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="correct-${questionId}" value="true">
                                <label class="form-check-label">True</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="correct-${questionId}" value="false">
                                <label class="form-check-label">False</label>
                            </div>
                        </div>
                    `;
                case 'short-answer':
                case 'essay':
                    return `
                        <div class="mb-3">
                            <label class="form-label">Sample Answer (Optional)</label>
                            <textarea class="form-control" name="sampleAnswer" rows="2" placeholder="Provide a sample answer for reference..."></textarea>
                        </div>
                    `;
                case 'file-upload':
                case 'file-based':
                    return `
                        <div class="mb-3">
                            <label class="form-label">Upload Question File (Optional)</label>
                            <div class="file-upload-area" onclick="document.getElementById('questionFile_${questionId}').click()" 
                                 style="border: 2px dashed #667eea; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer; background: #f8f9ff;">
                                <iconify-icon icon="material-symbols:cloud-upload" style="font-size: 2rem; color: #667eea;"></iconify-icon>
                                <div style="margin-top: 0.5rem; color: #667eea;">Click to upload question file (PDF, Image, etc.)</div>
                                <div id="questionFileDisplay_${questionId}" style="margin-top: 0.5rem; font-size: 0.9rem; color: #28a745;"></div>
                            </div>
                            <input type="file" id="questionFile_${questionId}" style="display: none;" 
                                   accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" 
                                   onchange="handleQuestionFileUpload('${questionId}', this)">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Allowed Answer File Types</label>
                            <select class="form-control" name="allowedTypes" multiple>
                                <option value="pdf" selected>PDF</option>
                                <option value="doc" selected>DOC</option>
                                <option value="docx" selected>DOCX</option>
                                <option value="jpg" selected>JPG</option>
                                <option value="png" selected>PNG</option>
                                <option value="txt">TXT</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max File Size (MB)</label>
                            <input type="number" class="form-control" name="maxFileSize" value="10" min="1">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Answer Type</label>
                            <select class="form-control" name="answerType" onchange="toggleAnswerOptions('${questionId}')">
                                <option value="file-upload">File Upload Only</option>
                                <option value="file-with-multiple-choice">File Upload + Multiple Choice</option>
                                <option value="multiple-choice-only">Multiple Choice Only</option>
                            </select>
                        </div>
                        <div class="mb-3" id="multipleChoiceOptions_${questionId}" style="display: none;">
                            <label class="form-label">Multiple Choice Options (for file assessment)</label>
                            <div id="fileAnswerOptions_${questionId}">
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" placeholder="Option 1" name="fileAnswerOption">
                                    <div class="input-group-text">
                                        <input type="radio" name="correctFileAnswer_${questionId}" value="0">
                                    </div>
                                    <button type="button" class="btn btn-outline-danger" onclick="removeFileAnswerOption(this)">
                                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                                    </button>
                                </div>
                                <div class="input-group mb-2">
                                    <input type="text" class="form-control" placeholder="Option 2" name="fileAnswerOption">
                                    <div class="input-group-text">
                                        <input type="radio" name="correctFileAnswer_${questionId}" value="1">
                                    </div>
                                    <button type="button" class="btn btn-outline-danger" onclick="removeFileAnswerOption(this)">
                                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                                    </button>
                                </div>
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addFileAnswerOption('${questionId}')">
                                <iconify-icon icon="material-symbols:add"></iconify-icon> Add Option
                            </button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Instructions for Students</label>
                            <textarea class="form-control" name="fileInstructions" rows="3" placeholder="Provide specific instructions for file submission and/or multiple choice answers..."></textarea>
                        </div>
                    `;
                default:
                    return '';
            }
        }

        // Add option to multiple choice questions
        function addOption(questionId) {
            const container = document.getElementById(`options-${questionId}`);
            const optionCount = container.children.length;
            
            const optionHtml = `
                <div class="input-group mb-2">
                    <input type="text" class="form-control" placeholder="Option ${optionCount + 1}">
                    <div class="input-group-text">
                        <input type="radio" name="correct-${questionId}" value="${optionCount}">
                    </div>
                    <button type="button" class="btn btn-outline-danger" onclick="removeOption(this)">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                    </button>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', optionHtml);
        }

        // Remove option
        function removeOption(button) {
            button.closest('.input-group').remove();
        }

        // Handle question file upload
        function handleQuestionFileUpload(questionId, input) {
            const file = input.files[0];
            if (file) {
                const display = document.getElementById(`questionFileDisplay_${questionId}`);
                display.innerHTML = `
                    <strong>Uploaded:</strong> ${file.name} (${formatFileSize(file.size)})
                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removeQuestionFile('${questionId}')">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                    </button>
                `;
                
                // Store file data for later use
                const fileData = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    data: file // Store the actual file object
                };
                
                // Store in a temporary storage for this question
                if (!window.questionFiles) window.questionFiles = {};
                window.questionFiles[elementId] = fileData;
            }
        }

        // Remove question file
        function removeQuestionFile(questionId) {
            const input = document.getElementById(`questionFile_${questionId}`);
            const display = document.getElementById(`questionFileDisplay_${questionId}`);
            
            input.value = '';
            display.innerHTML = '';
            
            if (window.questionFiles) {
                delete window.questionFiles[elementId];
            }
        }

        // Toggle answer options for file assessments
        function toggleAnswerOptions(questionId) {
            const answerType = document.querySelector(`select[name="answerType"]`).value;
            const multipleChoiceDiv = document.getElementById(`multipleChoiceOptions_${questionId}`);
            
            if (answerType === 'file-with-multiple-choice' || answerType === 'multiple-choice-only') {
                multipleChoiceDiv.style.display = 'block';
            } else {
                multipleChoiceDiv.style.display = 'none';
            }
        }

        // Add file answer option
        function addFileAnswerOption(questionId) {
            const container = document.getElementById(`fileAnswerOptions_${questionId}`);
            const optionCount = container.children.length;
            
            const optionHtml = `
                <div class="input-group mb-2">
                    <input type="text" class="form-control" placeholder="Option ${optionCount + 1}" name="fileAnswerOption">
                    <div class="input-group-text">
                        <input type="radio" name="correctFileAnswer_${questionId}" value="${optionCount}">
                    </div>
                    <button type="button" class="btn btn-outline-danger" onclick="removeFileAnswerOption(this)">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                    </button>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', optionHtml);
        }

        // Remove file answer option
        function removeFileAnswerOption(button) {
            const container = button.closest('.input-group').parentElement;
            if (container.children.length > 2) {
                button.closest('.input-group').remove();
            } else {
                showToast('At least 2 options are required', 'warning');
            }
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Generate questions automatically
        function generateQuestions() {
            const numberOfQuestions = parseInt(document.getElementById('numberOfQuestions').value) || 5;
            const autoGenerate = document.getElementById('autoGenerateQuestions').checked;
            
            if (!autoGenerate) {
                showToast('Please enable auto-generation checkbox first!', 'warning');
                return;
            }
            
            // Clear existing questions
            document.getElementById('questionsContainer').innerHTML = '';
            questionCounter = 0;
            
            // Generate questions based on assessment type and subject
            const assessmentType = currentAssessmentType;
            const subject = 'english';
            
            for (let i = 1; i <= numberOfQuestions; i++) {
                questionCounter++;
                const container = document.getElementById('questionsContainer');
                
                // Generate question content based on type and subject
                const questionContent = generateQuestionContent(assessmentType, subject, i);
                
                const questionHtml = `
                    <div class="question-item mb-4 p-3 border rounded" id="question-${questionCounter}">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6>Question ${questionCounter}</h6>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeQuestion(${questionCounter})">
                                <iconify-icon icon="material-symbols:delete"></iconify-icon>
                            </button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Question Text</label>
                            <textarea class="form-control" name="questionText" rows="3" placeholder="Enter your question...">${questionContent.text}</textarea>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Points</label>
                            <input type="number" class="form-control" name="questionPoints" min="1" value="${questionContent.points}">
                        </div>
                        <div id="questionOptions-${questionCounter}">
                            ${generateQuestionOptions(questionContent.type, questionCounter, questionContent.options)}
                        </div>
                    </div>
                `;
                
                container.insertAdjacentHTML('beforeend', questionHtml);
            }
            
            showToast(`Generated ${numberOfQuestions} questions automatically!`, 'success');
        }
        
        // Generate question content based on assessment type and subject
        function generateQuestionContent(assessmentType, subject, questionNumber) {
            const questionTemplates = {
                english: {
                    assignment: [
                        {
                            text: "Write a 200-word essay on the importance of education in modern society.",
                            type: "short-answer",
                            points: 15,
                            options: []
                        },
                        {
                            text: "Which of the following is a compound sentence?",
                            type: "multiple-choice",
                            points: 8,
                            options: ["The cat sat on the mat.", "The cat sat on the mat, and the dog slept nearby.", "Cats are independent animals.", "The mat was soft."]
                        },
                        {
                            text: "Identify the main theme in Shakespeare's 'Romeo and Juliet'.",
                            type: "short-answer",
                            points: 12,
                            options: []
                        },
                        {
                            text: "What is the correct plural form of 'child'?",
                            type: "multiple-choice",
                            points: 5,
                            options: ["childs", "children", "childes", "childrens"]
                        },
                        {
                            text: "A metaphor directly compares two things using 'like' or 'as'.",
                            type: "true-false",
                            points: 6,
                            options: []
                        }
                    ],
                    quiz: [
                        {
                            text: "What is the past tense of 'go'?",
                            type: "multiple-choice",
                            points: 4,
                            options: ["goed", "went", "gone", "going"]
                        },
                        {
                            text: "A noun is a word that describes an action.",
                            type: "true-false",
                            points: 3,
                            options: []
                        },
                        {
                            text: "Write a sentence using the word 'serendipity' correctly.",
                            type: "short-answer",
                            points: 8,
                            options: []
                        },
                        {
                            text: "Which literary device is used in 'The stars danced playfully in the moonlit sky'?",
                            type: "multiple-choice",
                            points: 6,
                            options: ["Simile", "Metaphor", "Personification", "Alliteration"]
                        },
                        {
                            text: "The word 'beautiful' is an adjective.",
                            type: "true-false",
                            points: 4,
                            options: []
                        }
                    ],
                    exam: [
                        {
                            text: "Analyze the use of symbolism in George Orwell's 'Animal Farm' and explain how it contributes to the overall theme of the novel.",
                            type: "short-answer",
                            points: 20,
                            options: []
                        },
                        {
                            text: "Compare and contrast the writing styles of Ernest Hemingway and F. Scott Fitzgerald, providing specific examples from their works.",
                            type: "short-answer",
                            points: 25,
                            options: []
                        },
                        {
                            text: "Write a critical analysis of the following poem, focusing on its themes, literary devices, and overall message.",
                            type: "short-answer",
                            points: 30,
                            options: []
                        },
                        {
                            text: "Which of the following best describes the purpose of a thesis statement in an essay?",
                            type: "multiple-choice",
                            points: 10,
                            options: ["To provide background information", "To state the main argument", "To list supporting evidence", "To conclude the essay"]
                        },
                        {
                            text: "The Oxford comma is always required in academic writing.",
                            type: "true-false",
                            points: 8,
                            options: []
                        }
                    ]
                }
            };
            
            const subjectTemplates = questionTemplates[subject] || questionTemplates.english;
            const typeTemplates = subjectTemplates[assessmentType] || subjectTemplates.assignment;
            
            // Cycle through templates or generate random content
            const templateIndex = (questionNumber - 1) % typeTemplates.length;
            return typeTemplates[templateIndex];
        }

        // Remove question
        function removeQuestion(questionId) {
            document.getElementById(`question-${questionId}`).remove();
        }

        // Save assessment
        function saveAssessment() {
            const formData = {
                id: Date.now().toString(),
                type: currentAssessmentType,
                title: document.getElementById('assessmentTitle').value,
                description: document.getElementById('assessmentDescription').value,
                totalPoints: parseInt(document.getElementById('totalPoints').value),
                timeLimit: document.getElementById('timeLimit').value ? parseInt(document.getElementById('timeLimit').value) : null,
                dueDate: document.getElementById('dueDate').value,
                difficulty: document.getElementById('difficulty').value,
                questions: collectQuestions(),
                createdAt: new Date().toISOString(),
                status: 'draft'
            };

            assessments.push(formData);
            saveToLocalStorage();
            loadAssessments();
            updateStats();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('createModal'));
            modal.hide();
            
            showToast('Assessment saved as draft!', 'success');
        }

        // Publish assessment to course page
        function publishAssessment() {
            const formData = {
                id: Date.now().toString(),
                type: currentAssessmentType,
                title: document.getElementById('assessmentTitle').value,
                description: document.getElementById('assessmentDescription').value,
                totalPoints: parseInt(document.getElementById('totalPoints').value),
                timeLimit: document.getElementById('timeLimit').value ? parseInt(document.getElementById('timeLimit').value) : null,
                dueDate: document.getElementById('dueDate').value,
                difficulty: document.getElementById('difficulty').value,
                questions: collectQuestions(),
                status: 'published',
                createdAt: new Date().toISOString(),
                subject: 'english'
            };

            // Save to assessments (for teacher dashboard)
            assessments.push(formData);
            saveToLocalStorage();

            // Publish to course page based on type
            publishToCoursePage(formData);

            loadAssessments();
            updateStats();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('createModal'));
            modal.hide();
            
            showToast('Assessment published to course page!', 'success');
        }

        // Publish assessment to the appropriate course page
        function publishToCoursePage(assessment) {
            const courseData = {
                id: assessment.id,
                title: assessment.title,
                description: assessment.description,
                points: assessment.totalPoints,
                dueDate: assessment.dueDate,
                difficulty: assessment.difficulty.charAt(0).toUpperCase() + assessment.difficulty.slice(1),
                estimatedTime: assessment.timeLimit ? `${assessment.timeLimit} minutes` : 'No time limit',
                questions: assessment.questions,
                status: 'published',
                type: assessment.type, // Add the type field
                subject: 'english', // Add the subject field for fallback compatibility
                createdAt: new Date().toISOString()
            };

            // Determine the localStorage key based on assessment type
            let storageKey;
            switch(assessment.type) {
                case 'assignment':
                    storageKey = 'englishAssignments';
                    break;
                case 'quiz':
                    storageKey = 'englishQuizzes';
                    break;
                case 'exam':
                    storageKey = 'englishExams';
                    break;
                default:
                    console.error('Unknown assessment type:', assessment.type);
                    return;
            }

            // Load existing data and add new assessment
            const existingData = JSON.parse(localStorage.getItem(storageKey)) || [];
            existingData.push(courseData);
            localStorage.setItem(storageKey, JSON.stringify(existingData));

            console.log(`Published ${assessment.type} to ${storageKey}:`, courseData);
        }

        // Collect questions from form
        function collectQuestions() {
            const questions = [];
            const questionElements = document.querySelectorAll('.question-item');
            
            questionElements.forEach((element, index) => {
                const questionTextElement = element.querySelector('[name="questionText"]');
                const questionPointsElement = element.querySelector('[name="questionPoints"]');
                
                if (!questionTextElement || !questionPointsElement) {
                    console.warn(`Question ${index + 1} is missing required fields, skipping...`);
                    return;
                }
                
                const questionData = {
                    id: `q${index + 1}`,
                    type: currentQuestionType,
                    text: questionTextElement.value,
                    points: parseInt(questionPointsElement.value) || 1,
                    options: [],
                    correctAnswer: null,
                    sampleAnswer: element.querySelector('[name="sampleAnswer"]')?.value || null
                };

                // Collect options for multiple choice questions
                if (currentQuestionType === 'multiple-choice' || currentQuestionType === 'multiple-select') {
                    const optionInputs = element.querySelectorAll('.input-group input[type="text"]');
                    optionInputs.forEach((input, optionIndex) => {
                        if (input.value.trim()) {
                            questionData.options.push(input.value.trim());
                        }
                    });
                    
                    // Find correct answer
                    const correctRadio = element.querySelector('input[type="radio"]:checked');
                    if (correctRadio) {
                        questionData.correctAnswer = parseInt(correctRadio.value);
                    }
                } else if (currentQuestionType === 'true-false') {
                    const correctRadio = element.querySelector('input[type="radio"]:checked');
                    if (correctRadio) {
                        questionData.correctAnswer = correctRadio.value;
                    }
                }

                questions.push(questionData);
            });

            return questions;
        }

        // Load assessments
        function loadAssessments() {
            const container = document.getElementById('assessmentsContainer');
            if (!container) return; // Guard when assessments section is removed
            
            // Combine all English assessments
            const allAssessments = [
                ...englishAssignments.map(a => ({...a, type: 'assignment'})),
                ...englishQuizzes.map(q => ({...q, type: 'quiz'})),
                ...englishExams.map(e => ({...e, type: 'exam'}))
            ];
            
            if (allAssessments.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <iconify-icon icon="material-symbols:folder-open" style="font-size: 4rem; color: #ccc;"></iconify-icon>
                        <h4 class="mt-3 text-muted">No assessments yet</h4>
                        <p class="text-muted">Create your first assessment to get started</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = allAssessments.map(assessment => `
                <div class="assessment-card">
                    <div class="assessment-header">
                        <span class="assessment-type ${assessment.type}">${assessment.type.charAt(0).toUpperCase() + assessment.type.slice(1)}</span>
                        <div class="assessment-menu">
                            <button class="menu-btn" onclick="showAssessmentMenu('${assessment.id}')">
                                <iconify-icon icon="material-symbols:more-vert"></iconify-icon>
                            </button>
                        </div>
                    </div>
                    <div class="assessment-title">${assessment.title}</div>
                    <div class="assessment-meta">
                        <div class="meta-item">
                            <iconify-icon icon="material-symbols:schedule"></iconify-icon>
                            <span>${assessment.dueDate ? new Date(assessment.dueDate).toLocaleDateString() : 
                                   assessment.date ? new Date(assessment.date).toLocaleDateString() : 'No date'}</span>
                        </div>
                        <div class="meta-item">
                            <iconify-icon icon="material-symbols:star"></iconify-icon>
                            <span>${assessment.difficulty}</span>
                        </div>
                        <div class="meta-item">
                            <iconify-icon icon="material-symbols:quiz"></iconify-icon>
                            <span>${assessment.questions ? assessment.questions.length : 0} questions</span>
                        </div>
                    </div>
                    <div class="assessment-stats">
                        <div class="stat-item">
                            <div class="stat-value">${assessment.points || assessment.maxScore || 0}</div>
                            <div class="stat-label">Points</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${getSubmissionCount(assessment.id)}</div>
                            <div class="stat-label">Submissions</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${assessment.status}</div>
                            <div class="stat-label">Status</div>
                        </div>
                    </div>
                    <div class="assessment-actions">
                        <button class="btn-sm btn-primary" onclick="editAssessment('${assessment.id}')">
                            <iconify-icon icon="material-symbols:edit"></iconify-icon>
                            Edit
                        </button>
                        <button class="btn-sm btn-outline" onclick="viewSubmissions('${assessment.id}')">
                            <iconify-icon icon="material-symbols:visibility"></iconify-icon>
                            View
                        </button>
                        <a href="${getEnglishPageUrl(assessment.type)}" class="btn-sm btn-success">
                            <iconify-icon icon="material-symbols:open-in-new"></iconify-icon>
                            Open in Course
                        </a>
                    </div>
                </div>
            `).join('');
        }

        // Load grading content
        function loadGradingContent() {
            const container = document.getElementById('gradingContainer');
            const stored = localStorage.getItem('englishSubmissions');
            submissions = stored ? JSON.parse(stored) : getSampleSubmissions();
            
            if (submissions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <iconify-icon icon="material-symbols:grading" style="font-size: 4rem; color: #ccc;"></iconify-icon>
                        <h4 class="mt-3 text-muted">No submissions to grade</h4>
                        <p class="text-muted">Student submissions will appear here when they submit their work</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="grading-table">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Student</th>
                                <th>Assessment</th>
                                <th>Submitted</th>
                                <th>Status</th>
                                <th>Grade</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${submissions.map(submission => `
                                <tr>
                                    <td>
                                        <div class="student-info">
                                            <div class="student-avatar">
                                                ${submission.student.name.charAt(0)}
                                            </div>
                                            <div class="student-details">
                                                <h6>${submission.student.name}</h6>
                                                <small>${submission.student.email}</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>${submission.assessmentTitle}</td>
                                    <td>${new Date(submission.submittedAt).toLocaleDateString()}</td>
                                    <td>
                                        <span class="status-badge status-${submission.status}">
                                            ${submission.status}
                                        </span>
                                    </td>
                                    <td>
                                        ${submission.grade ? `${submission.grade}/${submission.maxGrade}` : '-'}
                                    </td>
                                    <td>
                                        <button class="btn-sm btn-primary" onclick="gradeSubmission('${submission.id}')">
                                            <iconify-icon icon="material-symbols:grading"></iconify-icon>
                                            Grade
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Grade submission
        function gradeSubmission(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (!submission) return;

            const modal = new bootstrap.Modal(document.getElementById('gradingModal'));
            document.getElementById('gradingModalTitle').textContent = `Grade: ${submission.assessmentTitle}`;
            
            document.getElementById('gradingModalBody').innerHTML = `
                <div class="row">
                    <div class="col-md-8">
                        <h6>Student: ${submission.student.name}</h6>
                        <h6>Assessment: ${submission.assessmentTitle}</h6>
                        <div class="mt-3">
                            <h6>Student's Answers:</h6>
                            <div class="border rounded p-3" style="background: #f8f9fa;">
                                ${submission.answers.map((answer, index) => `
                                    <div class="mb-3">
                                        <strong>Question ${index + 1}:</strong>
                                        <p class="mt-1">${answer}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">
                                <h6>Grading</h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="form-label">Total Grade</label>
                                    <input type="number" class="form-control" id="totalGrade" max="${submission.maxGrade}" min="0" value="${submission.grade || 0}">
                                    <small class="text-muted">Out of ${submission.maxGrade} points</small>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Comments</label>
                                    <textarea class="form-control" id="gradeComments" rows="4" placeholder="Add feedback for the student...">${submission.comments || ''}</textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Status</label>
                                    <select class="form-control" id="gradeStatus">
                                        <option value="graded" ${submission.status === 'graded' ? 'selected' : ''}>Graded</option>
                                        <option value="pending" ${submission.status === 'pending' ? 'selected' : ''}>Pending</option>
                                        <option value="late" ${submission.status === 'late' ? 'selected' : ''}>Late</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.show();
        }

        // Save grade
        function saveGrade() {
            const submissionId = document.querySelector('[data-submission-id]')?.dataset.submissionId;
            if (!submissionId) return;

            const submission = submissions.find(s => s.id === submissionId);
            if (!submission) return;

            submission.grade = parseInt(document.getElementById('totalGrade').value);
            submission.comments = document.getElementById('gradeComments').value;
            submission.status = document.getElementById('gradeStatus').value;
            submission.gradedAt = new Date().toISOString();

            saveToLocalStorage();
            loadGradingContent();
            updateStats();
            
            const modal = bootstrap.Modal.getInstance(document.getElementById('gradingModal'));
            modal.hide();
            
            showToast('Grade saved successfully!', 'success');
        }

        // Publish assessment
        function publishAssessment(assessmentId) {
            const assessment = assessments.find(a => a.id === assessmentId);
            if (!assessment) return;

            assessment.status = 'published';
            assessment.publishedAt = new Date().toISOString();
            
            saveToLocalStorage();
            loadAssessments();
            updateStats();
            
            showToast('Assessment published successfully!', 'success');
        }

        // View submissions
        function viewSubmissions(assessmentId) {
            const assessment = assessments.find(a => a.id === assessmentId);
            if (!assessment) return;

            const assessmentSubmissions = submissions.filter(s => s.assessmentId === assessmentId);
            
            // Switch to grading tab and filter
            switchTab('grading');
            // Filter grading content to show only this assessment's submissions
        }

        // Edit assessment
        function editAssessment(assessmentId) {
            const assessment = assessments.find(a => a.id === assessmentId);
            if (!assessment) return;

            // Open create modal with assessment data
            openCreateModal(assessment.type);
            
            // Populate form with existing data
            document.getElementById('assessmentTitle').value = assessment.title;
            document.getElementById('assessmentDescription').value = assessment.description;
            document.getElementById('totalPoints').value = assessment.totalPoints;
            document.getElementById('timeLimit').value = assessment.timeLimit || '';
            document.getElementById('dueDate').value = assessment.dueDate;
            document.getElementById('difficulty').value = assessment.difficulty;
            
            // Add existing questions
            assessment.questions.forEach(question => {
                addQuestion();
                // Populate question data
            });
        }

        // Get submission count
        function getSubmissionCount(assessmentId) {
            return submissions.filter(s => s.assessmentId === assessmentId).length;
        }

        // Update stats
        function updateStats() {
            // Use real data from English course pages
            document.getElementById('totalAssignments').textContent = englishAssignments.length;
            document.getElementById('totalQuizzes').textContent = englishQuizzes.length;
            document.getElementById('totalExams').textContent = englishExams.length;
            
            // Calculate pending grading from assignments and submissions
            const pendingAssignments = englishAssignments.filter(a => a.status === 'pending' || a.status === 'overdue').length;
            const pendingSubmissions = submissions.filter(s => s.status === 'pending').length;
            document.getElementById('pendingGrading').textContent = pendingAssignments + pendingSubmissions;

            // Update notification count with actual pending items
            const notificationCount = pendingAssignments + pendingSubmissions;
            document.getElementById('notificationCount').textContent = notificationCount;

        }

        // Filter assessments
        function filterAssessments(type) {
            // Implementation for filtering assessments by type
            loadAssessments();
        }

        // Filter grading
        function filterGrading(status) {
            // Implementation for filtering submissions by status
            loadGradingContent();
        }

        // Refresh assessments
        function refreshAssessments() {
            loadAssessments();
            showToast('Assessments refreshed', 'success');
        }

        // Open grading panel
        function openGradingPanel() {
            switchTab('grading');
        }

        // Show notifications
        function showNotifications() {
            showToast('You have 3 pending submissions to grade', 'warning');
        }

        // Show course assistants
        function showCourseAssistants() {
            showToast('Course Assistants feature coming soon', 'info');
        }

        // Create Live Session - Now with Real Zoom API Integration
        async function createLiveSession() {
            const title = document.getElementById('sessionTitle').value;
            const topic = document.getElementById('sessionTopic').value;
            const description = document.getElementById('sessionDescription').value;
            const duration = document.getElementById('sessionDuration').value;
            const maxParticipants = document.getElementById('maxParticipants').value;
            const recordSession = document.getElementById('recordSession').checked;

            if (!title || !topic) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            try {
                console.log('Creating live session...');
                
                // Try to create real Zoom meeting first
                const sessionData = {
                    topic: title,
                    type: 2, // Scheduled meeting
                    duration: parseInt(duration),
                    settings: {
                        host_video: true,
                        participant_video: true,
                        join_before_host: false,
                        mute_upon_entry: true,
                        watermark: false,
                        use_pmi: false,
                        approval_type: 0,
                        audio: 'both',
                        auto_recording: recordSession ? 'local' : 'none',
                        enforce_login: false,
                        enforce_login_domains: '',
                        alternative_hosts: '',
                        close_registration: false,
                        show_share_button: true,
                        allow_multiple_devices: true,
                        registrants_confirmation_email: true,
                        waiting_room: false,
                        request_permission_to_unmute_participants: false,
                        global_dial_in_countries: ['US'],
                        global_dial_in_numbers: [
                            {
                                country_name: 'US',
                                city: 'New York',
                                number: '+1 646 558 8656',
                                type: 'toll'
                            }
                        ],
                        registrants_email_notification: true
                    }
                };

                const response = await fetch('/api/zoom/create-meeting', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token') || 'demo-token'}`
                    },
                    body: JSON.stringify(sessionData)
                });

                if (response.ok) {
                    const session = await response.json();
                    
                    // Save to localStorage for immediate display
                    let liveSessions = JSON.parse(localStorage.getItem('englishLiveSessions')) || [];
                    const newSession = {
                        id: Date.now(),
                        title: title,
                        topic: topic,
                        description: description,
                        duration: duration,
                        maxParticipants: maxParticipants,
                        recordSession: recordSession,
                        meetingId: session.meetingId,
                        meetingPassword: session.meetingPassword,
                        meetingUrl: session.meetingUrl,
                        startUrl: session.startUrl,
                        joinUrl: session.joinUrl,
                        status: 'scheduled',
                        createdAt: new Date().toISOString(),
                        subject: 'english'
                    };
                    liveSessions.push(newSession);
                    localStorage.setItem('englishLiveSessions', JSON.stringify(liveSessions));

                    const successMessage = ` Live Session Created Successfully!\n\nMeeting ID: ${session.meetingId}\nPassword: ${session.meetingPassword}\n\nMeeting URL: ${session.meetingUrl}\n\nStart URL: ${session.startUrl}\n\nYou can now share these details with your students.`;
                    alert(successMessage);

                    // Reset form
                    document.getElementById('liveSessionForm').reset();
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('liveSessionModal'));
                    modal.hide();

                    showToast('Live session created successfully!', 'success');

                    // Optionally open the meeting start URL
                    const openMeeting = confirm('Would you like to open the Zoom meeting now?');
                    if (openMeeting) {
                        // Try to open Zoom app first
                        const zoomUrl = `zoommtg://zoom.us/join?confno=${session.meetingId}&pwd=${session.meetingPassword}`;
                        window.open(zoomUrl, '_blank');
                        
                        // Fallback to web version after a delay
                        setTimeout(() => {
                            window.open(session.startUrl, '_blank');
                        }, 2000);
                    }
                } else {
                    throw new Error('Failed to create Zoom meeting');
                }
            } catch (error) {
                console.error('Error creating live session:', error);
                
                // Fallback to simulated meeting
                createSimulatedLiveSession(title, topic, description, duration, maxParticipants, recordSession);
            }
        }

        // Fallback function for simulated meetings
        function createSimulatedLiveSession(title, topic, description, duration, maxParticipants, recordSession) {
            const meetingId = Math.floor(100000000 + Math.random() * 900000000);
            const meetingPassword = Math.random().toString(36).substring(2, 8).toUpperCase();
            const meetingUrl = `https://zoom.us/j/${meetingId}`;
            
            // Save to localStorage
            let liveSessions = JSON.parse(localStorage.getItem('englishLiveSessions')) || [];
            const newSession = {
                id: Date.now(),
                title: title,
                topic: topic,
                description: description,
                duration: duration,
                maxParticipants: maxParticipants,
                recordSession: recordSession,
                meetingId: meetingId,
                meetingPassword: meetingPassword,
                meetingUrl: meetingUrl,
                startUrl: meetingUrl,
                joinUrl: meetingUrl,
                status: 'scheduled',
                createdAt: new Date().toISOString(),
                subject: 'english'
            };
            liveSessions.push(newSession);
            localStorage.setItem('englishLiveSessions', JSON.stringify(liveSessions));

            const successMessage = ` Simulated Live Session Created!\n\nMeeting ID: ${meetingId}\nPassword: ${meetingPassword}\n\nMeeting URL: ${meetingUrl}\n\nNote: This is a simulated meeting for testing purposes.`;
            alert(successMessage);

            document.getElementById('liveSessionForm').reset();
            const modal = bootstrap.Modal.getInstance(document.getElementById('liveSessionModal'));
            modal.hide();

            showToast('Simulated meeting created successfully!', 'success');
        }

        // Weekly Schedule Functions
        function openWeeklyScheduleModal() {
            const modal = new bootstrap.Modal(document.getElementById('weeklyScheduleModal'));
            modal.show();
            
            // Set default week start date to next Sunday
            const today = new Date();
            const nextSunday = new Date(today);
            nextSunday.setDate(today.getDate() + (7 - today.getDay()));
            document.getElementById('weekStartDate').value = nextSunday.toISOString().split('T')[0];
        }

        function addSessionSlot(daySlotsId) {
            const container = document.getElementById(daySlotsId);
            const dayName = daySlotsId.replace('-slots', '');
            
            const sessionSlot = document.createElement('div');
            sessionSlot.className = 'session-slot';
            sessionSlot.innerHTML = `
                <div class="row">
                    <div class="col-md-4">
                        <input type="text" class="form-control" placeholder="Session Name" name="${dayName}-name">
                    </div>
                    <div class="col-md-3">
                        <input type="time" class="form-control" name="${dayName}-time">
                    </div>
                    <div class="col-md-3">
                        <select class="form-control" name="${dayName}-type">
                            <option value="">Select Type</option>
                            <option value="lecture">Lecture</option>
                            <option value="practice">Practice</option>
                            <option value="quiz">Quiz</option>
                            <option value="exam">Exam</option>
                            <option value="review">Review</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeSessionSlot(this)">
                            <iconify-icon icon="material-symbols:delete"></iconify-icon>
                        </button>
                    </div>
                </div>
            `;
            
            container.appendChild(sessionSlot);
        }

        function removeSessionSlot(button) {
            const sessionSlot = button.closest('.session-slot');
            const container = sessionSlot.parentElement;
            
            // Don't remove if it's the only session slot
            if (container.children.length > 1) {
                sessionSlot.remove();
            } else {
                showToast('At least one session slot is required per day', 'warning');
            }
        }

        function saveWeeklySchedule() {
            try {
                console.log('[WeeklySchedule][English] saveWeeklySchedule clicked');
                showToast('Saving weekly schedule...', 'info');
            } catch (e) { /* noop */ }

            const weekStartDateInput = document.getElementById('weekStartDate');
            const scheduleNameInput = document.getElementById('scheduleName');
            if (!weekStartDateInput || !scheduleNameInput) {
                showToast('Weekly schedule form not found on page', 'error');
                console.error('[WeeklySchedule][English] Missing inputs weekStartDate or scheduleName');
                return;
            }
            const weekStartDate = weekStartDateInput.value;
            const scheduleName = scheduleNameInput.value;
            
            if (!weekStartDate || !scheduleName) {
                showToast('Please fill in all required fields', 'error');
                return;
            }

            const weeklySchedule = {
                id: Date.now().toString(),
                name: scheduleName,
                weekStartDate: weekStartDate,
                createdAt: new Date().toISOString(),
                sessions: []
            };

            // Collect sessions for each day
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            
            days.forEach(day => {
                const daySlots = document.getElementById(`${day}-slots`);
                const sessionSlots = daySlots.querySelectorAll('.session-slot');
                
                sessionSlots.forEach(slot => {
                    const nameInput = slot.querySelector(`input[name="${day}-name"]`);
                    const timeInput = slot.querySelector(`input[name="${day}-time"]`);
                    const typeSelect = slot.querySelector(`select[name="${day}-type"]`);
                    
                    if (nameInput.value.trim() && timeInput.value && typeSelect.value) {
                        weeklySchedule.sessions.push({
                            day: day,
                            name: nameInput.value.trim(),
                            time: timeInput.value,
                            type: typeSelect.value
                        });
                    }
                });
            });

            if (weeklySchedule.sessions.length === 0) {
                showToast('Please add at least one session to the schedule', 'warning');
                return;
            }

            // Save to localStorage
            const existingSchedules = JSON.parse(localStorage.getItem('englishWeeklySchedules') || '[]');
            existingSchedules.push(weeklySchedule);
            localStorage.setItem('englishWeeklySchedules', JSON.stringify(existingSchedules));

            // Generate individual sessions for the next 4 weeks
            generateWeeklySessions(weeklySchedule);

            // Render weekly overview for the selected week
            renderWeeklyOverview(new Date(weeklySchedule.weekStartDate), weeklySchedule.sessions);

            // Close modal and reset form
            const modalEl = document.getElementById('weeklyScheduleModal');
            const modal = modalEl ? bootstrap.Modal.getInstance(modalEl) : null;
            if (modal) modal.hide();
            const formEl = document.getElementById('weeklyScheduleForm');
            if (formEl) formEl.reset();

            showToast('Weekly schedule saved successfully!', 'success');
        }

        function generateWeeklySessions(weeklySchedule) {
            const weekStart = new Date(weeklySchedule.weekStartDate);
            const generatedSessions = [];
            const generatedStudent = [];

            // Generate sessions for 4 weeks
            for (let week = 0; week < 4; week++) {
                weeklySchedule.sessions.forEach(session => {
                    const sessionDate = new Date(weekStart);
                    sessionDate.setDate(weekStart.getDate() + (week * 7) + getDayOffset(session.day));
                    
                    const sessionData = {
                        id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                        title: session.name,
                        type: session.type,
                        date: sessionDate.toISOString().split('T')[0],
                        time: session.time,
                        duration: 60, // Default duration
                        maxStudents: 30, // Default max students
                        description: `Weekly ${session.type} session`,
                        location: 'Classroom',
                        isRecurring: true,
                        weeklyScheduleId: weeklySchedule.id,
                        createdAt: new Date().toISOString()
                    };

                    generatedSessions.push(sessionData);
                    // Store student-facing schedule entries
                    generatedStudent.push(sessionData);
                });
            }

            // Add to existing sessions
            const existingSessions = JSON.parse(localStorage.getItem('englishSessionSchedules') || '[]');
            const updatedSessions = [...existingSessions, ...generatedSessions];
            localStorage.setItem('englishSessionSchedules', JSON.stringify(updatedSessions));

            // Store to student-facing schedule key for english dashboard
            const existingStudent = JSON.parse(localStorage.getItem('englishStudentSchedule') || '[]');
            const updatedStudent = [...existingStudent, ...generatedStudent];
            localStorage.setItem('englishStudentSchedule', JSON.stringify(updatedStudent));

            // Reload sessions display
            if (typeof loadSessionSchedules === 'function') {
                loadSessionSchedules();
            }
            if (typeof updateSessionStats === 'function') {
                updateSessionStats();
            }
        }

        function getDayOffset(day) {
            const dayMap = {
                'sunday': 0,
                'monday': 1,
                'tuesday': 2,
                'wednesday': 3,
                'thursday': 4,
                'friday': 5,
                'saturday': 6
            };
            return dayMap[day] || 0;
        }

        function renderWeeklyOverview(weekStartDateObj, templateSessions) {
            const overviewContainer = document.getElementById('weeklyOverview');
            const rangeEl = document.getElementById('weeklyOverviewRange');
            if (!overviewContainer || !rangeEl) return;

            const start = new Date(weekStartDateObj);
            const end = new Date(start);
            end.setDate(start.getDate() + 6);
            rangeEl.textContent = `${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;

            const dayNames = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
            const sessionsByDay = { sunday: [], monday: [], tuesday: [], wednesday: [], thursday: [], friday: [], saturday: [] };
            (templateSessions || []).forEach(s => { sessionsByDay[s.day]?.push(s); });

            let html = '';
            for (let i = 0; i < 7; i++) {
                const dayDate = new Date(start); dayDate.setDate(start.getDate() + i);
                const key = ['sunday','monday','tuesday','wednesday','thursday','friday','saturday'][i];
                const sessions = sessionsByDay[key] || [];

                html += `
                    <div class="col-md-4 col-lg-3 mb-3">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="mb-2">${dayNames[i]} <small class="text-muted">${dayDate.toLocaleDateString()}</small></h6>
                                ${sessions.length === 0 ? `<p class=\"text-muted mb-0\">No session</p>` : sessions.map(s => `
                                    <div class=\"border rounded p-2 mb-2\">
                                        <div class=\"d-flex justify-content-between\">
                                            <strong>${s.name}</strong>
                                            <span class=\"badge bg-light text-dark text-capitalize\">${s.type}</span>
                                        </div>
                                        <small class=\"text-muted\">${s.time}</small>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>`;
            }

            overviewContainer.innerHTML = html;
        }

        // Expose weekly schedule functions globally for inline onclick handlers
        window.openWeeklyScheduleModal = openWeeklyScheduleModal;
        window.saveWeeklySchedule = saveWeeklySchedule;
        window.addSessionSlot = addSessionSlot;
        window.removeSessionSlot = removeSessionSlot;

        // Show profile menu
        function showProfileMenu() {
            showToast('Profile menu coming soon', 'info');
        }

        // Save to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('englishAssessments', JSON.stringify(assessments));
            localStorage.setItem('englishSubmissions', JSON.stringify(submissions));
        }




        // Export questions
        function exportQuestions() {
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            if (questions.length === 0) {
                showToast('No questions to export', 'warning');
                return;
            }
            
            const dataStr = JSON.stringify(questions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'english_daily_practice_questions.json';
            link.click();
            URL.revokeObjectURL(url);
            showToast('Questions exported successfully!', 'success');
        }

        // Import questions
        function importQuestions() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const importedQuestions = JSON.parse(e.target.result);
                            if (Array.isArray(importedQuestions)) {
                                const currentQuestions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
                                const mergedQuestions = [...currentQuestions, ...importedQuestions];
                                localStorage.setItem('english_daily_practice_questions', JSON.stringify(mergedQuestions));
                                loadDailyPracticeQuestions();
                                showToast(`${importedQuestions.length} questions imported successfully!`, 'success');
                            } else {
                                showToast('Invalid file format', 'error');
                            }
                        } catch (error) {
                            showToast('Error reading file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-header">
                    <iconify-icon icon="material-symbols:${type === 'success' ? 'check-circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'}"></iconify-icon>
                    <strong class="ms-2">${type.charAt(0).toUpperCase() + type.slice(1)}</strong>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // Show assessment menu
        function showAssessmentMenu(assessmentId) {
            showToast('Assessment menu coming soon', 'info');
        }

        // Get English page URL based on assessment type
        function getEnglishPageUrl(type) {
            switch(type) {
                case 'assignment':
                    return 'english-assignments.html';
                case 'quiz':
                    return 'english-quizzes.html';
                case 'exam':
                    return 'english-exams.html';
                default:
                    return 'english-dashboard.html';
            }
        }

        // Sample data
        function getSampleAssessments() {
            return [];
        }

        function getSampleSubmissions() {
            return [
                {
                    id: '1',
                    assessmentId: '1',
                    assessmentTitle: 'Essay Writing Practice',
                    student: { name: 'John Smith', email: 'john@example.com' },
                    answers: ['The main argument is that technology improves education...', 'Evidence includes studies showing increased engagement...'],
                    submittedAt: '2024-01-14T15:30:00Z',
                    status: 'pending',
                    grade: null,
                    maxGrade: 100,
                    comments: ''
                },
                {
                    id: '2',
                    assessmentId: '2',
                    assessmentTitle: 'Poetry Analysis Quiz',
                    student: { name: 'Sarah Johnson', email: 'sarah@example.com' },
                    answers: ['The poem uses metaphor to convey...', 'The theme is about nature and time...'],
                    submittedAt: '2024-01-09T16:45:00Z',
                    status: 'graded',
                    grade: 50,
                    maxGrade: 50,
                    comments: 'Excellent analysis!'
                }
            ];
        }

        // Daily Practice Questions Functions
        function loadDailyQuestions() {
            // Use consistent storage key with underscores
            const questionsData = localStorage.getItem('english_daily_practice_questions');
            englishDailyQuestions = questionsData ? JSON.parse(questionsData) : [];
            console.log(' Loading daily questions for card:', englishDailyQuestions.length, 'questions');
            console.log(' Questions data:', englishDailyQuestions);
            displayDailyQuestions();
        }

        function displayDailyQuestions() {
            const container = document.getElementById('dailyQuestionsPreview');
            console.log(' Displaying daily questions:', englishDailyQuestions.length, 'questions');
            
            if (englishDailyQuestions.length === 0) {
                console.log(' No questions found, showing empty state');
                container.innerHTML = `
                    <div class="text-center py-3">
                        <iconify-icon icon="material-symbols:quiz" style="font-size: 2rem; color: #6c757d;"></iconify-icon>
                        <p class="text-muted mt-2 mb-0">No daily questions yet</p>
                        <small class="text-muted">Click "Add Question" to get started</small>
                    </div>
                `;
                return;
            }

            // Show preview of recent questions (max 3)
            const recentQuestions = englishDailyQuestions.slice(-3);
            container.innerHTML = recentQuestions.map((question, index) => {
                // Handle different question data structures
                const questionText = question.question || question.questionText || question.title || 'No question text';
                const questionType = question.type || 'unknown';
                const difficulty = question.difficulty || 'unknown';
                const actualIndex = englishDailyQuestions.length - recentQuestions.length + index;
                
                return `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div class="flex-grow-1">
                            <h6 class="mb-1" style="font-size: 0.9rem;">${questionText.substring(0, 50)}${questionText.length > 50 ? '...' : ''}</h6>
                            <div class="d-flex gap-2">
                                <span class="badge bg-primary" style="font-size: 0.7rem;">${questionType}</span>
                                <span class="badge bg-secondary" style="font-size: 0.7rem;">${difficulty}</span>
                            </div>
                        </div>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-outline-primary" onclick="editDailyQuestion(${actualIndex})" style="padding: 0.25rem 0.5rem;">
                                <iconify-icon icon="material-symbols:edit" style="font-size: 0.8rem;"></iconify-icon>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteDailyQuestion(${actualIndex})" style="padding: 0.25rem 0.5rem;">
                                <iconify-icon icon="material-symbols:delete" style="font-size: 0.8rem;"></iconify-icon>
                            </button>
                        </div>
                    </div>
                `;
            }).join('') + `
                ${englishDailyQuestions.length > 3 ? `
                    <div class="text-center mt-2">
                        <small class="text-muted">+${englishDailyQuestions.length - 3} more questions</small>
                    </div>
                ` : ''}
            `;
        }


        function loadQuestionForEdit(index) {
            const question = englishDailyQuestions[index];
            document.getElementById('questionText').value = question.question;
            document.getElementById('questionType').value = question.type;
            document.getElementById('difficultyLevel').value = question.difficulty;
            document.getElementById('questionTopic').value = question.topic;
            document.getElementById('questionPoints').value = question.points;
            document.getElementById('questionExplanation').value = question.explanation || '';
            
            toggleAnswerOptions();
            
            if (question.type === 'multiple-choice' && question.options) {
                question.options.forEach((option, i) => {
                    const optionInput = document.querySelector(`input[data-option="${String.fromCharCode(65 + i)}"]`);
                    if (optionInput) optionInput.value = option;
                });
                document.querySelector(`input[name="correctAnswer"][value="${question.correctAnswer}"]`).checked = true;
            } else if (question.expectedAnswer) {
                document.getElementById('expectedAnswer').value = question.expectedAnswer;
            }
        }

        function toggleAnswerOptions() {
            const questionType = document.getElementById('questionType').value;
            const multipleChoiceDiv = document.getElementById('multipleChoiceOptions');
            const shortAnswerDiv = document.getElementById('shortAnswerOptions');
            
            if (questionType === 'multiple-choice') {
                multipleChoiceDiv.style.display = 'block';
                shortAnswerDiv.style.display = 'none';
            } else {
                multipleChoiceDiv.style.display = 'none';
                shortAnswerDiv.style.display = 'block';
            }
        }

        function saveDailyQuestion() {
            const questionText = document.getElementById('questionText').value;
            const questionType = document.getElementById('questionType').value;
            const difficulty = document.getElementById('difficultyLevel').value;
            const topic = document.getElementById('questionTopic').value;
            const points = parseInt(document.getElementById('questionPoints').value);
            const explanation = document.getElementById('questionExplanation').value;
            
            if (!questionText || !topic) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const question = {
                id: Date.now(),
                question: questionText,
                type: questionType,
                difficulty: difficulty,
                topic: topic,
                points: points,
                explanation: explanation,
                createdAt: new Date().toISOString()
            };
            
            if (questionType === 'multiple-choice') {
                const options = [];
                const optionInputs = document.querySelectorAll('input[data-option]');
                optionInputs.forEach(input => {
                    if (input.value.trim()) {
                        options.push(input.value.trim());
                    }
                });
                
                const correctAnswer = document.querySelector('input[name="correctAnswer"]:checked');
                if (!correctAnswer || options.length < 2) {
                    showToast('Please provide at least 2 options and select the correct answer', 'error');
                    return;
                }
                
                question.options = options;
                question.correctAnswer = correctAnswer.value;
            } else {
                const expectedAnswer = document.getElementById('expectedAnswer').value;
                if (!expectedAnswer.trim()) {
                    showToast('Please provide an expected answer', 'error');
                    return;
                }
                question.expectedAnswer = expectedAnswer;
            }
            
            // Add or update question
            englishDailyQuestions.push(question);
            localStorage.setItem('english_daily_practice_questions', JSON.stringify(englishDailyQuestions));
            
            showToast('Daily question saved successfully!', 'success');
            displayDailyQuestions();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('dailyPracticeModal'));
            modal.hide();
        }

        function editDailyQuestion(index) {
            openDailyPracticeModal(index);
        }

        function deleteDailyQuestion(index) {
            if (confirm('Are you sure you want to delete this daily question?')) {
                englishDailyQuestions.splice(index, 1);
                localStorage.setItem('english_daily_practice_questions', JSON.stringify(englishDailyQuestions));
                displayDailyQuestions();
                showToast('Daily question deleted successfully', 'success');
            }
        }

        // Daily Practice Questions Management
        function openDailyPracticeModal() {
            const modal = new bootstrap.Modal(document.getElementById('dailyPracticeModal'));
            modal.show();
            loadDailyPracticeQuestions();
            
            // Refresh the card display when modal is closed
            modal._element.addEventListener('hidden.bs.modal', function() {
                console.log(' Modal closed, refreshing card display...');
                loadDailyQuestions();
            });
        }

        // Practice Questions Functions
        let practiceQuestions = [];
        let currentPracticeQuestionType = 'multiple-choice';

        function loadPracticeQuestions() {
            const questionsData = localStorage.getItem('english_practice_questions');
            practiceQuestions = questionsData ? JSON.parse(questionsData) : [];
            console.log(' Loading practice questions for card:', practiceQuestions.length, 'questions');
            displayPracticeQuestions();
        }

        function displayPracticeQuestions() {
            const container = document.getElementById('practiceQuestionsPreview');
            console.log(' Displaying practice questions:', practiceQuestions.length, 'questions');
            
            if (practiceQuestions.length === 0) {
                console.log(' No practice questions found, showing empty state');
                container.innerHTML = `
                    <div class="text-center py-3">
                        <iconify-icon icon="material-symbols:quiz" style="font-size: 2rem; color: #6c757d;"></iconify-icon>
                        <p class="text-muted mt-2 mb-0">No practice questions yet</p>
                        <small class="text-muted">Click "Create" to get started</small>
                    </div>
                `;
                return;
            }

            // Show preview of recent questions (max 3)
            const recentQuestions = practiceQuestions.slice(-3);
            container.innerHTML = recentQuestions.map((question, index) => {
                const questionText = question.question || question.questionText || question.title || 'No question text';
                const questionType = question.type || 'unknown';
                const difficulty = question.difficulty || 'unknown';
                const actualIndex = practiceQuestions.length - recentQuestions.length + index;
                
                return `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div class="flex-grow-1">
                            <h6 class="mb-1" style="font-size: 0.9rem;">${questionText.substring(0, 50)}${questionText.length > 50 ? '...' : ''}</h6>
                            <div class="d-flex gap-2">
                                <span class="badge bg-primary" style="font-size: 0.7rem;">${questionType}</span>
                                <span class="badge bg-secondary" style="font-size: 0.7rem;">${difficulty}</span>
                                <span class="badge bg-info" style="font-size: 0.7rem;">${question.points || 0} pts</span>
                            </div>
                        </div>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-outline-primary" onclick="editPracticeQuestion(${actualIndex})" style="padding: 0.25rem 0.5rem;">
                                <iconify-icon icon="material-symbols:edit" style="font-size: 0.8rem;"></iconify-icon>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deletePracticeQuestion(${actualIndex})" style="padding: 0.25rem 0.5rem;">
                                <iconify-icon icon="material-symbols:delete" style="font-size: 0.8rem;"></iconify-icon>
                            </button>
                        </div>
                    </div>
                `;
            }).join('') + `
                ${practiceQuestions.length > 3 ? `
                    <div class="text-center mt-2">
                        <small class="text-muted">+${practiceQuestions.length - 3} more questions</small>
                    </div>
                ` : ''}
            `;
        }

        function openPracticeQuestionModal() {
            const modal = new bootstrap.Modal(document.getElementById('practiceQuestionModal'));
            modal.show();
            loadPracticeQuestions();
            
            // Refresh the card display when modal is closed
            modal._element.addEventListener('hidden.bs.modal', function() {
                console.log(' Practice modal closed, refreshing card display...');
                loadPracticeQuestions();
            });
        }

        function viewAllPracticeQuestions() {
            // Open modal and show all questions
            openPracticeQuestionModal();
        }

        function selectPracticeQuestionType(type) {
            currentPracticeQuestionType = type;
            document.querySelectorAll('.question-type').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.question-type').classList.add('active');
            
            // Show/hide appropriate answer options
            document.querySelectorAll('.answer-options').forEach(option => option.style.display = 'none');
            
            switch(type) {
                case 'multiple-choice':
                    document.getElementById('practiceMultipleChoiceOptions').style.display = 'block';
                    break;
                case 'short-answer':
                    document.getElementById('practiceShortAnswerOptions').style.display = 'block';
                    break;
                case 'file-based':
                    document.getElementById('practiceFileBasedOptions').style.display = 'block';
                    break;
                case 'bullet-points':
                    document.getElementById('practiceBulletPointsOptions').style.display = 'block';
                    break;
            }
        }

        function addPracticeOption() {
            const container = document.getElementById('practiceMultipleChoiceList');
            const optionCount = container.children.length;
            const optionLetter = String.fromCharCode(65 + optionCount);
            
            const optionHtml = `
                <div class="d-flex align-items-center mb-2">
                    <input type="text" class="form-control me-2" placeholder="Option ${optionLetter}">
                    <input type="radio" name="practiceCorrectAnswer" value="${optionLetter}" class="me-2">
                    <label class="form-label mb-0">Correct</label>
                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="removePracticeOption(this)">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', optionHtml);
        }

        function removePracticeOption(button) {
            button.closest('.d-flex').remove();
        }

        function addPracticeBulletPoint() {
            const container = document.getElementById('practiceBulletPointsList');
            const pointCount = container.children.length + 1;
            
            const pointHtml = `
                <div class="d-flex align-items-center mb-2">
                    <input type="text" class="form-control me-2" placeholder="Bullet point ${pointCount}">
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removePracticeBulletPoint(this)">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', pointHtml);
        }

        function removePracticeBulletPoint(button) {
            button.closest('.d-flex').remove();
        }

        function addPracticeQuestion() {
            const questionText = document.getElementById('practiceQuestionText').value;
            const points = parseInt(document.getElementById('practiceQuestionPoints').value);
            const difficulty = document.getElementById('practiceQuestionDifficulty').value;
            const topic = document.getElementById('practiceQuestionTopic').value;
            const timeLimit = document.getElementById('practiceTimeLimit').value;
            const explanation = document.getElementById('practiceQuestionExplanation').value;
            
            if (!questionText || !topic) {
                showToast('Please fill in question content and topic', 'error');
                return;
            }
            
            const question = {
                id: Date.now().toString() + '_' + Math.random().toString(36).substr(2, 9),
                question: questionText,
                type: currentPracticeQuestionType,
                difficulty: difficulty,
                topic: topic,
                points: points,
                timeLimit: timeLimit ? parseInt(timeLimit) : null,
                explanation: explanation,
                createdAt: new Date().toISOString(),
                subject: 'english'
            };
            
            // Add type-specific data
            if (currentPracticeQuestionType === 'multiple-choice') {
                const options = [];
                const optionInputs = document.querySelectorAll('#practiceMultipleChoiceList input[type="text"]');
                optionInputs.forEach(input => {
                    if (input.value.trim()) {
                        options.push(input.value.trim());
                    }
                });
                
                const correctAnswer = document.querySelector('input[name="practiceCorrectAnswer"]:checked');
                if (!correctAnswer || options.length < 2) {
                    showToast('Please provide at least 2 options and select the correct answer', 'error');
                    return;
                }
                
                question.options = options;
                question.correctAnswer = correctAnswer.value;
            } else if (currentPracticeQuestionType === 'short-answer') {
                const expectedAnswer = document.getElementById('practiceExpectedAnswer').value;
                if (!expectedAnswer.trim()) {
                    showToast('Please provide an expected answer', 'error');
                    return;
                }
                question.expectedAnswer = expectedAnswer;
            } else if (currentPracticeQuestionType === 'file-based') {
                const allowedTypes = Array.from(document.getElementById('practiceAllowedFileTypes').selectedOptions).map(option => option.value);
                const maxSize = parseInt(document.getElementById('practiceMaxFileSize').value);
                
                question.fileUploadSettings = {
                    allowedTypes: allowedTypes,
                    maxSize: maxSize
                };
            } else if (currentPracticeQuestionType === 'bullet-points') {
                const bulletPoints = [];
                const bulletInputs = document.querySelectorAll('#practiceBulletPointsList input[type="text"]');
                bulletInputs.forEach(input => {
                    if (input.value.trim()) {
                        bulletPoints.push(input.value.trim());
                    }
                });
                
                if (bulletPoints.length === 0) {
                    showToast('Please provide at least one bullet point', 'error');
                    return;
                }
                
                question.bulletPoints = bulletPoints;
            }
            
            // Add to questions list
            addQuestionToList(question);
            
            // Clear form
            clearPracticeQuestionForm();
            
            showToast('Question added successfully!', 'success');
        }

        function addQuestionToList(question) {
            const container = document.getElementById('practiceQuestionsList');
            const questionHtml = `
                <div class="question-item p-3 border rounded mb-2" data-id="${question.id}">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">${question.question}</h6>
                            <div class="d-flex gap-2 mb-2">
                                <span class="badge bg-primary">${question.type}</span>
                                <span class="badge bg-secondary">${question.difficulty}</span>
                                <span class="badge bg-info">${question.points} pts</span>
                                <span class="badge bg-success">${question.topic}</span>
                            </div>
                            <small class="text-muted">Created: ${new Date(question.createdAt).toLocaleString()}</small>
                        </div>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-outline-primary" onclick="editPracticeQuestionFromList('${question.id}')">
                                <iconify-icon icon="material-symbols:edit"></iconify-icon>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="removePracticeQuestionFromList('${question.id}')">
                                <iconify-icon icon="material-symbols:delete"></iconify-icon>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', questionHtml);
        }

        function clearPracticeQuestionForm() {
            document.getElementById('practiceQuestionForm').reset();
            document.getElementById('practiceQuestionPoints').value = 10;
            document.getElementById('practiceQuestionDifficulty').value = 'Medium';
            
            // Reset answer options
            document.querySelectorAll('.answer-options').forEach(option => option.style.display = 'none');
            document.getElementById('practiceMultipleChoiceOptions').style.display = 'block';
            
            // Reset multiple choice options
            const container = document.getElementById('practiceMultipleChoiceList');
            container.innerHTML = `
                <div class="d-flex align-items-center mb-2">
                    <input type="text" class="form-control me-2" placeholder="Option A">
                    <input type="radio" name="practiceCorrectAnswer" value="A" class="me-2">
                    <label class="form-label mb-0">Correct</label>
                </div>
                <div class="d-flex align-items-center mb-2">
                    <input type="text" class="form-control me-2" placeholder="Option B">
                    <input type="radio" name="practiceCorrectAnswer" value="B" class="me-2">
                    <label class="form-label mb-0">Correct</label>
                </div>
            `;
            
            // Reset bullet points
            const bulletContainer = document.getElementById('practiceBulletPointsList');
            bulletContainer.innerHTML = `
                <div class="d-flex align-items-center mb-2">
                    <input type="text" class="form-control me-2" placeholder="Bullet point 1">
                    <button type="button" class="btn btn-sm btn-outline-danger" onclick="removePracticeBulletPoint(this)">
                        <iconify-icon icon="material-symbols:close"></iconify-icon>
                    </button>
                </div>
            `;
        }

        function savePracticeQuestion() {
            addPracticeQuestion();
        }

        function saveAllPracticeQuestions() {
            const questionElements = document.querySelectorAll('#practiceQuestionsList .question-item');
            if (questionElements.length === 0) {
                showToast('No questions to save', 'warning');
                return;
            }
            
            // Get all questions from the list
            const questions = [];
            questionElements.forEach(element => {
                const questionId = element.dataset.id;
                const question = practiceQuestions.find(q => q.id === questionId);
                if (question) {
                    questions.push(question);
                }
            });
            
            // Save to localStorage
            localStorage.setItem('english_practice_questions', JSON.stringify(questions));
            practiceQuestions = questions;
            
            showToast(`Successfully saved ${questions.length} practice questions!`, 'success');
            
            // Refresh card display
            loadPracticeQuestions();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('practiceQuestionModal'));
            modal.hide();
        }

        function editPracticeQuestion(index) {
            openPracticeQuestionModal();
            // TODO: Load question data for editing
        }

        function deletePracticeQuestion(index) {
            if (confirm('Are you sure you want to delete this practice question?')) {
                practiceQuestions.splice(index, 1);
                localStorage.setItem('english_practice_questions', JSON.stringify(practiceQuestions));
                displayPracticeQuestions();
                showToast('Practice question deleted successfully', 'success');
            }
        }

        function editPracticeQuestionFromList(questionId) {
            // TODO: Load question data for editing
            showToast('Edit functionality coming soon', 'info');
        }

        function removePracticeQuestionFromList(questionId) {
            if (confirm('Are you sure you want to remove this question?')) {
                document.querySelector(`[data-id="${questionId}"]`).remove();
                showToast('Question removed from list', 'success');
            }
        }

        // Live Sessions Functions
        function loadLiveSessions() {
            const sessionsData = localStorage.getItem('englishLiveSessions');
            const liveSessions = sessionsData ? JSON.parse(sessionsData) : [];
            console.log(' Loading live sessions for card:', liveSessions.length, 'sessions');
            displayLiveSessions(liveSessions);
        }

        function displayLiveSessions(sessions) {
            const container = document.getElementById('liveSessionsPreview');
            console.log(' Displaying live sessions:', sessions.length, 'sessions');
            
            if (sessions.length === 0) {
                console.log(' No live sessions found, showing empty state');
                container.innerHTML = `
                    <div class="text-center py-3">
                        <iconify-icon icon="material-symbols:video-call" style="font-size: 2rem; color: #6c757d;"></iconify-icon>
                        <p class="text-muted mt-2 mb-0">No live sessions yet</p>
                        <small class="text-muted">Click "Start Session" to get started</small>
                    </div>
                `;
                return;
            }

            // Show preview of recent sessions (max 3)
            const recentSessions = sessions.slice(-3);
            container.innerHTML = recentSessions.map((session, index) => {
                const actualIndex = sessions.length - recentSessions.length + index;
                
                return `
                    <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-light rounded">
                        <div class="flex-grow-1">
                            <h6 class="mb-1" style="font-size: 0.9rem;">${session.title}</h6>
                            <div class="d-flex gap-2">
                                <span class="badge bg-primary" style="font-size: 0.7rem;">${session.topic}</span>
                                <span class="badge bg-secondary" style="font-size: 0.7rem;">${session.duration}min</span>
                                <span class="badge bg-info" style="font-size: 0.7rem;">${session.status}</span>
                            </div>
                        </div>
                        <div class="d-flex gap-1">
                            <button class="btn btn-sm btn-outline-primary" onclick="joinLiveSession('${session.meetingId}')" style="padding: 0.25rem 0.5rem;">
                                <iconify-icon icon="material-symbols:video-call" style="font-size: 0.8rem;"></iconify-icon>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteLiveSession(${actualIndex})" style="padding: 0.25rem 0.5rem;">
                                <iconify-icon icon="material-symbols:delete" style="font-size: 0.8rem;"></iconify-icon>
                            </button>
                        </div>
                    </div>
                `;
            }).join('') + `
                ${sessions.length > 3 ? `
                    <div class="text-center mt-2">
                        <small class="text-muted">+${sessions.length - 3} more sessions</small>
                    </div>
                ` : ''}
            `;
        }

        function viewAllLiveSessions() {
            // Open modal and show all sessions
            openLiveSessionModal();
        }

        function joinLiveSession(meetingId) {
            showToast(`Joining session ${meetingId}...`, 'info');
            // TODO: Implement actual join functionality
        }

        function deleteLiveSession(index) {
            if (confirm('Are you sure you want to delete this live session?')) {
                let sessions = JSON.parse(localStorage.getItem('englishLiveSessions') || '[]');
                sessions.splice(index, 1);
                localStorage.setItem('englishLiveSessions', JSON.stringify(sessions));
                displayLiveSessions(sessions);
                showToast('Live session deleted successfully', 'success');
            }
        }

        // Open Live Session Modal
        function openLiveSessionModal() {
            const modal = new bootstrap.Modal(document.getElementById('liveSessionModal'));
            modal.show();
        }

        // Open Chat Choice Modal
        function openChatChoiceModal() {
            const modal = new bootstrap.Modal(document.getElementById('chatChoiceModal'));
            modal.show();
        }

        // Show questions by type/difficulty
        function showQuestionsByType(type) {
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            let filteredQuestions = questions;
            
            if (type !== 'all') {
                filteredQuestions = questions.filter(q => q.difficulty && q.difficulty.toLowerCase() === type);
            }
            
            if (filteredQuestions.length === 0) {
                showToast(`No ${type === 'all' ? '' : type + ' '}questions found`, 'info');
                return;
            }
            
            // Create a modal to display questions
            const modalHtml = `
                <div class="modal fade" id="questionsViewModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <iconify-icon icon="material-symbols:quiz" style="margin-right: 0.5rem;"></iconify-icon>
                                    ${type === 'all' ? 'All' : type.charAt(0).toUpperCase() + type.slice(1)} Questions (${filteredQuestions.length})
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    ${filteredQuestions.map((question, index) => `
                                        <div class="col-md-6 mb-3">
                                            <div class="card">
                                                <div class="card-body">
                                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                                        <h6 class="card-title">Question ${index + 1}</h6>
                                                        <span class="badge bg-${question.difficulty === 'Easy' ? 'success' : question.difficulty === 'Medium' ? 'warning' : 'danger'}">${question.difficulty || 'Easy'}</span>
                                                    </div>
                                                    <p class="card-text">${question.question || 'No question text'}</p>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <small class="text-muted">Topic: ${question.topic || 'Not specified'}</small>
                                                        <small class="text-muted">Points: ${question.points || 10}</small>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('questionsViewModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('questionsViewModal'));
            modal.show();
        }

        function selectDailyPracticeQuestionType(type) {
            currentDailyPracticeQuestionType = type;
            document.querySelectorAll('.question-type-compact').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.question-type-compact').classList.add('active');
        }

        function loadDailyPracticeQuestions() {
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            const questionCount = document.getElementById('dailyPracticeQuestionCount');
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            
            // Update question count if element exists
            if (questionCount) {
            questionCount.textContent = questions.length;
            }
            
            // Update statistics
            updateQuestionStatistics(questions);
            
            // Only update container if it exists
            if (container) {
            container.innerHTML = '';
            // Show container by default
            container.style.display = 'block';
            
            // Show empty state message - saved questions are hidden in categories
            container.innerHTML = '<div class="text-center text-muted py-4"><iconify-icon icon="material-symbols:quiz" style="font-size: 3rem; opacity: 0.3;"></iconify-icon><p class="mt-2">No questions being created. Click "Add Question" to start creating a new question!</p><p class="small">Use the filter buttons above to view saved questions by difficulty.</p></div>';
            }
        }

        function addDailyPracticeQuestionToContainer(question, questionNumber) {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            if (!container) return; // Exit if container doesn't exist
            dailyPracticeQuestionCounter++;
            
            const questionHtml = `
                <div class="question-item mb-4 p-3 border rounded" id="dailyPracticeQuestion-${dailyPracticeQuestionCounter}" style="display: block;" data-question-type="${question.type || currentDailyPracticeQuestionType}" data-difficulty="${question.difficulty || 'Easy'}" data-question-id="${question.id || ''}" data-created-at="${question.createdAt || ''}">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center gap-3">
                            <div class="form-check">
                                <input class="form-check-input question-checkbox" type="checkbox" value="${dailyPracticeQuestionCounter}" onchange="updateBulkActions()">
                            </div>
                            <h6>Question ${questionNumber}</h6>
                            <span class="badge bg-primary">${question.type || currentDailyPracticeQuestionType}</span>
                            <span class="badge bg-${question.difficulty === 'Easy' ? 'success' : question.difficulty === 'Medium' ? 'warning' : 'danger'}">${question.difficulty || 'Easy'}</span>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-sm btn-outline-info" onclick="duplicateQuestion(${dailyPracticeQuestionCounter})">
                                <iconify-icon icon="material-symbols:content-copy"></iconify-icon>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger" onclick="removeDailyPracticeQuestion(${dailyPracticeQuestionCounter})">
                                <iconify-icon icon="material-symbols:delete"></iconify-icon>
                            </button>
                        </div>
                    </div>
                    <div class="mb-3" style="width: 100%; display: block;">
                        <label class="form-label" style="display: block; width: 100%;">Question Text</label>
                        <textarea class="form-control" name="dailyPracticeQuestionText" rows="3" placeholder="Enter your question..." style="width: 100%; display: block;">${question.question || ''}</textarea>
                    </div>
                    <div class="mb-3" style="width: 100%; display: block;">
                        <label class="form-label" style="display: block; width: 100%;">Difficulty</label>
                        <select class="form-control" name="dailyPracticeDifficulty" style="width: 100%; display: block;">
                            <option value="Easy" ${question.difficulty === 'Easy' ? 'selected' : ''}>Easy</option>
                            <option value="Medium" ${question.difficulty === 'Medium' ? 'selected' : ''}>Medium</option>
                            <option value="Hard" ${question.difficulty === 'Hard' ? 'selected' : ''}>Hard</option>
                        </select>
                    </div>
                    <div class="mb-3" style="width: 100%; display: block;">
                        <label class="form-label" style="display: block; width: 100%;">Topic</label>
                        <input type="text" class="form-control" name="dailyPracticeTopic" placeholder="e.g., Grammar, Vocabulary, Reading" value="${question.topic || ''}" style="width: 100%; display: block;">
                    </div>
                    <div class="mb-3" style="width: 100%; display: block;">
                        <label class="form-label" style="display: block; width: 100%;">Points</label>
                        <input type="number" class="form-control" name="dailyPracticePoints" min="1" value="${question.points || 10}" style="width: 100%; display: block;">
                    </div>
                    <div id="dailyPracticeQuestionOptions-${dailyPracticeQuestionCounter}" style="width: 100%; display: block;">
                        ${generateDailyPracticeQuestionOptions(question.type || currentDailyPracticeQuestionType, dailyPracticeQuestionCounter, question.options || [])}
                    </div>
                </div>
            `;
            
            container.insertAdjacentHTML('beforeend', questionHtml);
        }

        function generateDailyPracticeQuestionOptions(type, questionId, options = []) {
            switch(type) {
                case 'multiple-choice':
                case 'multiple-select':
                    const optionHtml = options.length > 0 ? 
                        options.map((option, index) => `
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" placeholder="Option ${index + 1}" value="${option}">
                                <div class="input-group-text">
                                    <input type="radio" name="dailyPracticeCorrect-${questionId}" value="${index}">
                                </div>
                            </div>
                        `).join('') :
                        `
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" placeholder="Option 1">
                                <div class="input-group-text">
                                    <input type="radio" name="dailyPracticeCorrect-${questionId}" value="0">
                                </div>
                            </div>
                            <div class="input-group mb-2">
                                <input type="text" class="form-control" placeholder="Option 2">
                                <div class="input-group-text">
                                    <input type="radio" name="dailyPracticeCorrect-${questionId}" value="1">
                                </div>
                            </div>
                        `;
                    
                    return `
                        <div class="mb-3">
                            <label class="form-label">Options</label>
                            <div id="dailyPracticeOptions-${questionId}">
                                ${optionHtml}
                            </div>
                            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addDailyPracticeOption(${questionId})">
                                <iconify-icon icon="material-symbols:add"></iconify-icon>
                                Add Option
                            </button>
                        </div>
                    `;
                case 'short-answer':
                    return `
                        <div class="mb-3">
                            <label class="form-label">Sample Answer (Optional)</label>
                            <textarea class="form-control" name="dailyPracticeSampleAnswer" rows="2" placeholder="Provide a sample answer for reference...">${options[0] || ''}</textarea>
                        </div>
                    `;
                case 'file-upload':
                case 'file-based':
                    return `
                        <div class="mb-3">
                            <label class="form-label">Upload Question File (Optional)</label>
                            <div class="file-upload-area" onclick="document.getElementById('dailyPracticeQuestionFile_${questionId}').click()" 
                                 style="border: 2px dashed #667eea; border-radius: 8px; padding: 1rem; text-align: center; cursor: pointer; background: #f8f9ff;">
                                <iconify-icon icon="material-symbols:cloud-upload" style="font-size: 2rem; color: #667eea;"></iconify-icon>
                                <div style="margin-top: 0.5rem; color: #667eea;">Click to upload question file (PDF, Image, etc.)</div>
                                <div id="dailyPracticeQuestionFileDisplay_${questionId}" style="margin-top: 0.5rem; font-size: 0.9rem; color: #28a745;"></div>
                            </div>
                            <input type="file" id="dailyPracticeQuestionFile_${questionId}" style="display: none;" 
                                   accept=".pdf,.jpg,.jpeg,.png,.doc,.docx" 
                                   onchange="handleDailyPracticeQuestionFileUpload('${questionId}', this)">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Allowed Answer File Types</label>
                            <select class="form-control" name="dailyPracticeAllowedTypes" multiple>
                                <option value="pdf" selected>PDF</option>
                                <option value="doc" selected>DOC</option>
                                <option value="docx" selected>DOCX</option>
                                <option value="jpg" selected>JPG</option>
                                <option value="png" selected>PNG</option>
                                <option value="txt">TXT</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Max File Size (MB)</label>
                            <input type="number" class="form-control" name="dailyPracticeMaxFileSize" value="10" min="1">
                        </div>
                    `;
                default:
                    return '';
            }
        }

        // Add daily practice questions
        function addDailyPracticeQuestions() {
            console.log('addDailyPracticeQuestions called! (English)');
            const questionCountInput = document.getElementById('questionCountInput');
            console.log('questionCountInput:', questionCountInput);
            const numberOfQuestions = parseInt(questionCountInput.value) || 1;
            console.log('numberOfQuestions:', numberOfQuestions);
            
            if (numberOfQuestions < 1 || numberOfQuestions > 50) {
                console.log('Invalid number of questions');
                showToast('Please enter a valid number between 1 and 50', 'warning');
                return;
            }
            
            console.log('Creating questions...');
            // Create questions based on the selected type
            for (let i = 0; i < numberOfQuestions; i++) {
                console.log(`Creating question ${i + 1}`);
                addDailyPracticeQuestion();
            }
            
            console.log('Questions created successfully');
            showToast(`Successfully created ${numberOfQuestions} question${numberOfQuestions > 1 ? 's' : ''}`, 'success');
        }

        // Add single daily practice question
        function addDailyPracticeQuestion() {
            console.log('addDailyPracticeQuestion called (English), counter:', dailyPracticeQuestionCounter);
            dailyPracticeQuestionCounter++;
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            console.log('container (English):', container);
            if (!container) {
                console.log('Container not found! (English)');
                return; // Exit if container doesn't exist
            }
            
            console.log('Creating question HTML... (English)');
            const questionHtml = `
                <div class="question-item mb-4 p-3 border rounded" id="dailyPracticeQuestion-${dailyPracticeQuestionCounter}" data-saved="false" data-question-type="${currentDailyPracticeQuestionType}">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6>Question ${dailyPracticeQuestionCounter}</h6>
                        <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteCurrentQuestion(${dailyPracticeQuestionCounter})" title="Delete this question">
                            <iconify-icon icon="material-symbols:delete"></iconify-icon>
                            Delete
                        </button>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Question Text</label>
                        <textarea class="form-control" name="dailyPracticeQuestionText" rows="3" placeholder="Enter your question..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Points</label>
                        <input type="number" class="form-control" name="dailyPracticePoints" min="1" value="10">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Difficulty</label>
                        <select class="form-control" name="dailyPracticeDifficulty">
                            <option value="Easy">Easy</option>
                            <option value="Medium" selected>Medium</option>
                            <option value="Hard">Hard</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Topic</label>
                        <input type="text" class="form-control" name="dailyPracticeTopic" placeholder="e.g., Grammar, Reading Comprehension">
                    </div>
                    <div id="dailyPracticeQuestionOptions-${dailyPracticeQuestionCounter}">
                        ${generateDailyPracticeQuestionOptions(currentDailyPracticeQuestionType, dailyPracticeQuestionCounter)}
                    </div>
                </div>
            `;
            
            console.log('Adding question to container... (English)');
            
            // Clear only the empty state message when adding a new question, not existing questions
            if (container.innerHTML.includes('No questions being created')) {
                container.innerHTML = '';
            }
            
            container.insertAdjacentHTML('beforeend', questionHtml);
            console.log('Question added successfully (English)');
            
            // Show container when question is added
            container.style.display = 'block';
            
            // Update question count
            updateDailyPracticeQuestionCount();
        }

        function addDailyPracticeOption(questionId) {
            const optionsContainer = document.getElementById(`dailyPracticeOptions-${questionId}`);
            const optionCount = optionsContainer.children.length;
            
            const optionHtml = `
                <div class="input-group mb-2">
                    <input type="text" class="form-control" placeholder="Option ${optionCount + 1}">
                    <div class="input-group-text">
                        <input type="radio" name="dailyPracticeCorrect-${questionId}" value="${optionCount}">
                    </div>
                </div>
            `;
            
            optionsContainer.insertAdjacentHTML('beforeend', optionHtml);
        }

        function removeDailyPracticeQuestion(questionId) {
            const questionElement = document.getElementById(`dailyPracticeQuestion-${questionId}`);
            if (questionElement) {
                questionElement.remove();
                updateDailyPracticeQuestionCount();
            }
        }

        function updateDailyPracticeQuestionCount() {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            const questionCount = document.getElementById('dailyPracticeQuestionCount');
            
            if (!container || !questionCount) return; // Exit if elements don't exist
            
            const questions = container.querySelectorAll('.question-item');
            questionCount.textContent = questions.length;
        }

        // Handle daily practice question file upload
        function handleDailyPracticeQuestionFileUpload(questionId, input) {
            const file = input.files[0];
            const display = document.getElementById(`dailyPracticeQuestionFileDisplay_${questionId}`);
            
            if (file) {
                const fileSize = formatFileSize(file.size);
                display.innerHTML = `
                    <iconify-icon icon="material-symbols:check-circle" style="color: #28a745;"></iconify-icon>
                    ${file.name} (${fileSize})
                `;
            } else {
                display.innerHTML = '';
            }
        }

        function saveDailyPracticeQuestions() {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            if (!container) return; // Exit if container doesn't exist
            
            const questionElements = container.querySelectorAll('.question-item');
            const questions = [];
            let hasErrors = false;

            // Show loading state
            const saveBtn = document.querySelector('button[onclick="saveDailyPracticeQuestions()"]');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<iconify-icon icon="material-symbols:hourglass-empty"></iconify-icon> Saving...';
            saveBtn.disabled = true;

            questionElements.forEach((element, index) => {
                const questionText = element.querySelector('textarea[name="dailyPracticeQuestionText"]').value.trim();
                const difficulty = element.querySelector('select[name="dailyPracticeDifficulty"]').value;
                const topic = element.querySelector('input[name="dailyPracticeTopic"]').value.trim();
                const points = parseInt(element.querySelector('input[name="dailyPracticePoints"]').value) || 10;
                const questionType = element.getAttribute('data-question-type') || currentDailyPracticeQuestionType;
                
                // Validation
                if (!questionText) {
                    showToast(`Question text is required for question ${index + 1}`, 'error');
                    hasErrors = true;
                    return;
                }
                if (!topic) {
                    showToast(`Topic is required for question ${index + 1}`, 'error');
                    hasErrors = true;
                    return;
                }
                if (points < 1) {
                    showToast(`Points must be at least 1 for question ${index + 1}`, 'error');
                    hasErrors = true;
                    return;
                }

                // Get existing question data if available
                const existingId = element.getAttribute('data-question-id');
                const existingCreatedAt = element.getAttribute('data-created-at');
                
                const question = {
                    id: existingId || Date.now() + index,
                    question: questionText,
                    difficulty: difficulty,
                    topic: topic,
                    points: points,
                    type: questionType,
                    createdAt: existingCreatedAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };

                // Get answer based on question type
                if (questionType === 'multiple-choice') {
                    const correctRadio = element.querySelector(`input[name="dailyPracticeCorrect-${element.id.split('-')[1]}"]:checked`);
                    const options = Array.from(element.querySelectorAll('#dailyPracticeOptions-' + element.id.split('-')[1] + ' input[type="text"]')).map(input => input.value.trim()).filter(opt => opt);
                    
                    if (!correctRadio) {
                        showToast(`Please select a correct answer for question ${index + 1}`, 'error');
                        hasErrors = true;
                        return;
                    }
                    if (options.length < 2) {
                        showToast(`At least 2 options are required for question ${index + 1}`, 'error');
                        hasErrors = true;
                        return;
                    }
                    
                    question.options = options;
                    question.correctAnswer = correctRadio.value;
                    question.answer = options[parseInt(correctRadio.value)];
                } else if (questionType === 'short-answer') {
                    const answerTextarea = element.querySelector('textarea[name="dailyPracticeAnswer"]');
                    const explanationTextarea = element.querySelector('textarea[name="dailyPracticeExplanation"]');
                    
                    if (answerTextarea && answerTextarea.value.trim()) {
                        question.answer = answerTextarea.value.trim();
                    }
                    if (explanationTextarea && explanationTextarea.value.trim()) {
                        question.explanation = explanationTextarea.value.trim();
                    }
                } else if (questionType === 'file-upload' || questionType === 'file-based') {
                    // Handle file upload question data
                    const allowedTypesSelect = element.querySelector('select[name="allowedTypes"]');
                    const maxFileSizeInput = element.querySelector('input[name="maxFileSize"]');
                    const fileInstructionsTextarea = element.querySelector('textarea[name="fileInstructions"]');
                    const answerTypeSelect = element.querySelector('select[name="answerType"]');
                    
                    if (allowedTypesSelect) {
                        question.allowedFileTypes = Array.from(allowedTypesSelect.selectedOptions).map(option => option.value);
                    }
                    if (maxFileSizeInput) {
                        question.maxFileSize = parseInt(maxFileSizeInput.value) || 10;
                    }
                    if (fileInstructionsTextarea && fileInstructionsTextarea.value.trim()) {
                        question.fileInstructions = fileInstructionsTextarea.value.trim();
                    }
                    if (answerTypeSelect) {
                        question.answerType = answerTypeSelect.value;
                    }
                    
                    // Handle question file upload
                    if (window.questionFiles && window.questionFiles[elementId]) {
                        question.questionFile = {
                            name: window.questionFiles[elementId].name,
                            size: window.questionFiles[elementId].size,
                            type: window.questionFiles[elementId].type
                        };
                    }
                    
                    // Handle multiple choice options for file assessments
                    if (answerTypeSelect && (answerTypeSelect.value === 'file-with-multiple-choice' || answerTypeSelect.value === 'multiple-choice-only')) {
                        const fileAnswerOptions = element.querySelectorAll('input[name="fileAnswerOption"]');
                        const correctAnswerRadio = element.querySelector('input[name="correctFileAnswer_' + elementId + '"]:checked');
                        
                        question.fileAnswerOptions = Array.from(fileAnswerOptions).map(input => input.value.trim()).filter(value => value);
                        if (correctAnswerRadio) {
                            question.correctFileAnswer = parseInt(correctAnswerRadio.value);
                        }
                    }
                }

                questions.push(question);
            });

            if (hasErrors) {
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                return;
            }

            localStorage.setItem('english_daily_practice_questions', JSON.stringify(questions));
            console.log(' Saved questions to localStorage:', questions.length, 'questions');
            console.log(' Questions data:', questions);
            showToast(`Successfully saved ${questions.length} daily practice questions!`, 'success');
            
            // Reset button state
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
            
            loadDailyPracticeQuestions();
            
            // Also refresh the card display
            console.log(' Refreshing card display after save...');
            loadDailyQuestions();
        }

        // Publish daily practice questions to student dashboard
        function publishDailyPracticeQuestions() {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            if (!container) return; // Exit if container doesn't exist
            
            const questionElements = container.querySelectorAll('.question-item');
            const questions = [];
            let hasErrors = false;

            // Show loading state
            const publishBtn = document.querySelector('button[onclick="publishDailyPracticeQuestions()"]');
            const originalText = publishBtn.innerHTML;
            publishBtn.innerHTML = '<iconify-icon icon="material-symbols:hourglass-empty"></iconify-icon> Publishing...';
            publishBtn.disabled = true;

            questionElements.forEach((element, index) => {
                const questionText = element.querySelector('textarea[name="dailyPracticeQuestionText"]').value.trim();
                const difficulty = element.querySelector('select[name="dailyPracticeDifficulty"]').value;
                const topic = element.querySelector('input[name="dailyPracticeTopic"]').value.trim();
                const points = parseInt(element.querySelector('input[name="dailyPracticePoints"]').value) || 10;
                const questionType = element.getAttribute('data-question-type') || currentDailyPracticeQuestionType;
                
                // Validation
                if (!questionText) {
                    showToast(`Question text is required for question ${index + 1}`, 'error');
                    hasErrors = true;
                    return;
                }
                if (!topic) {
                    showToast(`Topic is required for question ${index + 1}`, 'error');
                    hasErrors = true;
                    return;
                }
                if (points < 1) {
                    showToast(`Points must be at least 1 for question ${index + 1}`, 'error');
                    hasErrors = true;
                    return;
                }

                // Get existing question data if available
                const existingId = element.getAttribute('data-question-id');
                const existingCreatedAt = element.getAttribute('data-created-at');
                
                const question = {
                    id: existingId || Date.now() + index,
                    question: questionText,
                    difficulty: difficulty,
                    topic: topic,
                    points: points,
                    type: questionType,
                    createdAt: existingCreatedAt || new Date().toISOString(),
                    updatedAt: new Date().toISOString(),
                    published: true,
                    publishedAt: new Date().toISOString()
                };

                // Get answer based on question type
                if (questionType === 'multiple-choice') {
                    const correctRadio = element.querySelector(`input[name="dailyPracticeCorrect-${element.id.split('-')[1]}"]:checked`);
                    const options = Array.from(element.querySelectorAll('#dailyPracticeOptions-' + element.id.split('-')[1] + ' input[type="text"]')).map(input => input.value.trim()).filter(opt => opt);
                    
                    if (!correctRadio) {
                        showToast(`Please select a correct answer for question ${index + 1}`, 'error');
                        hasErrors = true;
                        return;
                    }
                    if (options.length < 2) {
                        showToast(`At least 2 options are required for question ${index + 1}`, 'error');
                        hasErrors = true;
                        return;
                    }
                    
                    question.options = options;
                    question.correctAnswer = correctRadio.value;
                    question.answer = options[parseInt(correctRadio.value)];
                } else if (questionType === 'short-answer') {
                    const answerTextarea = element.querySelector('textarea[name="dailyPracticeAnswer"]');
                    const explanationTextarea = element.querySelector('textarea[name="dailyPracticeExplanation"]');
                    
                    if (answerTextarea && answerTextarea.value.trim()) {
                        question.answer = answerTextarea.value.trim();
                    }
                    if (explanationTextarea && explanationTextarea.value.trim()) {
                        question.explanation = explanationTextarea.value.trim();
                    }
                } else if (questionType === 'file-upload' || questionType === 'file-based') {
                    // Handle file upload question data
                    const elementId = element.id.split('-')[1];
                    const allowedTypesSelect = element.querySelector('select[name="allowedTypes"]');
                    const maxFileSizeInput = element.querySelector('input[name="maxFileSize"]');
                    const fileInstructionsTextarea = element.querySelector('textarea[name="fileInstructions"]');
                    const answerTypeSelect = element.querySelector('select[name="answerType"]');
                    
                    if (allowedTypesSelect) {
                        question.allowedFileTypes = Array.from(allowedTypesSelect.selectedOptions).map(option => option.value);
                    }
                    if (maxFileSizeInput) {
                        question.maxFileSize = parseInt(maxFileSizeInput.value) || 10;
                    }
                    if (fileInstructionsTextarea && fileInstructionsTextarea.value.trim()) {
                        question.fileInstructions = fileInstructionsTextarea.value.trim();
                    }
                    if (answerTypeSelect) {
                        question.answerType = answerTypeSelect.value;
                    }
                    
                    // Handle question file upload
                    if (window.questionFiles && window.questionFiles[elementId]) {
                        question.questionFile = {
                            name: window.questionFiles[elementId].name,
                            size: window.questionFiles[elementId].size,
                            type: window.questionFiles[elementId].type
                        };
                    }
                    
                    // Handle multiple choice options for file assessments
                    if (answerTypeSelect && (answerTypeSelect.value === 'file-with-multiple-choice' || answerTypeSelect.value === 'multiple-choice-only')) {
                        const fileAnswerOptions = element.querySelectorAll('input[name="fileAnswerOption"]');
                        const correctAnswerRadio = element.querySelector('input[name="correctFileAnswer_' + elementId + '"]:checked');
                        
                        question.fileAnswerOptions = Array.from(fileAnswerOptions).map(input => input.value.trim()).filter(value => value);
                        if (correctAnswerRadio) {
                            question.correctFileAnswer = parseInt(correctAnswerRadio.value);
                        }
                    }
                }

                questions.push(question);
            });

            if (hasErrors) {
                publishBtn.innerHTML = originalText;
                publishBtn.disabled = false;
                return;
            }

            // Save to teacher's local storage (same as save function)
            localStorage.setItem('english_daily_practice_questions', JSON.stringify(questions));
            
            // Also save to student-facing storage for the student dashboard
            localStorage.setItem('english_daily_practice_questions_student', JSON.stringify(questions));
            
            console.log(' Published questions to localStorage:', questions.length, 'questions');
            console.log(' Questions data:', questions);
            showToast(`Successfully published ${questions.length} daily practice questions to course!`, 'success');
            
            // Reset button state
            publishBtn.innerHTML = originalText;
            publishBtn.disabled = false;
            
            loadDailyPracticeQuestions();
            
            // Also refresh the card display
            console.log(' Refreshing card display after publish...');
            loadDailyQuestions();
        }

        // Save currently creating questions to localStorage
        function saveCurrentlyCreatingQuestions() {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            if (!container) return;
            
            const questionElements = container.querySelectorAll('.question-item');
            if (questionElements.length === 0) return;
            
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            let hasNewQuestions = false;
            
            questionElements.forEach((element) => {
                const questionText = element.querySelector('textarea[name="dailyPracticeQuestionText"]');
                const difficulty = element.querySelector('select[name="dailyPracticeDifficulty"]');
                const topic = element.querySelector('input[name="dailyPracticeTopic"]');
                const points = element.querySelector('input[name="dailyPracticePoints"]');
                
                // Only save if question has content and hasn't been saved yet
                if (questionText && questionText.value.trim() && !element.hasAttribute('data-saved')) {
                    const questionId = element.id.split('-')[1];
                    const questionType = element.getAttribute('data-question-type') || currentDailyPracticeQuestionType;
                    
                    const question = {
                        id: Date.now() + Math.random(),
                        question: questionText.value.trim(),
                        difficulty: difficulty ? difficulty.value : 'Easy',
                        topic: topic ? topic.value.trim() : '',
                        points: points ? parseInt(points.value) || 10 : 10,
                        type: questionType,
                        createdAt: new Date().toISOString(),
                        published: false
                    };
                    
                    // Get answer based on question type
                    if (questionType === 'multiple-choice') {
                        const correctRadio = element.querySelector(`input[name="dailyPracticeCorrect-${questionId}"]:checked`);
                        const options = Array.from(element.querySelectorAll('#dailyPracticeOptions-' + questionId + ' input[type="text"]')).map(input => input.value.trim()).filter(opt => opt);
                        
                        if (correctRadio && options.length >= 2) {
                            question.options = options;
                            question.correctAnswer = correctRadio.value;
                            question.answer = options[parseInt(correctRadio.value)];
                        }
                    } else if (questionType === 'short-answer') {
                        const answerTextarea = element.querySelector('textarea[name="dailyPracticeAnswer"]');
                        const explanationTextarea = element.querySelector('textarea[name="dailyPracticeExplanation"]');
                        
                        if (answerTextarea && answerTextarea.value.trim()) {
                            question.answer = answerTextarea.value.trim();
                        }
                        if (explanationTextarea && explanationTextarea.value.trim()) {
                            question.explanation = explanationTextarea.value.trim();
                        }
                    }
                    
                    questions.push(question);
                    hasNewQuestions = true;
                    
                    // Mark this element as saved to prevent duplicate saving
                    element.setAttribute('data-saved', 'true');
                }
            });
            
            if (hasNewQuestions) {
                localStorage.setItem('english_daily_practice_questions', JSON.stringify(questions));
                localStorage.setItem('english_daily_practice_questions_student', JSON.stringify(questions));
            }
        }

        // Expose publishDailyPracticeQuestions globally for inline onclick handlers
        window.publishDailyPracticeQuestions = publishDailyPracticeQuestions;

        // Show all questions in main container
        function showAllQuestions() {
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            displayQuestionsInMainContainer(questions, 'All Questions');
        }

        // Show questions by difficulty in main container
        function showQuestionsByDifficulty(difficulty) {
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            const filteredQuestions = questions.filter(q => q.difficulty === difficulty);
            displayQuestionsInMainContainer(filteredQuestions, `${difficulty} Questions`);
        }

        // Display questions in main container
        function displayQuestionsInMainContainer(questions, title) {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            if (!container) return;
            
            // Get any currently creating questions that haven't been saved yet
            const creatingQuestions = Array.from(container.querySelectorAll('.question-item[data-saved="false"]'));
            
            // Clear the main container
            container.innerHTML = '';
            container.style.display = 'block';
            
            // If there are questions being created, show them first
            if (creatingQuestions.length > 0) {
                creatingQuestions.forEach(element => {
                    container.appendChild(element);
                });
                
                // Add a separator if there are both creating and saved questions
                if (questions.length > 0) {
                    const separator = document.createElement('div');
                    separator.className = 'border-top my-3';
                    separator.innerHTML = '<div class="text-center text-muted py-2"><small>Saved Questions</small></div>';
                    container.appendChild(separator);
                }
            }
            
            if (questions.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <iconify-icon icon="material-symbols:quiz" style="font-size: 3rem; opacity: 0.3;"></iconify-icon>
                        <h5 class="text-muted">No ${title.toLowerCase()} found</h5>
                        <p class="text-muted">Create some questions first to see them here.</p>
                    </div>
                `;
            } else {
                container.innerHTML = questions.map((question, index) => `
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Question ${index + 1}</h6>
                            <div class="d-flex gap-2 align-items-center">
                                <span class="badge bg-${getDifficultyColor(question.difficulty)}">${question.difficulty || 'Easy'}</span>
                                <span class="badge bg-primary">${question.type || 'Multiple Choice'}</span>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteSavedQuestion('${question.id || index}', '${question.difficulty || 'Easy'}')" title="Delete this question">
                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text"><strong>Question:</strong> ${question.text || question.question || 'No question text'}</p>
                            ${question.type === 'multiple-choice' && question.options ? `
                                <div class="mb-2">
                                    <strong>Options:</strong>
                                    <ul class="list-unstyled mt-1">
                                        ${question.options.map((option, optIndex) => `
                                            <li class="d-flex align-items-center">
                                                <span class="badge bg-${optIndex === question.correctAnswer ? 'success' : 'secondary'} me-2">${String.fromCharCode(65 + optIndex)}</span>
                                                ${option}
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${question.correctAnswer ? `<p class="mb-0"><strong>Correct Answer:</strong> ${question.correctAnswer}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
        }

        // Display questions in modal
        function displayQuestionsInModal(questions, title) {
            const modalTitle = document.getElementById('questionsModalTitle');
            const container = document.getElementById('questionsDisplayContainer');
            
            modalTitle.innerHTML = `<iconify-icon icon="material-symbols:quiz" style="margin-right: 0.5rem;"></iconify-icon>${title} (${questions.length})`;
            
            if (questions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <iconify-icon icon="material-symbols:quiz" style="font-size: 4rem; color: #6c757d; margin-bottom: 1rem;"></iconify-icon>
                        <h5 class="text-muted">No questions found</h5>
                        <p class="text-muted">Create some questions first to see them here.</p>
                    </div>
                `;
            } else {
                container.innerHTML = questions.map((question, index) => `
                    <div class="card mb-3">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Question ${index + 1}</h6>
                            <div class="d-flex gap-2 align-items-center">
                                <span class="badge bg-${getDifficultyColor(question.difficulty)}">${question.difficulty || 'Easy'}</span>
                                <span class="badge bg-primary">${question.type || 'Multiple Choice'}</span>
                                <button type="button" class="btn btn-sm btn-outline-danger" onclick="deleteSavedQuestion('${question.id || index}', '${question.difficulty || 'Easy'}')" title="Delete this question">
                                    <iconify-icon icon="material-symbols:delete"></iconify-icon>
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <p class="card-text"><strong>Question:</strong> ${question.text || question.question || 'No question text'}</p>
                            ${question.type === 'multiple-choice' && question.options ? `
                                <div class="mb-2">
                                    <strong>Options:</strong>
                                    <ul class="list-unstyled mt-1">
                                        ${question.options.map((option, optIndex) => `
                                            <li class="d-flex align-items-center">
                                                <span class="badge bg-${optIndex === question.correctAnswer ? 'success' : 'secondary'} me-2">${String.fromCharCode(65 + optIndex)}</span>
                                                ${option}
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            ${question.correctAnswer ? `<p class="mb-0"><strong>Correct Answer:</strong> ${question.correctAnswer}</p>` : ''}
                        </div>
                    </div>
                `).join('');
            }
            
            const modal = new bootstrap.Modal(document.getElementById('questionsDisplayModal'));
            modal.show();
        }

        // Get difficulty color for badge
        function getDifficultyColor(difficulty) {
            switch(difficulty) {
                case 'Easy': return 'success';
                case 'Medium': return 'warning';
                case 'Hard': return 'danger';
                default: return 'secondary';
            }
        }

        // Delete currently added question (not yet saved)
        function deleteCurrentQuestion(questionId) {
            const questionElement = document.getElementById(`dailyPracticeQuestion-${questionId}`);
            if (questionElement) {
                questionElement.remove();
                updateDailyPracticeQuestionCount();
                
                // Show empty state if no questions left
                const container = document.getElementById('dailyPracticeQuestionsContainer');
                if (container && container.children.length === 0) {
                    container.innerHTML = '<div class="text-center text-muted py-4"><iconify-icon icon="material-symbols:quiz" style="font-size: 3rem; opacity: 0.3;"></iconify-icon><p class="mt-2">No questions being created. Click "Add Question" to start creating a new question!</p><p class="small">Use the filter buttons above to view saved questions by difficulty.</p></div>';
                }
            }
        }

        // Delete saved question from localStorage
        function deleteSavedQuestion(questionId, difficulty) {
            if (confirm(`Are you sure you want to delete this ${difficulty.toLowerCase()} question?`)) {
                const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
                const updatedQuestions = questions.filter(q => q.id != questionId);
                
                // Save updated questions
                localStorage.setItem('english_daily_practice_questions', JSON.stringify(updatedQuestions));
                localStorage.setItem('english_daily_practice_questions_student', JSON.stringify(updatedQuestions));
                
                // Refresh the modal display
                const currentTitle = document.getElementById('questionsModalTitle').textContent;
                if (currentTitle.includes('All Questions')) {
                    showAllQuestions();
                } else if (currentTitle.includes('Easy Questions')) {
                    showQuestionsByDifficulty('Easy');
                } else if (currentTitle.includes('Medium Questions')) {
                    showQuestionsByDifficulty('Medium');
                } else if (currentTitle.includes('Hard Questions')) {
                    showQuestionsByDifficulty('Hard');
                }
                
                // Update question count
                updateDailyPracticeQuestionCount();
                
                showToast('Question deleted successfully!', 'success');
            }
        }

        // Expose functions globally
        window.showAllQuestions = showAllQuestions;
        window.showQuestionsByDifficulty = showQuestionsByDifficulty;
        window.deleteCurrentQuestion = deleteCurrentQuestion;
        window.deleteSavedQuestion = deleteSavedQuestion;
        window.addDailyPracticeQuestion = addDailyPracticeQuestion;
        window.selectDailyPracticeQuestionType = selectDailyPracticeQuestionType;
        window.addDailyPracticeOption = addDailyPracticeOption;
        window.saveCurrentlyCreatingQuestions = saveCurrentlyCreatingQuestions;

        // Toggle questions visibility
        function toggleQuestionsVisibility() {
            const container = document.getElementById('dailyPracticeQuestionsContainer');
            const toggleBtn = document.getElementById('toggleQuestionsBtn');
            
            if (container.style.display === 'none') {
                container.style.display = 'block';
                toggleBtn.innerHTML = '<iconify-icon icon="material-symbols:visibility-off"></iconify-icon> Hide Questions';
            } else {
                container.style.display = 'none';
                toggleBtn.innerHTML = '<iconify-icon icon="material-symbols:visibility"></iconify-icon> Show Questions';
            }
        }

        // Delete individual question
        function deleteDailyPracticeQuestion(questionId) {
            if (confirm('Are you sure you want to delete this question?')) {
                const questionElement = document.getElementById(`dailyPracticeQuestion-${questionId}`);
                if (questionElement) {
                    questionElement.remove();
                    updateDailyPracticeQuestionCount();
                    showToast('Question deleted successfully!', 'success');
                }
            }
        }

        // Expose functions globally
        window.toggleQuestionsVisibility = toggleQuestionsVisibility;
        window.deleteDailyPracticeQuestion = deleteDailyPracticeQuestion;
        window.addDailyPracticeQuestions = addDailyPracticeQuestions;

        function updateQuestionStatistics(questions) {
            // Stats UI removed; safely no-op if elements do not exist
            const totalEl = document.getElementById('totalQuestionsCount');
            const easyEl = document.getElementById('easyQuestionsCount');
            const mediumEl = document.getElementById('mediumQuestionsCount');
            const hardEl = document.getElementById('hardQuestionsCount');

            if (!totalEl || !easyEl || !mediumEl || !hardEl) {
                return;
            }

            const total = questions.length;
            const easy = questions.filter(q => q.difficulty === 'Easy').length;
            const medium = questions.filter(q => q.difficulty === 'Medium').length;
            const hard = questions.filter(q => q.difficulty === 'Hard').length;
            
            totalEl.textContent = total;
            easyEl.textContent = easy;
            mediumEl.textContent = medium;
            hardEl.textContent = hard;
        }

        function generateDailyPracticeQuestions() {
            // Generate sample questions based on the selected type
            const sampleQuestions = [];
            
            if (currentDailyPracticeQuestionType === 'multiple-choice') {
                sampleQuestions.push({
                    question: "What is the correct form of the verb 'to be' in the present tense for 'he'?",
                    difficulty: "Easy",
                    topic: "Grammar",
                    points: 10,
                    type: "multiple-choice",
                    options: ["is", "are", "am", "be"],
                    answer: "is",
                    explanation: "The correct form of 'to be' for third person singular (he/she/it) is 'is'."
                });
            } else if (currentDailyPracticeQuestionType === 'short-answer') {
                sampleQuestions.push({
                    question: "Explain the difference between 'affect' and 'effect'.",
                    difficulty: "Medium",
                    topic: "Vocabulary",
                    points: 15,
                    type: "short-answer",
                    options: [],
                    answer: "Affect is a verb meaning to influence, while effect is a noun meaning a result.",
                    explanation: "Remember: Affect = Action (verb), Effect = End result (noun)."
                });
            } else if (currentDailyPracticeQuestionType === 'file-upload') {
                sampleQuestions.push({
                    question: "Write a short essay about your favorite book and upload it as a PDF.",
                    difficulty: "Hard",
                    topic: "Writing",
                    points: 25,
                    type: "file-upload",
                    options: ["pdf", "Please write at least 200 words and include specific examples from the book."],
                    answer: "",
                    explanation: "Focus on clear structure, specific examples, and personal insights."
                });
            }
            
            sampleQuestions.forEach(question => {
                addDailyPracticeQuestionToContainer(question, dailyPracticeQuestionCounter + 1);
            });
            
            showToast('Sample questions generated!', 'success');
        }

        function exportDailyPracticeQuestions() {
            const questions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            const dataStr = JSON.stringify(questions, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'english_daily_practice_questions.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importDailyPracticeQuestions() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const questions = JSON.parse(e.target.result);
                            localStorage.setItem('english_daily_practice_questions', JSON.stringify(questions));
                            loadDailyPracticeQuestions();
                            showToast('Questions imported successfully!', 'success');
                        } catch (error) {
                            showToast('Error importing questions. Please check the file format.', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllDailyPracticeQuestions() {
            if (confirm('Are you sure you want to clear all daily practice questions? This action cannot be undone.')) {
                localStorage.removeItem('english_daily_practice_questions');
                loadDailyPracticeQuestions();
                loadDailyQuestions(); // Also refresh the card display
                showToast('All questions cleared!', 'success');
            }
        }

        // Filter questions based on search and filters
        function filterQuestions() {
            const searchTerm = document.getElementById('questionSearch').value.toLowerCase();
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            const typeFilter = document.getElementById('typeFilter').value;
            const questions = document.querySelectorAll('.question-item');
            
            questions.forEach(question => {
                const questionText = question.querySelector('textarea[name="dailyPracticeQuestionText"]').value.toLowerCase();
                const topic = question.querySelector('input[name="dailyPracticeTopic"]').value.toLowerCase();
                const difficulty = question.getAttribute('data-difficulty');
                const type = question.getAttribute('data-question-type');
                
                const matchesSearch = questionText.includes(searchTerm) || topic.includes(searchTerm);
                const matchesDifficulty = !difficultyFilter || difficulty === difficultyFilter;
                const matchesType = !typeFilter || type === typeFilter;
                
                if (matchesSearch && matchesDifficulty && matchesType) {
                    question.style.display = 'block';
                } else {
                    question.style.display = 'none';
                }
            });
        }

        // Update bulk actions visibility
        function updateBulkActions() {
            const checkedBoxes = document.querySelectorAll('.question-checkbox:checked');
            const bulkActions = document.getElementById('bulkActions');
            
            if (checkedBoxes.length > 0) {
                bulkActions.style.display = 'flex';
            } else {
                bulkActions.style.display = 'none';
            }
        }

        // Delete selected questions
        function deleteSelectedQuestions() {
            const checkedBoxes = document.querySelectorAll('.question-checkbox:checked');
            if (checkedBoxes.length === 0) return;
            
            if (confirm(`Are you sure you want to delete ${checkedBoxes.length} selected questions?`)) {
                checkedBoxes.forEach(checkbox => {
                    const questionId = checkbox.value;
                    const questionElement = document.getElementById(`dailyPracticeQuestion-${questionId}`);
                    if (questionElement) {
                        questionElement.remove();
                    }
                });
                updateDailyPracticeQuestionCount();
                updateBulkActions();
                showToast(`${checkedBoxes.length} questions deleted successfully!`, 'success');
            }
        }

        // Export selected questions
        function exportSelectedQuestions() {
            const checkedBoxes = document.querySelectorAll('.question-checkbox:checked');
            if (checkedBoxes.length === 0) return;
            
            const allQuestions = JSON.parse(localStorage.getItem('english_daily_practice_questions') || '[]');
            const selectedQuestions = [];
            
            checkedBoxes.forEach(checkbox => {
                const questionId = checkbox.value;
                const questionElement = document.getElementById(`dailyPracticeQuestion-${questionId}`);
                if (questionElement) {
                    // Get question data from form
                    const questionText = questionElement.querySelector('textarea[name="dailyPracticeQuestionText"]').value.trim();
                    const difficulty = questionElement.querySelector('select[name="dailyPracticeDifficulty"]').value;
                    const topic = questionElement.querySelector('input[name="dailyPracticeTopic"]').value.trim();
                    const points = parseInt(questionElement.querySelector('input[name="dailyPracticePoints"]').value) || 10;
                    const type = questionElement.getAttribute('data-question-type');
                    
                    if (questionText && topic) {
                        selectedQuestions.push({
                            question: questionText,
                            difficulty: difficulty,
                            topic: topic,
                            points: points,
                            type: type
                        });
                    }
                }
            });
            
            if (selectedQuestions.length > 0) {
                const dataStr = JSON.stringify(selectedQuestions, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `selected-daily-practice-questions-${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
                showToast(`${selectedQuestions.length} questions exported successfully!`, 'success');
            }
        }

        // Clear selection
        function clearSelection() {
            document.querySelectorAll('.question-checkbox:checked').forEach(checkbox => {
                checkbox.checked = false;
            });
            updateBulkActions();
        }

        // Duplicate question
        function duplicateQuestion(questionId) {
            const questionElement = document.getElementById(`dailyPracticeQuestion-${questionId}`);
            if (questionElement) {
                const questionData = {
                    question: questionElement.querySelector('textarea[name="dailyPracticeQuestionText"]').value,
                    difficulty: questionElement.querySelector('select[name="dailyPracticeDifficulty"]').value,
                    topic: questionElement.querySelector('input[name="dailyPracticeTopic"]').value,
                    points: questionElement.querySelector('input[name="dailyPracticePoints"]').value,
                    type: questionElement.getAttribute('data-question-type')
                };
                
                addDailyPracticeQuestionToContainer(questionData, document.querySelectorAll('.question-item').length + 1);
                showToast('Question duplicated successfully!', 'success');
            }
        }

        // Preview questions
        function previewQuestions() {
            const questions = document.querySelectorAll('.question-item');
            if (questions.length === 0) {
                showToast('No questions to preview', 'warning');
                return;
            }
            
            // Create preview modal
            const previewModal = document.createElement('div');
            previewModal.className = 'modal fade';
            previewModal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Question Preview</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div id="previewContent"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(previewModal);
            const modal = new bootstrap.Modal(previewModal);
            
            // Generate preview content
            const previewContent = document.getElementById('previewContent');
            let previewHtml = '';
            
            questions.forEach((question, index) => {
                const questionText = question.querySelector('textarea[name="dailyPracticeQuestionText"]').value;
                const difficulty = question.querySelector('select[name="dailyPracticeDifficulty"]').value;
                const topic = question.querySelector('input[name="dailyPracticeTopic"]').value;
                const points = question.querySelector('input[name="dailyPracticePoints"]').value;
                const type = question.getAttribute('data-question-type');
                
                if (questionText) {
                    previewHtml += `
                        <div class="card mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">Question ${index + 1}</h6>
                                <div>
                                    <span class="badge bg-primary me-1">${type}</span>
                                    <span class="badge bg-${difficulty === 'Easy' ? 'success' : difficulty === 'Medium' ? 'warning' : 'danger'}">${difficulty}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <p><strong>Topic:</strong> ${topic} | <strong>Points:</strong> ${points}</p>
                                <p>${questionText}</p>
                                ${type === 'multiple-choice' ? '<p><em>Multiple choice options would appear here</em></p>' : ''}
                                ${type === 'short-answer' ? '<p><em>Text input field would appear here</em></p>' : ''}
                                ${type === 'file-upload' ? '<p><em>File upload field would appear here</em></p>' : ''}
                            </div>
                        </div>
                    `;
                }
            });
            
            previewContent.innerHTML = previewHtml || '<p class="text-muted">No questions to preview</p>';
            
            modal.show();
            
            // Clean up modal after it's hidden
            previewModal.addEventListener('hidden.bs.modal', () => {
                document.body.removeChild(previewModal);
            });
        }
        
        function navigateToPastPapers() {
            loadPastPapersData();
            const modal = new bootstrap.Modal(document.getElementById('pastPapersModal'));
            modal.show();
        }

        // Past Papers Management Functions
        function loadPastPapersData() {
            loadYearsList();
            document.getElementById('selectedYearDisplay').textContent = 'Select a year';
            document.getElementById('categoriesContainer').innerHTML = `
                <div class="text-center py-5">
                    <iconify-icon icon="material-symbols:calendar-today" style="font-size: 4rem; color: #cbd5e1;"></iconify-icon>
                    <h4 class="mt-3" style="color: #64748b;">Select a year to view categories</h4>
                    <p class="text-muted">Choose a year from the left sidebar to see available paper categories</p>
                </div>
            `;
        }

        function loadYearsList() {
            const years = [2025, 2024, 2023, 2022, 2021, 2020, 2019, 2018];
            const yearsList = document.getElementById('yearsList');
            
            const yearsHtml = years.map(year => `
                <a href="#" class="list-group-item list-group-item-action year-item" onclick="selectYear(${year})" style="border: none; border-left: 3px solid transparent; transition: all 0.3s ease;">
                    <div class="d-flex align-items-center">
                        <iconify-icon icon="material-symbols:calendar-month" style="margin-right: 0.75rem; color: #8b5cf6;"></iconify-icon>
                        <div>
                            <div style="font-weight: 600; color: #1e293b;">${year}</div>
                            <div style="font-size: 0.8rem; color: #64748b;">English papers</div>
                        </div>
                    </div>
                </a>
            `).join('');
            
            yearsList.innerHTML = yearsHtml;
        }

        function selectYear(year) {
            // Update active year styling
            document.querySelectorAll('.year-item').forEach(item => {
                item.classList.remove('active');
                item.style.borderLeftColor = 'transparent';
                item.style.backgroundColor = 'transparent';
            });
            
            event.currentTarget.classList.add('active');
            event.currentTarget.style.borderLeftColor = '#8b5cf6';
            event.currentTarget.style.backgroundColor = 'rgba(139, 92, 246, 0.05)';
            
            // Update header
            document.getElementById('selectedYearDisplay').textContent = `English Past Papers ${year}`;
            
            // Load categories for selected year
            loadCategoriesForYear(year);
        }

        function loadCategoriesForYear(year) {
            const categories = [
                { id: 'paper1', name: 'IGCSE English Paper 1', description: 'Reading', icon: 'menu_book' },
                { id: 'paper2', name: 'IGCSE English Paper 2', description: 'Writing', icon: 'edit' }
            ];
            
            const categoriesContainer = document.getElementById('categoriesContainer');
            
            const categoriesHtml = categories.map(category => `
                <div class="category-card mb-3" style="border: 1px solid #e2e8f0; border-radius: 12px; padding: 1.5rem; background: white; transition: all 0.3s ease;" onmouseover="this.style.boxShadow='0 8px 25px rgba(0,0,0,0.1)'" onmouseout="this.style.boxShadow='none'">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div class="d-flex align-items-center">
                            <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 1rem;">
                                <iconify-icon icon="material-symbols:${category.icon}" style="font-size: 1.5rem; color: white;"></iconify-icon>
                            </div>
                            <div>
                                <h5 class="mb-1" style="color: #1e293b; font-weight: 700;">${category.name}</h5>
                                <p class="mb-0" style="color: #64748b; font-size: 0.9rem;">${year}  ${category.description}</p>
                            </div>
                        </div>
                        <div class="badge" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
                            ${getCategoryFileCount(year, category.id)} files
                        </div>
                    </div>
                    
                    <!-- Upload Area -->
                    <div class="upload-area" style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 2rem; text-align: center; background: #f8fafc; transition: all 0.3s ease;" 
                         ondrop="handleDrop(event, ${year}, '${category.id}')" 
                         ondragover="handleDragOver(event)" 
                         ondragleave="handleDragLeave(event)">
                        <iconify-icon icon="material-symbols:cloud-upload" style="font-size: 3rem; color: #cbd5e1; margin-bottom: 1rem;"></iconify-icon>
                        <h6 style="color: #64748b; margin-bottom: 0.5rem;">Drop files here or click to upload</h6>
                        <p style="color: #94a3b8; font-size: 0.85rem; margin-bottom: 1rem;">PDF, DOC, DOCX files (Max 10MB)</p>
                        <input type="file" id="fileInput-${year}-${category.id}" multiple accept=".pdf,.doc,.docx" style="display: none;" onchange="handleFileSelect(event, ${year}, '${category.id}')">
                        <button class="btn btn-sm" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; border: none; border-radius: 6px;" onclick="document.getElementById('fileInput-${year}-${category.id}').click()">
                            <iconify-icon icon="material-symbols:upload" style="margin-right: 0.5rem;"></iconify-icon>
                            Choose Files
                        </button>
                    </div>
                    
                    <!-- Files List -->
                    <div id="files-${year}-${category.id}" class="files-list mt-3">
                        <!-- Files will be displayed here -->
                    </div>
                </div>
            `).join('');
            
            categoriesContainer.innerHTML = categoriesHtml;
            
            // Load existing files for each category
            categories.forEach(category => {
                loadFilesForCategory(year, category.id);
            });
        }

        function getCategoryFileCount(year, categoryId) {
            const storageKey = `pastPapers_${year}_${categoryId}`;
            const files = JSON.parse(localStorage.getItem(storageKey) || '[]');
            return files.length;
        }

        function loadFilesForCategory(year, categoryId) {
            const storageKey = `pastPapers_${year}_${categoryId}`;
            const files = JSON.parse(localStorage.getItem(storageKey) || '[]');
            const filesContainer = document.getElementById(`files-${year}-${categoryId}`);
            
            if (files.length === 0) {
                filesContainer.innerHTML = `
                    <div class="text-muted text-center py-2">
                        <small>No files uploaded yet</small>
                    </div>
                `;
                return;
            }
            
            const filesHtml = files.map((file, index) => `
                <div class="file-item d-flex align-items-center justify-content-between p-2 mb-2" style="background: #f8fafc; border-radius: 6px; border: 1px solid #e2e8f0;">
                    <div class="d-flex align-items-center">
                        <iconify-icon icon="material-symbols:description" style="color: #8b5cf6; margin-right: 0.5rem;"></iconify-icon>
                        <div>
                            <div style="font-size: 0.9rem; font-weight: 500; color: #1e293b;">${file.name}</div>
                            <div style="font-size: 0.75rem; color: #64748b;">${formatFileSize(file.size)}  ${new Date(file.uploadedAt).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        <button class="btn btn-sm btn-outline-primary" onclick="downloadFile('${file.url}', '${file.name}')">
                            <iconify-icon icon="material-symbols:download" style="font-size: 1rem;"></iconify-icon>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteFile(${year}, '${categoryId}', ${index})">
                            <iconify-icon icon="material-symbols:delete" style="font-size: 1rem;"></iconify-icon>
                        </button>
                    </div>
                </div>
            `).join('');
            
            filesContainer.innerHTML = filesHtml;
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.style.borderColor = '#8b5cf6';
            event.currentTarget.style.background = 'rgba(139, 92, 246, 0.05)';
        }

        function handleDragLeave(event) {
            event.currentTarget.style.borderColor = '#cbd5e1';
            event.currentTarget.style.background = '#f8fafc';
        }

        function handleDrop(event, year, categoryId) {
            event.preventDefault();
            event.currentTarget.style.borderColor = '#cbd5e1';
            event.currentTarget.style.background = '#f8fafc';
            
            const files = event.dataTransfer.files;
            handleFiles(files, year, categoryId);
        }

        function handleFileSelect(event, year, categoryId) {
            const files = event.target.files;
            handleFiles(files, year, categoryId);
        }

        function handleFiles(files, year, categoryId) {
            const storageKey = `pastPapers_${year}_${categoryId}`;
            const existingFiles = JSON.parse(localStorage.getItem(storageKey) || '[]');
            
            Array.from(files).forEach(file => {
                // Validate file type
                if (!file.name.match(/\.(pdf|doc|docx)$/i)) {
                    showToast(`Invalid file type: ${file.name}. Only PDF, DOC, and DOCX files are allowed.`, 'error');
                    return;
                }
                
                // Validate file size (10MB max)
                if (file.size > 10 * 1024 * 1024) {
                    showToast(`File too large: ${file.name}. Maximum file size is 10MB.`, 'error');
                    return;
                }
                
                // Create file object
                const fileObj = {
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    uploadedAt: new Date().toISOString(),
                    url: URL.createObjectURL(file) // In a real app, this would be uploaded to a server
                };
                
                existingFiles.push(fileObj);
            });
            
            // Save to localStorage
            localStorage.setItem(storageKey, JSON.stringify(existingFiles));
            
            // Refresh files display
            loadFilesForCategory(year, categoryId);
            
            // Show success message
            showToast(`Successfully uploaded ${files.length} file(s) to ${categoryId}`, 'success');
        }

        function downloadFile(url, filename) {
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        function deleteFile(year, categoryId, fileIndex) {
            if (confirm('Are you sure you want to delete this file?')) {
                const storageKey = `pastPapers_${year}_${categoryId}`;
                const files = JSON.parse(localStorage.getItem(storageKey) || '[]');
                
                files.splice(fileIndex, 1);
                localStorage.setItem(storageKey, JSON.stringify(files));
                
                loadFilesForCategory(year, categoryId);
                showToast('File deleted successfully', 'success');
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function refreshPastPapersData() {
            loadPastPapersData();
            showToast('Past papers data refreshed', 'info');
        }

        // Open Flashcards Modal
        function openFlashcardsModal() {
            showToast('Flashcards feature coming soon!', 'info');
        }
    </script>
</body>
</html>
