<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Physics Homework - IG Nation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.css">
  <style>
    /* ✅ Your same styles kept exactly */
    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0 !important;
      padding: 0 !important;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #F8F8F8;
      min-height: 100vh;
    }

    .homework-header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      padding: 1rem 2rem;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .homework-logo {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: #333;
      margin-left: 70px;
    }

    .homework-logo img {
      height: 40px;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, .1));
      transition: .3s;
    }

    .homework-logo:hover img {
      transform: scale(1.05);
    }

    .subject-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: .25rem .75rem;
      border-radius: 20px;
      font-size: .8rem;
      font-weight: 600;
      margin-left: 1rem;
    }

    .homework-nav {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .nav-btn {
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: .5rem 1rem;
      color: #333;
      text-decoration: none;
      font-weight: 500;
      transition: .3s;
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .nav-btn:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .main-content {
      margin-top: 100px;
      padding: 2rem;
    }

    .homework-hero {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 1.5rem 2.5rem;
      border-radius: 16px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
      position: relative;
      overflow: hidden;
    }

    .homework-hero::before {
      content: '';
      position: absolute;
      top: -50px;
      right: -50px;
      width: 150px;
      height: 150px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
    }

    .homework-hero::after {
      content: '';
      position: absolute;
      bottom: -30px;
      left: -30px;
      width: 100px;
      height: 100px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
    }

    .hero-left {
      position: relative;
      z-index: 1;
    }

    .hero-left h2 {
      font-size: 1.75rem;
      font-weight: 700;
      color: white;
      margin: 0 0 0.35rem 0;
      letter-spacing: -0.5px;
    }

    .hero-left p {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.85);
      margin: 0;
      font-weight: 400;
    }

    .homework-stats {
      display: flex;
      gap: 2.5rem;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .stat-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.35rem;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 1rem 1.75rem;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-3px);
    }

    .stat-number {
      font-size: 2.25rem;
      font-weight: 800;
      color: white;
      line-height: 1;
    }

    .stat-label {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.85);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .homework-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .homework-card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      transition: .3s;
      border-left: 4px solid #667eea;
    }

    .homework-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    .homework-card-header {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }

    .homework-icon {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 1rem;
      font-size: 1.5rem;
      color: white;
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    }

    .homework-card-title {
      font-size: 1.25rem;
      font-weight: 700;
      color: #333;
      margin-bottom: .5rem;
    }

    .homework-card-description {
      color: #666;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .homework-details {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: .5rem;
    }

    .detail-label {
      font-weight: 600;
      color: #333;
    }

    .detail-value {
      color: #666;
    }

    .homework-actions {
      display: flex;
      gap: 1rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
      border: none;
      border-radius: 8px;
      padding: .75rem 1.5rem;
      color: white;
      font-weight: 600;
      transition: .3s;
      flex: 1;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
    }

    .btn-outline {
      background: transparent;
      border: 2px solid #27ae60;
      border-radius: 8px;
      padding: .75rem 1.5rem;
      color: #27ae60;
      font-weight: 600;
      transition: .3s;
      flex: 1;
    }

    .btn-outline:hover {
      background: #27ae60;
      color: white;
    }

    .status-badge {
      display: inline-block;
      padding: .25rem .75rem;
      border-radius: 20px;
      font-size: .8rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    .status-pending {
      background: #fff3cd;
      color: #856404;
    }

    .status-completed {
      background: #d4edda;
      color: #155724;
    }

    .status-overdue {
      background: #f8d7da;
      color: #721c24;
    }

    .homework-filters {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
      border: 1px solid rgba(0, 0, 0, 0.06);
      position: relative;
      overflow: hidden;
    }

    .homework-filters::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
    }

    /* Header Section */
    .filters-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #f1f3f4;
    }

    .filters-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .filters-title h3 {
      margin: 0;
      color: #2c3e50;
      font-weight: 600;
      font-size: 1.1rem;
    }

    .filters-icon {
      font-size: 1.2rem;
      color: #667eea;
    }

    .filter-stats {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* Controls Section */
    .filters-controls {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
      align-items: center;
      justify-content: space-between;
    }

    .search-section {
      min-width: 200px;
      max-width: 300px;
    }

    .search-box {
      position: relative;
      display: flex;
      align-items: center;
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      transition: all 0.3s ease;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    }

    .search-box:focus-within {
      border-color: #667eea;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
    }

    .search-icon {
      color: #6c757d;
      font-size: 1rem;
      margin-right: 0.5rem;
    }

    .search-input {
      border: none;
      outline: none;
      flex: 1;
      font-size: 0.9rem;
      color: #2c3e50;
    }

    .search-input::placeholder {
      color: #adb5bd;
    }

    .search-clear {
      background: none;
      border: none;
      color: #6c757d;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .search-clear:hover {
      background: #f8f9fa;
      color: #495057;
    }

    .sort-section {
      min-width: 160px;
    }

    .sort-dropdown {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: white;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 0.5rem 0.75rem;
      transition: all 0.3s ease;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    }

    .sort-dropdown:hover {
      border-color: #667eea;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.15);
    }

    .sort-icon {
      color: #6c757d;
      font-size: 1rem;
    }

    .sort-label {
      color: #6c757d;
      font-weight: 500;
      font-size: 0.8rem;
    }

    .sort-selector {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      cursor: pointer;
      flex: 1;
    }

    .sort-value {
      color: #2c3e50;
      font-weight: 600;
      font-size: 0.85rem;
    }

    .sort-arrow {
      color: #6c757d;
      font-size: 0.9rem;
      transition: transform 0.2s ease;
    }

    .sort-selector:hover .sort-arrow {
      transform: rotate(180deg);
    }

    .sort-clear {
      background: none;
      border: none;
      color: #6c757d;
      cursor: pointer;
      padding: 0.25rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .sort-clear:hover {
      background: #f8f9fa;
      color: #495057;
    }

    /* Category Filters */
    .category-filters {
      margin-bottom: 1rem;
    }

    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      gap: 1rem;
    }

    .category-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #2c3e50;
      font-weight: 600;
      font-size: 0.95rem;
    }

    .category-icon {
      color: #667eea;
      font-size: 1.1rem;
    }


    .filter-tabs {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-tab {
      padding: 0.5rem 1rem;
      border: 1px solid #e9ecef;
      background: white;
      color: #6c757d;
      font-weight: 500;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.8rem;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
    }

    .filter-tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s;
    }

    .filter-tab:hover::before {
      left: 100%;
    }

    .filter-tab:hover {
      border-color: #667eea;
      color: #667eea;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.15);
    }

    .filter-tab.active {
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-color: #667eea;
      color: white;
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
    }

    .filter-tab.active::before {
      display: none;
    }


    /* Responsive Design */
    @media (max-width: 768px) {
      .filters-controls {
        flex-direction: column;
        gap: 1rem;
      }

      .sort-section {
        min-width: auto;
        width: 100%;
      }

      .category-header {
        flex-direction: column;
        align-items: stretch;
        gap: 0.75rem;
      }

      .search-section {
        min-width: auto;
        width: 100%;
      }
    }

    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    transition: left 0.3s ease;
    z-index: -1;
    }

    .filter-tab.active {
      color: white;
      border-color: #667eea;
    }

    .filter-tab.active::before {
      left: 0;
    }

    .filter-tab:hover {
      border-color: #667eea;
      color: #667eea;
      transform: translateY(-1px);
    }

    .filter-tab.active:hover {
      color: white;
    }

    .search-box {
      position: relative;
      max-width: 300px;
      flex: 0 0 300px;
      min-width: 250px;
    }

    .search-input {
      width: 100%;
      padding: 0.875rem 1rem 0.875rem 3rem;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      font-size: 0.95rem;
      background: #f8f9fa;
      transition: all 0.3s ease;
      font-weight: 400;
    }

    .search-input:focus {
      outline: none;
      border-color: #667eea;
      background: white;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .search-input::placeholder {
      color: #adb5bd;
      font-weight: 400;
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: #6c757d;
      font-size: 1.1rem;
      transition: color 0.3s ease;
    }

    .search-input:focus+.search-icon {
      color: #667eea;
    }


    /* Question Modal Styles */
    .question-card {
      background: white;
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }

    .question-text {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: #333;
    }

    .question-options {
      margin-bottom: 1.5rem;
    }

    .option-item {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
      padding: 1rem;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      cursor: pointer;
      transition: .3s;
    }

    .option-item:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .option-item.selected {
      border-color: #667eea;
      background: #f0f4ff;
    }

    .option-radio {
      margin-right: 1rem;
    }

    .option-text {
      flex: 1;
      font-size: 1rem;
    }

    .question-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .progress-bar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .timer {
      font-weight: 600;
      color: #667eea;
    }

    /* Assignment Stopwatch Styles */
    .assignment-stopwatch {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1050;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 16px 24px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-width: 280px;
      animation: slideInDown 0.5s ease-out;
    }

    .stopwatch-container {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .stopwatch-icon {
      font-size: 28px;
      opacity: 0.9;
    }

    .stopwatch-content {
      flex: 1;
      text-align: center;
    }

    .stopwatch-label {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .stopwatch-display {
      font-size: 24px;
      font-weight: 700;
      font-family: 'Courier New', monospace;
      letter-spacing: 1px;
    }

    .stopwatch-actions {
      display: flex;
      gap: 8px;
    }

    .stopwatch-actions .btn {
      width: 32px;
      height: 32px;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .stopwatch-actions .btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.1);
    }

    @keyframes slideInDown {
      from {
        transform: translateX(-50%) translateY(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    @keyframes pulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.05);
      }
    }

    /* Autocorrect Styles */
    .correct-answer {
      border-color: #28a745 !important;
      background: #d4edda !important;
    }

    .correct-selected {
      border-color: #28a745 !important;
      background: #d4edda !important;
      box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.25) !important;
    }

    .incorrect-selected {
      border-color: #dc3545 !important;
      background: #f8d7da !important;
      box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.25) !important;
    }

    .option-item.disabled {
      pointer-events: none;
      opacity: 0.7;
    }

    /* Question Action Buttons */
    .question-actions {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 8px;
      border: 1px solid #e9ecef;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .action-buttons .btn {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.875rem;
      padding: 8px 12px;
      border-radius: 6px;
      transition: all 0.3s ease;
    }

    .action-buttons .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    .action-buttons .btn-outline-primary:hover {
      background: #007bff;
      color: white;
    }

    .action-buttons .btn-outline-success:hover {
      background: #28a745;
      color: white;
    }

    .action-buttons .btn-outline-warning:hover {
      background: #ffc107;
      color: #212529;
    }

    /* Enhanced styling for the remaining three action buttons */
    .enhanced-action-btn {
      border-radius: 25px !important;
      padding: 10px 16px !important;
      font-weight: 600 !important;
      font-size: 0.85rem !important;
      border: 2px solid transparent !important;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1) !important;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
      position: relative !important;
      overflow: hidden !important;
      width: 140px !important;
      height: 40px !important;
      text-align: center !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      white-space: nowrap !important;
    }

    .enhanced-action-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .enhanced-action-btn:hover::before {
      left: 100%;
    }

    .enhanced-action-btn:hover {
      transform: translateY(-3px) scale(1.05) !important;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2) !important;
    }

    .enhanced-action-btn:active {
      transform: translateY(-1px) scale(1.02) !important;
    }

    /* Specific styling for each button */
    .enhanced-action-btn.btn-primary {
      background: linear-gradient(135deg, #007bff, #0056b3) !important;
      border-color: #007bff !important;
    }

    .enhanced-action-btn.btn-info {
      background: linear-gradient(135deg, #17a2b8, #138496) !important;
      border-color: #17a2b8 !important;
    }

    .enhanced-action-btn.btn-warning {
      background: linear-gradient(135deg, #ffc107, #e0a800) !important;
      border-color: #ffc107 !important;
      color: #212529 !important;
    }

    .enhanced-action-btn iconify-icon {
      font-size: 1.1rem !important;
      margin-right: 6px !important;
    }

    /* Review Modal Styles */
    .assignment-review {
      background: white;
    }

    .review-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    /* Modern Question Review Styles */
    .question-review-item {
      background: white;
      border: none;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 2rem;
      padding: 2rem;
    }

    .question-text {
      font-size: 1.1rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 1.5rem;
      line-height: 1.6;
    }

    .answer-option {
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      cursor: default;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .answer-option.correct {
      background: #d4edda;
      border-color: #28a745;
      color: #155724;
    }

    .answer-option.incorrect {
      background: #f8d7da;
      border-color: #dc3545;
      color: #721c24;
    }

    .answer-option.user-selected {
      border-width: 3px;
      font-weight: 600;
    }

    .option-radio {
      width: 18px;
      height: 18px;
      border: 2px solid #6c757d;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .option-radio.checked {
      background: #007bff;
      border-color: #007bff;
    }

    .option-radio.checked::after {
      content: '';
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
    }

    .option-radio.correct {
      background: #28a745;
      border-color: #28a745;
    }

    .option-radio.incorrect {
      background: #dc3545;
      border-color: #dc3545;
    }

    .points-display {
      color: #6c757d;
      font-size: 0.9rem;
      font-weight: 500;
    }

    .answer-content {
      font-family: monospace;
      white-space: pre-wrap;
      background: white;
    }

    .teacher-comments .answer-content {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
    }

    .sample-answer .answer-content {
      background: #e8f5e8;
      border-left: 4px solid #4caf50;
    }

    /* Notification Styles */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      padding: 12px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideDown 0.3s ease-out;
    }

    .notification-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .notification-info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .notification-content {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    @keyframes slideDown {
      from {
        transform: translateX(-50%) translateY(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }

    /* Responsive Design for Hero and Filters */
    @media (max-width: 768px) {
      .homework-hero {
        padding: 1.5rem 1rem;
        margin-bottom: 1.25rem;
      }

      .homework-title {
        font-size: 1.75rem;
      }

      .homework-subtitle {
        font-size: 0.95rem;
        margin-bottom: 1.25rem;
      }

      .homework-stats {
        gap: 1.25rem;
        margin-top: 1.25rem;
      }

      .stat-item {
        min-width: 90px;
        padding: 0.6rem;
      }

      .stat-number {
        font-size: 1.4rem;
      }

      .stat-label {
        font-size: 0.75rem;
      }

      .homework-filters {
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }

      .filters-row {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }

      .filter-tabs {
        justify-content: center;
        gap: 0.25rem;
        margin-top: 1rem;
      }

      .filter-tab {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
      }

      .search-box {
        max-width: 100%;
        min-width: auto;
      }
    }

    @media (max-width: 480px) {
      .homework-hero {
        padding: 1.25rem 0.75rem;
      }

      .homework-title {
        font-size: 1.5rem;
      }

      .homework-stats {
        gap: 0.75rem;
        flex-direction: column;
        align-items: center;
      }

      .stat-item {
        width: 100%;
        max-width: 180px;
        padding: 0.5rem;
      }

      .filter-tabs {
        flex-direction: column;
        width: 100%;
      }

      .filter-tab {
        text-align: center;
        width: 100%;
      }
    }

    .predefined-bullet-points {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 0.5rem;
    }

    .predefined-bullet-points .form-check {
      margin-bottom: 0.5rem;
    }

    .predefined-bullet-points .form-check-input {
      margin-top: 0.25rem;
    }

    .predefined-bullet-points .form-check-label {
      font-size: 0.95rem;
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <!-- Back Button - Fixed Position -->
  <button class="back-button" onclick="history.back()" title="Back"
    style="position: fixed !important; top: 19px !important; left: 20px !important; z-index: 1001 !important; background: rgba(255, 255, 255, 0.95); border: none; border-radius: 50%; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; backdrop-filter: blur(10px); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); transition: all 0.3s ease;"
    onmouseover="this.style.background='rgba(255, 255, 255, 1)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0,0,0,0.15)'"
    onmouseout="this.style.background='rgba(255, 255, 255, 0.95)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)'">
    <iconify-icon icon="material-symbols:arrow-back" style="font-size: 1.5rem; color: #667eea;"></iconify-icon>
  </button>

  <!-- Header -->
  <div class="homework-header">
    <a href="physics-dashboard.html" class="homework-logo">
      <img src="images/ig-nation-logo-graduation.png" alt="IG Nation">
    </a>
    <div class="homework-nav">
      <a href="physics-quizzes.html" class="nav-btn"><iconify-icon
          icon="material-symbols:quiz"></iconify-icon>Quizzes</a>
      <a href="physics-exams.html" class="nav-btn"><iconify-icon icon="material-symbols:quiz"></iconify-icon>Exams</a>
      <a href="course-assistants-chat.html?course=physics" class="assistant-btn"
        style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 25px; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); display: flex; align-items: center; gap: 0.5rem;"
        onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 6px 20px rgba(102, 126, 234, 0.4)'"
        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'"><iconify-icon
          icon="material-symbols:chat"></iconify-icon>Ask Assistant</a>
    </div>
  </div>

  <!-- Assignment Stopwatch (positioned above modal) -->
  <div id="assignmentStopwatch" class="assignment-stopwatch" style="display: none;">
    <div class="stopwatch-container">
      <div class="stopwatch-icon">
        <iconify-icon icon="material-symbols:timer"></iconify-icon>
      </div>
      <div class="stopwatch-content">
        <div class="stopwatch-label">Assignment Time</div>
        <div class="stopwatch-display" id="stopwatchDisplay">00:00:00</div>
      </div>
      <div class="stopwatch-actions">
        <button class="btn btn-sm btn-outline-light" onclick="pauseStopwatch()" id="pauseBtn">
          <iconify-icon icon="material-symbols:pause"></iconify-icon>
        </button>
        <button class="btn btn-sm btn-outline-light" onclick="resumeStopwatch()" id="resumeBtn" style="display: none;">
          <iconify-icon icon="material-symbols:play-arrow"></iconify-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Main -->
  <div class="main-content">
    <div class="homework-hero">
      <div class="hero-left">
        <h2>Physics Homework</h2>
        <p>Practice exercises and assignments</p>
      </div>
      <div class="homework-stats">
        <div class="stat-item">
          <div class="stat-number" id="totalHomework">5</div>
          <div class="stat-label">Total</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="pendingHomework">5</div>
          <div class="stat-label">Pending</div>
        </div>
      </div>
    </div>

    <!-- Enhanced Filters -->
    <div class="homework-filters">
      <!-- Header Section -->
      <div class="filters-header">
        <div class="filters-title">
          <iconify-icon icon="material-symbols:tune" class="filters-icon"></iconify-icon>
          <h3>Assignment Filters</h3>
        </div>
        <div class="filter-stats">
        </div>
      </div>

      <!-- Sort Section -->
      <div class="filters-controls">
        <div class="sort-section">
          <div class="sort-dropdown">
            <iconify-icon icon="material-symbols:sort" class="sort-icon"></iconify-icon>
            <span class="sort-label">Sort by:</span>
            <div class="sort-selector" onclick="showSortOptions()">
              <span class="sort-value" id="currentSort">Deadline</span>
              <iconify-icon icon="material-symbols:keyboard-arrow-down" class="sort-arrow"></iconify-icon>
            </div>
            <button class="sort-clear" onclick="clearSort()" id="sortClearBtn" style="display: none;">
              <iconify-icon icon="material-symbols:close"></iconify-icon>
            </button>
          </div>
        </div>
        <div class="search-section">
          <div class="search-box">
            <iconify-icon icon="material-symbols:search" class="search-icon"></iconify-icon>
            <input type="text" class="search-input" placeholder="Search assignments..." id="homeworkSearch">
            <button class="search-clear" onclick="clearSearch()" id="searchClearBtn" style="display: none;">
              <iconify-icon icon="material-symbols:close"></iconify-icon>
            </button>
          </div>
        </div>
      </div>

      <!-- Category Filters and Search -->
      <div class="category-filters">
        <div class="category-header">
          <div class="category-title">
            <iconify-icon icon="material-symbols:category" class="category-icon"></iconify-icon>
            <span>Categories</span>
          </div>
        </div>
        <div class="filter-tabs" id="filterTabs">
          <button class="filter-tab active" onclick="filterHomework('all',event)">
            <iconify-icon icon="material-symbols:apps"></iconify-icon>
            All Assignments
          </button>
          <button class="filter-tab" onclick="filterHomework('algebra',event)">
            <iconify-icon icon="material-symbols:functions"></iconify-icon>
            Algebra
          </button>
          <button class="filter-tab" onclick="filterHomework('geometry',event)">
            <iconify-icon icon="material-symbols:straighten"></iconify-icon>
            Geometry
          </button>
          <button class="filter-tab" onclick="filterHomework('calculus',event)">
            <iconify-icon icon="material-symbols:calculate"></iconify-icon>
            Calculus
          </button>
          <button class="filter-tab" onclick="filterHomework('statistics',event)">
            <iconify-icon icon="material-symbols:bar-chart"></iconify-icon>
            Statistics
          </button>
        </div>
      </div>

      <!-- Hidden sort select for functionality -->
      <select id="sortSelect" style="display: none;" onchange="sortHomework()">
        <option value="deadline-asc">Deadline (Nearest First)</option>
        <option value="default">Latest Added</option>
        <option value="deadline-desc">Deadline (Latest First)</option>
        <option value="title-asc">Title (A-Z)</option>
        <option value="title-desc">Title (Z-A)</option>
        <option value="points-asc">Points (Low to High)</option>
        <option value="points-desc">Points (High to Low)</option>
      </select>
    </div>

    <div class="homework-grid" id="homeworkGrid"></div>
  </div>

  <!-- Question Viewing Modal -->
  <div class="modal fade" id="questionModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="questionModalTitle">Assignment Questions</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="question-progress mb-4">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="text-muted">Question <span id="currentQuestionNum">1</span> of <span
                  id="totalQuestions">0</span></span>
              <div class="question-progress-info">
                <span class="text-muted">Assignment in Progress</span>
              </div>
            </div>
            <div class="progress">
              <div class="progress-bar" id="progressBar" style="width: 0%"></div>
            </div>
            <div id="timeProgress" class="mt-2" style="display: none;">
              <div class="progress" style="height: 6px;">
                <div class="progress-bar bg-warning" id="timeProgressBar" style="width: 100%"></div>
              </div>
            </div>
          </div>

          <div id="questionContainer">
            <!-- Questions will be loaded here -->
          </div>

          <div class="question-navigation mt-4">
            <button class="btn btn-outline-secondary" id="prevBtn" onclick="previousQuestion()" disabled>
              <iconify-icon icon="material-symbols:arrow-back"></iconify-icon>
              Previous
            </button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()">
              Next
              <iconify-icon icon="material-symbols:arrow-forward"></iconify-icon>
            </button>
            <button class="btn btn-success" id="submitBtn" onclick="submitAssignment()" style="display: none;">
              <iconify-icon icon="material-symbols:check"></iconify-icon>
              Submit Assignment
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/iconify-icon@1.0.7/dist/iconify-icon.min.js"></script>
  <script src="js/notifications.js"></script>
  <script>
    let homework = [];
    let currentFilter = 'all';

    // Function to clear all quizzes, assignments, and exams
    function clearPhysicsAcademicData() {
      // Clear quizzes
      localStorage.removeItem('physicsQuizzes');
      localStorage.removeItem('physicsTeacherQuizzes');
      localStorage.removeItem('physicsQuizzesList');

      // Clear assignments (homeworks)
      localStorage.removeItem('physicsAssignments');
      localStorage.removeItem('physicsTeacherAssignments');
      localStorage.removeItem('physicsAssignmentsList');

      // Clear exams
      localStorage.removeItem('physicsExams');
      localStorage.removeItem('physicsTeacherExams');
      localStorage.removeItem('physicsExamsList');

      // Clear assessments (used by the new system)
      localStorage.removeItem('physicsAssessments');

      console.log('✅ Cleared all physics quizzes, assignments, and exams from localStorage');
    }

    document.addEventListener('DOMContentLoaded', () => {
      console.log('Page loaded, starting homework loading...');

      // Only clear data on first visit (if flag doesn't exist)
      if (!localStorage.getItem('physicsAcademicDataCleared')) {
        clearPhysicsAcademicData();
        localStorage.setItem('physicsAcademicDataCleared', 'true');
      }

      // Debug: Check what's in localStorage
      console.log('=== DEBUGGING HOMEWORK PAGE ===');
      console.log('physicsAssignments:', localStorage.getItem('physicsAssignments'));
      console.log('physicsTeacherAssignments:', localStorage.getItem('physicsTeacherAssignments'));

      loadHomework();
      updateStats();
      document.getElementById('homeworkSearch').addEventListener('input', searchHomework);

      // Debug: Create a test assignment if none exist
      const existingAssignments = JSON.parse(localStorage.getItem('physicsAssignments')) || [];
      if (existingAssignments.length === 0) {
        console.log('No assignments found, creating test assignment...');
        const testAssignment = {
          id: 'test-assignment-1',
          title: 'Test Assignment',
          description: 'This is a test assignment to verify the system works.',
          points: 20,
          difficulty: 'medium',
          status: 'pending',
          dueDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
          subject: 'mathematics',
          published: true,
          questions: [
            {
              id: 'q1',
              text: 'What is 2 + 2?',
              type: 'multiple-choice',
              points: 5,
              options: ['3', '4', '5', '6'],
              correctAnswer: 1
            },
            {
              id: 'q2',
              text: 'Solve for x: x + 3 = 7',
              type: 'text',
              points: 5,
              sampleAnswer: '4',
              gradingNotes: 'Show your work step by step'
            },
            {
              id: 'q3',
              text: 'List the main components of a simple electric circuit:',
              type: 'bullet-points',
              points: 10,
              correctBulletPoints: [
                'Power source (battery)',
                'Conducting wires',
                'Load (resistor/bulb)',
                'Switch'
              ],
              allowPartialCredit: true,
              bulletPoints: [
                'Power source (battery)',
                'Conducting wires',
                'Load (resistor/bulb)',
                'Switch',
                'Voltmeter',
                'Ammeter'
              ]
            }
          ]
        };
        existingAssignments.push(testAssignment);
        localStorage.setItem('physicsAssignments', JSON.stringify(existingAssignments));
        console.log('Test assignment created, reloading...');
        loadHomework();
      }

      // Auto-start logic removed
      /*
      // Check if we should auto-start a specific assignment
      const urlParams = new URLSearchParams(window.location.search);
      const startAssignmentId = urlParams.get('start');
      if (startAssignmentId) {
        console.log('Auto-starting assignment with ID:', startAssignmentId);
        // Wait a moment for assignments to load, then start
        setTimeout(() => {
          startHomework(startAssignmentId);
        }, 500);
      }
      */

    });

    function getPublishedHomework() {
      console.log('=== DEBUGGING HOMEWORK LOADING ===');

      // First try the course page data (where teacher dashboard publishes to)
      let rawData = localStorage.getItem('physicsAssignments');
      console.log('Raw physicsAssignments from localStorage:', rawData);

      if (rawData) {
        try {
          const assessments = JSON.parse(rawData);
          console.log('Parsed assessments:', assessments);

          // Filter for published physics assignments (including submitted ones)
          const publishedAssignments = assessments.filter(assessment => {
            // Check if it's an assignment by looking for assignment-specific fields
            const isAssignment = assessment.category === 'assignment' ||
              assessment.type === 'assignment' ||
              assessment.points !== undefined ||
              assessment.difficulty !== undefined;
            // Only show physics assignments (or assignments without subject specified)
            const isPhysicsAssignment = !assessment.subject || assessment.subject === 'physics';
            // Include published, pending, and completed assignments
            const isPublished = assessment.status === 'published' ||
              assessment.status === 'pending' ||
              assessment.status === 'completed' ||
              assessment.published === true ||
              assessment.published === undefined; // Include if published property doesn't exist
            console.log(`Assessment "${assessment.title}": published=${isPublished}, subject=${assessment.subject}, isAssignment=${isAssignment}, isPhysicsAssignment=${isPhysicsAssignment}, status=${assessment.status}, category=${assessment.category}`);
            return isAssignment && isPublished && isPhysicsAssignment;
          });

          console.log('Filtered published physics assignments:', publishedAssignments);

          // Convert assessments to homework format
          return publishedAssignments.map(assessment => ({
            id: assessment.id,
            title: assessment.title,
            description: assessment.description,
            points: assessment.points, // Use 'points' instead of 'totalPoints'
            difficulty: assessment.difficulty,
            status: assessment.status || 'pending',
            gradingStatus: assessment.gradingStatus,
            score: assessment.score,
            finalScore: assessment.finalScore,
            timeSpent: assessment.timeSpent,
            completedAt: assessment.completedAt,
            submittedAt: assessment.submittedAt,
            answers: assessment.answers,
            totalPoints: assessment.points, // Use 'points' for totalPoints too
            dueDate: assessment.dueDate,
            timeLimit: assessment.timeLimit,
            createdAt: assessment.createdAt,
            publishedOn: assessment.publishedOn || assessment.createdAt,
            questions: assessment.questions || [],
            category: 'assignment'
          }));
        } catch (error) {
          console.error('Error parsing assessments:', error);
        }
      }

      // Fallback to old system
      rawData = localStorage.getItem('physicsAssignments');
      console.log('Fallback: Raw physicsAssignments from localStorage:', rawData);

      const allAssignments = JSON.parse(rawData) || [];
      console.log('Parsed assignments:', allAssignments);

      const publishedPhysics = allAssignments.filter(a => {
        // Include published, pending, and completed assignments
        const isPublished = a.published === true ||
          a.published === undefined || // Include if published property doesn't exist
          a.status === 'published' ||
          a.status === 'pending' ||
          a.status === 'completed';
        const isPhysics = a.subject === 'physics' || !a.subject; // Default to physics if no subject
        console.log(`Assignment "${a.title}": published=${isPublished}, subject=${a.subject}, isPhysics=${isPhysics}, status=${a.status}`);
        return isPublished && isPhysics;
      });

      console.log('Filtered published physics assignments:', publishedPhysics);
      return publishedPhysics;
    }

    function loadHomework() {
      homework = getPublishedHomework();
      console.log('Loaded homework assignments:', homework);
      let list = homework;
      if (currentFilter !== 'all') {
        list = homework.filter(a => a.category === currentFilter);
      }

      // Apply current sorting
      const sortValue = document.getElementById('sortSelect')?.value || 'deadline-asc';
      switch (sortValue) {
        case 'deadline-asc':
          list.sort((a, b) => new Date(a.dueDate || 0) - new Date(b.dueDate || 0));
          break;
        case 'deadline-desc':
          list.sort((a, b) => new Date(b.dueDate || 0) - new Date(a.dueDate || 0));
          break;
        case 'title-asc':
          list.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
          break;
        case 'title-desc':
          list.sort((a, b) => (b.title || '').localeCompare(a.title || ''));
          break;
        case 'points-asc':
          list.sort((a, b) => (a.points || 0) - (b.points || 0));
          break;
        case 'points-desc':
          list.sort((a, b) => (b.points || 0) - (a.points || 0));
          break;
        case 'default':
        default:
          // Keep original order (latest added)
          break;
      }

      updateHomeworkDisplay(list);
      updateSortDisplay();
    }

    function filterHomework(category, ev) {
      currentFilter = category;
      document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
      ev.target.classList.add('active');
      updateFilterCount();
      loadHomework();
    }

    function updateFilterCount() {
      const published = getPublishedHomework();
      const filtered = currentFilter === 'all' ? published : published.filter(a => a.category === currentFilter);
      const filterCountEl = document.getElementById('filterCount');
      if (filterCountEl) {
        filterCountEl.textContent = filtered.length;
      }
    }

    function updateSortDisplay() {
      const sortSelect = document.getElementById('sortSelect');
      const currentSort = document.getElementById('currentSort');
      const sortClearBtn = document.getElementById('sortClearBtn');

      if (sortSelect) {
        const sortValue = sortSelect.value;
        const sortText = sortSelect.options[sortSelect.selectedIndex].text;
        currentSort.textContent = sortText;

        // Show clear button if not on default sort
        if (sortValue !== 'deadline-asc') {
          sortClearBtn.style.display = 'inline-flex';
        } else {
          sortClearBtn.style.display = 'none';
        }
      }
    }

    function clearSort() {
      const sortSelect = document.getElementById('sortSelect');
      if (sortSelect) {
        sortSelect.value = 'deadline-asc';
        updateSortDisplay();
        sortHomework();
      }
    }

    function showSortOptions() {
      const sortSelect = document.getElementById('sortSelect');
      if (sortSelect) {
        // Create a simple dropdown menu
        const options = [
          { value: 'deadline-asc', text: 'Deadline (Nearest First)' },
          { value: 'default', text: 'Latest Added' },
          { value: 'deadline-desc', text: 'Deadline (Latest First)' },
          { value: 'title-asc', text: 'Title (A-Z)' },
          { value: 'title-desc', text: 'Title (Z-A)' },
          { value: 'points-asc', text: 'Points (Low to High)' },
          { value: 'points-desc', text: 'Points (High to Low)' }
        ];

        const currentValue = sortSelect.value;
        const selectedIndex = options.findIndex(opt => opt.value === currentValue);

        // Cycle through options
        const nextIndex = (selectedIndex + 1) % options.length;
        sortSelect.value = options[nextIndex].value;
        updateSortDisplay();
        sortHomework();
      }
    }

    function sortHomework() {
      const sortValue = document.getElementById('sortSelect').value;
      console.log('Sorting by:', sortValue);

      homework = getPublishedHomework();
      let list = homework;

      // Apply category filter first
      if (currentFilter !== 'all') {
        list = homework.filter(a => a.category === currentFilter);
      }

      // Apply sorting
      switch (sortValue) {
        case 'deadline-asc':
          list.sort((a, b) => new Date(a.dueDate || 0) - new Date(b.dueDate || 0));
          break;
        case 'deadline-desc':
          list.sort((a, b) => new Date(b.dueDate || 0) - new Date(a.dueDate || 0));
          break;
        case 'title-asc':
          list.sort((a, b) => (a.title || '').localeCompare(b.title || ''));
          break;
        case 'title-desc':
          list.sort((a, b) => (b.title || '').localeCompare(a.title || ''));
          break;
        case 'points-asc':
          list.sort((a, b) => (a.points || 0) - (b.points || 0));
          break;
        case 'points-desc':
          list.sort((a, b) => (b.points || 0) - (a.points || 0));
          break;
        case 'default':
        default:
          // Keep original order (latest added)
          break;
      }

      // Update the display
      updateHomeworkDisplay(list);
      updateSortDisplay();
    }

    function updateHomeworkDisplay(list) {
      const grid = document.getElementById('homeworkGrid');
      if (list.length === 0) {
        grid.innerHTML = `<div class="col-12 text-center py-5"><h4>No assignments found</h4><p class="text-muted">Try adjusting your filters or search terms.</p></div>`;
        updateStats();
        return;
      }

      grid.innerHTML = list.map(a => `
        <div class="homework-card">
          <div class="homework-card-header">
            <div class="homework-icon"><iconify-icon icon="material-symbols:assignment"></iconify-icon></div>
            <div>
              <div class="homework-card-title">${a.title}</div>
              <span class="status-badge status-${a.status || 'pending'}">${(a.status || 'pending').toUpperCase()}</span>
              ${('finalScore' in a || 'score' in a) ? `
                <div class="grade-display" style="margin-top: 8px; padding: 6px 12px; background: linear-gradient(135deg, #28a745, #20c997); color: white; border-radius: 20px; font-weight: 600; font-size: 0.9rem; display: inline-block; box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);">
                  <iconify-icon icon="material-symbols:grade" style="margin-right: 4px;"></iconify-icon>
                  Grade: ${(() => {
            const score = a.finalScore !== undefined ? a.finalScore : (a.score !== undefined ? a.score : 0);
            const totalPoints = a.points || a.totalPoints || 10;

            // If score is a percentage (0-100), convert to points
            if (score <= 100 && score > 0 && totalPoints > 10) {
              const pointsEarned = Math.round((score / 100) * totalPoints);
              const percentage = Math.round(score);
              return `${pointsEarned}/${totalPoints} (${percentage}%)`;
            }

            // If score is already in points, calculate percentage
            const percentage = Math.round((score / totalPoints) * 100);
            return `${score}/${totalPoints} (${percentage}%)`;
          })()}
                </div>
              ` : ''}
            </div>
          </div>
          <div class="homework-card-description">${a.description}</div>
          <div class="homework-details">
            ${a.status === 'completed' || a.status === 'graded' ? `
            ${(() => {
            const score = a.finalScore || a.score || 0;
            const totalPoints = a.points || a.totalPoints || 10;
            let pointsEarned, percentage, gradeLetter;

            // If score is a percentage (0-100), convert to points
            if (score <= 100 && score > 0 && totalPoints > 10) {
              pointsEarned = Math.round((score / 100) * totalPoints);
              percentage = Math.round(score);
            } else {
              // If score is already in points, calculate percentage
              pointsEarned = score;
              percentage = Math.round((score / totalPoints) * 100);
            }

            // Determine grade letter
            if (percentage >= 90) gradeLetter = 'A+';
            else if (percentage >= 80) gradeLetter = 'A';
            else if (percentage >= 70) gradeLetter = 'B';
            else if (percentage >= 60) gradeLetter = 'C';
            else if (percentage >= 50) gradeLetter = 'D';
            else gradeLetter = 'F';

            return `
              <div class="detail-row"><span class="detail-label">Points Scored:</span><span class="detail-value" style="color:#28a745;font-weight:600;">${pointsEarned} / ${totalPoints}</span></div>
              <div class="detail-row"><span class="detail-label">Grade:</span><span class="detail-value" style="color:#28a745;font-weight:600;">${gradeLetter} (${percentage}%)</span></div>
              <div class="detail-row"><span class="detail-label">Time Spent:</span><span class="detail-value">${a.timeSpent || 0} minutes</span></div>
              `;
          })()}
            ` : `
            <div class="detail-row"><span class="detail-label">Points:</span><span class="detail-value">${a.points || a.totalPoints || 'N/A'}</span></div>
            <div class="detail-row"><span class="detail-label">Published on:</span><span class="detail-value">${(a.publishedOn || a.createdAt) ? new Date(a.publishedOn || a.createdAt).toLocaleDateString() : 'N/A'}</span></div>
            <div class="detail-row"><span class="detail-label">Time:</span><span class="detail-value">${a.timeLimit ? `${a.timeLimit} minutes` : 'No time limit'}</span></div>
            <div class="detail-row"><span class="detail-label">Due Date:</span><span class="detail-value">${a.dueDate ? new Date(a.dueDate).toLocaleDateString() : 'N/A'}</span></div>
            `}
          </div>
          <div class="homework-actions">
            ${a.status === 'completed' || a.status === 'graded' ? `
              <button class="btn btn-outline" onclick="reviewHomework('${a.id}')"><iconify-icon icon="material-symbols:visibility"></iconify-icon>Review</button>
            ` : (a.status === 'pending' && a.gradingStatus === 'pending') || (a.status === 'pending-grading') ? `
              <div class="alert alert-info mb-2" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                <iconify-icon icon="material-symbols:pending" class="me-1"></iconify-icon>
                <strong>Status:</strong> Waiting for assistant correction
              </div>
              <button class="btn btn-outline" onclick="reviewHomework('${a.id}')"><iconify-icon icon="material-symbols:visibility"></iconify-icon>View Submission</button>
            ` : a.submittedAt || a.completedAt ? `
              <div class="alert alert-success mb-2" style="font-size: 0.9rem; padding: 0.5rem 1rem;">
                <iconify-icon icon="material-symbols:check-circle" class="me-1"></iconify-icon>
                <strong>Status:</strong> Submitted
              </div>
              <button class="btn btn-outline" onclick="reviewHomework('${a.id}')"><iconify-icon icon="material-symbols:visibility"></iconify-icon>View Submission</button>
            ` : `
              <button class="btn btn-primary" onclick="startHomework('${a.id}')"><iconify-icon icon="material-symbols:play-arrow"></iconify-icon>Start Assignment</button>
            `}
          </div>
        </div>
      `).join('');
      updateStats();
    }

    function updateStats() {
      const published = getPublishedHomework();
      const total = published.length;
      const completed = published.filter(h => h.status === 'completed').length;
      const pending = total - completed;

      const totalEl = document.getElementById('totalHomework');
      const pendingEl = document.getElementById('pendingHomework');

      if (totalEl) totalEl.textContent = total;
      if (pendingEl) pendingEl.textContent = pending;

      // Update filter count safely
      updateFilterCount();
    }

    let currentAssignment = null;
    let currentQuestionIndex = 0;
    let userAnswers = {};
    let startTime = null;
    let stopwatchInterval = null;
    let isPaused = false;
    let pausedTime = 0; // time when paused
    let totalPausedTime = 0; // total time spent paused

    function startHomework(id) {
      // Reload homework data to ensure we have the latest
      homework = getPublishedHomework();
      let assignment = homework.find(h => h.id === id);

      // If not found in published list, check the full assignments list
      if (!assignment) {
        console.log('Assignment not found in published list! Looking in full assignments...');
        const allAssignments = JSON.parse(localStorage.getItem('physicsAssignments') || '[]');
        assignment = allAssignments.find(a => a.id === id);

        if (!assignment) {
          console.log('Assignment not found! Looking for ID:', id);
          console.log('Available published assignments:', homework);
          console.log('Available all assignments:', allAssignments);
          alert('Assignment not found!');
          return;
        }

        // If assignment is completed, show a message and redirect to review
        if (assignment.status === 'completed' || assignment.status === 'graded') {
          alert('This assignment has already been completed. Redirecting to review...');
          reviewHomework(id);
          return;
        }
      }

      currentAssignment = assignment;
      currentQuestionIndex = 0;
      userAnswers = {};
      startTime = new Date();
      timeLimit = assignment.timeLimit; // in minutes

      // Set modal title
      document.getElementById('questionModalTitle').textContent = assignment.title;

      // Load questions
      loadQuestions();

      // Start stopwatch
      startStopwatch();

      // Show assignment stopwatch
      document.getElementById('assignmentStopwatch').style.display = 'block';

      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('questionModal'));
      modal.show();
    }

    function loadQuestions() {
      if (!currentAssignment || !currentAssignment.questions || currentAssignment.questions.length === 0) {
        // If no questions, show a message
        document.getElementById('questionContainer').innerHTML = `
          <div class="question-card">
            <div class="question-text">This assignment doesn't have any questions yet.</div>
            <p class="text-muted">Please contact your teacher to add questions to this assignment.</p>
          </div>
        `;
        document.getElementById('totalQuestions').textContent = '0';
        document.getElementById('currentQuestionNum').textContent = '0';
        return;
      }

      const questions = currentAssignment.questions;
      document.getElementById('totalQuestions').textContent = questions.length;
      displayCurrentQuestion();
    }

    function displayCurrentQuestion() {
      if (!currentAssignment || !currentAssignment.questions) return;

      const questions = currentAssignment.questions;
      const question = questions[currentQuestionIndex];

      if (!question) return;

      // Reset autocorrect feedback
      document.querySelectorAll('.autocorrect-feedback').forEach(feedback => feedback.remove());
      document.querySelectorAll('.option-item').forEach(item => {
        item.classList.remove('correct-answer', 'correct-selected', 'incorrect-selected', 'disabled');
        item.style.pointerEvents = 'auto';
        item.style.opacity = '1';
      });

      let questionHtml = `
        <div class="question-card">
          <div class="question-text">${question.text || (question.questionContent && question.questionContent.content) || 'Question text not available'}</div>
          <div class="question-options">
      `;

      // Handle new simple question format
      if (question.questionContent && question.questionContent.type === 'image') {
        // Display image question
        questionHtml += `
          <div class="question-image mb-3">
            <img src="${question.questionContent.content}" alt="Question Image" style="max-width: 100%; max-height: 300px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
          </div>
        `;
      }

      // Handle answer types
      if (question.type === 'bullet-points') {
        // Show predefined bullet points if available
        const predefinedPoints = question.bulletPoints || [];
        let bulletPointsHtml = '';

        if (predefinedPoints.length > 0) {
          bulletPointsHtml = `
            <div class="predefined-points mb-3">
              <label class="form-label">Select the key points to include in your answer:</label>
              <div class="predefined-bullet-points">
                ${predefinedPoints.map((point, index) => `
                  <div class="form-check mb-2">
                    <input class="form-check-input" type="checkbox" id="predefinedPoint_${currentQuestionIndex}_${index}" value="${point}" onchange="updateSelectedBulletPoints(${currentQuestionIndex})">
                    <label class="form-check-label" for="predefinedPoint_${currentQuestionIndex}_${index}">
                      ${point}
                    </label>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }

        questionHtml += `
          <div class="form-group">
            <label class="form-label">Answer with bullet points:</label>
            ${bulletPointsHtml}
            <div id="bulletPointsContainer_${currentQuestionIndex}" ${predefinedPoints.length > 0 ? 'style="display: none;"' : ''}>
              <div class="bullet-point-input mb-2">
                <input type="text" class="form-control" placeholder="First point..." oninput="updateBulletPoints(${currentQuestionIndex})">
              </div>
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary" onclick="addBulletPoint(${currentQuestionIndex})" ${predefinedPoints.length > 0 ? 'style="display: none;"' : ''}>
              <iconify-icon icon="material-symbols:add"></iconify-icon>
              Add Point
            </button>
            <textarea class="form-control mt-2" rows="3" placeholder="Or type your complete answer here..." id="textAnswer_${currentQuestionIndex}" style="display: none;">${userAnswers[currentQuestionIndex] || ''}</textarea>
            <button type="button" class="btn btn-sm btn-link mt-1" onclick="toggleAnswerMode(${currentQuestionIndex})">
              Switch to text area
            </button>
          </div>
        `;
      } else if (question.type === 'file-upload' || question.type === 'file-based') {
        const allowedTypes = question.fileUploadSettings ? question.fileUploadSettings.allowedTypes.join(',') : 'pdf,doc,docx,jpg,jpeg,png';
        const maxSize = question.fileUploadSettings ? question.fileUploadSettings.maxSize : 10;
        questionHtml += `
          <div class="form-group">
            <input type="file" class="form-control" id="fileAnswer_${currentQuestionIndex}" accept=".${allowedTypes.replace(/,/g, ',.')}" onchange="validateFileUpload(this, ${maxSize})">
            <small class="text-muted">Allowed formats: ${allowedTypes.toUpperCase()} | Max size: ${maxSize}MB</small>
          </div>
        `;
      } else if (question.type === 'multiple-choice' && question.options) {
        question.options.forEach((option, index) => {
          const isSelected = userAnswers[currentQuestionIndex] === index ? 'selected' : '';
          questionHtml += `
            <div class="option-item ${isSelected}" onclick="selectOption(${index})">
              <input type="radio" class="option-radio" name="question_${currentQuestionIndex}" value="${index}" ${userAnswers[currentQuestionIndex] === index ? 'checked' : ''}>
              <span class="option-text">${option}</span>
            </div>
          `;
        });
      } else if (question.type === 'text' || question.type === 'essay') {
        questionHtml += `
          <div class="form-group">
            <textarea class="form-control" rows="6" placeholder="Enter your answer here..." id="textAnswer_${currentQuestionIndex}">${userAnswers[currentQuestionIndex] || ''}</textarea>
            ${question.type === 'essay' ? '<small class="text-muted">Write a detailed essay response. Be thorough and comprehensive in your answer.</small>' : ''}
          </div>
        `;
      } else if (question.type === 'file') {
        questionHtml += `
          <div class="form-group">
            <input type="file" class="form-control" id="fileAnswer_${currentQuestionIndex}" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
            <small class="text-muted">${question.fileRequirements || 'Upload your file here'}</small>
          </div>
        `;
      }

      questionHtml += `
          </div>
          <div class="question-meta">
            <small class="text-muted">Points: ${question.points || 1}</small>
          </div>
        </div>
      `;

      document.getElementById('questionContainer').innerHTML = questionHtml;
      document.getElementById('currentQuestionNum').textContent = currentQuestionIndex + 1;

      // Update progress bar
      const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
      document.getElementById('progressBar').style.width = progress + '%';

      // Add action buttons after the HTML is inserted
      addQuestionActionButtons();

      // Update navigation buttons
      updateNavigationButtons();
    }

    function selectOption(optionIndex) {
      // Remove previous selection
      document.querySelectorAll('.option-item').forEach(item => item.classList.remove('selected'));

      // Add selection to clicked option
      event.currentTarget.classList.add('selected');

      // Update radio button
      const radio = event.currentTarget.querySelector('input[type="radio"]');
      radio.checked = true;

      // Save answer
      userAnswers[currentQuestionIndex] = optionIndex;

      // Autocorrect functionality
      if (currentAssignment && currentAssignment.questions && currentAssignment.questions[currentQuestionIndex]) {
        const question = currentAssignment.questions[currentQuestionIndex];
        if (question.type === 'multiple-choice' && question.correctAnswer !== undefined) {
          // Show immediate feedback
          showAutocorrectFeedback(optionIndex, question.correctAnswer);
        }
      }
    }

    function showAutocorrectFeedback(selectedIndex, correctIndex) {
      // Remove any existing feedback
      document.querySelectorAll('.autocorrect-feedback').forEach(feedback => feedback.remove());

      const optionItems = document.querySelectorAll('.option-item');
      const isCorrect = selectedIndex === correctIndex;

      // Mark correct answer
      if (optionItems[correctIndex]) {
        optionItems[correctIndex].classList.add('correct-answer');
        const correctIcon = document.createElement('iconify-icon');
        correctIcon.setAttribute('icon', 'material-symbols:check-circle');
        correctIcon.style.color = '#28a745';
        correctIcon.style.marginLeft = '8px';
        correctIcon.className = 'autocorrect-feedback';
        optionItems[correctIndex].appendChild(correctIcon);
      }

      // Mark selected answer
      if (optionItems[selectedIndex]) {
        if (isCorrect) {
          optionItems[selectedIndex].classList.add('correct-selected');
        } else {
          optionItems[selectedIndex].classList.add('incorrect-selected');
          const incorrectIcon = document.createElement('iconify-icon');
          incorrectIcon.setAttribute('icon', 'material-symbols:cancel');
          incorrectIcon.style.color = '#dc3545';
          incorrectIcon.style.marginLeft = '8px';
          incorrectIcon.className = 'autocorrect-feedback';
          optionItems[selectedIndex].appendChild(incorrectIcon);
        }
      }

      // Always add action buttons (already added in displayCurrentQuestion)

      // Disable further selection
      optionItems.forEach(item => {
        item.style.pointerEvents = 'none';
        item.style.opacity = '0.7';
      });
    }

    function addQuestionActionButtons() {
      // Remove existing action buttons
      document.querySelectorAll('.question-actions').forEach(btn => btn.remove());

      const questionCard = document.querySelector('.question-card');
      if (!questionCard) return;

      const actionsDiv = document.createElement('div');
      actionsDiv.className = 'question-actions';
      actionsDiv.innerHTML = `
        <div class="action-buttons">
          <button class="btn btn-primary btn-sm enhanced-action-btn" onclick="askAssistant()">
            <iconify-icon icon="material-symbols:smart-toy"></iconify-icon>
            Assistant
          </button>
          <button class="btn btn-info btn-sm enhanced-action-btn" onclick="askCommunity()">
            <iconify-icon icon="material-symbols:groups"></iconify-icon>
            Ask Community
          </button>
          <button class="btn btn-warning btn-sm enhanced-action-btn" onclick="markAsTricky()">
            <iconify-icon icon="material-symbols:star"></iconify-icon>
            Mark as Tricky
          </button>
        </div>
      `;

      questionCard.appendChild(actionsDiv);
    }


    function markAsTricky() {
      if (!currentAssignment || !currentAssignment.questions) return;

      const question = currentAssignment.questions[currentQuestionIndex];
      const trickyQuestions = JSON.parse(localStorage.getItem('physicsTrickyQuestions')) || [];

      // Create unique question identifier combining assignment ID and question ID
      const uniqueQuestionId = `${currentAssignment.id}_${question.id}`;

      const existingIndex = trickyQuestions.findIndex(q => q.id === uniqueQuestionId);

      if (existingIndex >= 0) {
        showNotification('Question already in Tricky Questions!', 'info');
        return;
      }

      // Show folder selection modal
      showFolderSelectionModal(question);
    }

    function showFolderSelectionModal(question) {
      const customFolders = JSON.parse(localStorage.getItem('physicsTrickyFolders')) || [];

      if (customFolders.length === 0) {
        // No folders available, add directly to tricky questions
        addToTrickyQuestions(question, null);
        return;
      }

      // Create modal HTML
      const modalHtml = `
        <div class="modal fade" id="folderSelectionModal" tabindex="-1">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Choose Folder for Tricky Question</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <p>Select a folder to organize this tricky question:</p>
                <div class="list-group">
                  <button type="button" class="list-group-item list-group-item-action" onclick="selectFolder(null, 'No Folder')">
                    <div class="d-flex w-100 justify-content-between">
                      <h6 class="mb-1">No Folder</h6>
                      <small>Add to general tricky questions</small>
                    </div>
                  </button>
                  ${customFolders.map(folder => `
                    <button type="button" class="list-group-item list-group-item-action" onclick="selectFolder('${folder.id}', '${folder.name.replace(/'/g, "\\'")}')">
                      <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${folder.name}</h6>
                        <small>${folder.description || 'Custom folder'}</small>
                      </div>
                    </button>
                  `).join('')}
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      `;

      // Remove existing modal if any
      const existingModal = document.getElementById('folderSelectionModal');
      if (existingModal) {
        existingModal.remove();
      }

      // Add modal to body
      document.body.insertAdjacentHTML('beforeend', modalHtml);

      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('folderSelectionModal'));
      modal.show();

      // Store question data for later use
      window.currentTrickyQuestion = question;
    }

    function selectFolder(folderId, folderName) {
      const question = window.currentTrickyQuestion;
      if (!question) return;

      // Close modal
      const modal = bootstrap.Modal.getInstance(document.getElementById('folderSelectionModal'));
      modal.hide();

      // Add to tricky questions with selected folder
      addToTrickyQuestions(question, folderId);

      // Clean up
      setTimeout(() => {
        const modalElement = document.getElementById('folderSelectionModal');
        if (modalElement) {
          modalElement.remove();
        }
        delete window.currentTrickyQuestion;
      }, 300);
    }

    function addToTrickyQuestions(question, folderId) {
      const trickyQuestions = JSON.parse(localStorage.getItem('physicsTrickyQuestions')) || [];

      const trickyQuestion = {
        id: `${currentAssignment.id}_${question.id}`, // Unique ID combining assignment and question
        originalQuestionId: question.id, // Keep original question ID for reference
        text: question.text,
        type: question.type,
        options: question.options || [],
        correctAnswer: question.correctAnswer,
        subject: 'physics',
        assignmentId: currentAssignment.id,
        assignmentTitle: currentAssignment.title,
        chapter: currentAssignment.chapter || null,
        chapterId: currentAssignment.chapterId || null,
        addedAt: new Date().toISOString(),
        points: question.points || 1,
        difficulty: currentAssignment.difficulty || 'medium',
        folderId: folderId
      };

      trickyQuestions.push(trickyQuestion);

      const folderMessage = folderId ? ` in folder` : '';
      showNotification(`⭐ Question marked as tricky and added to Tricky Questions${folderMessage}!`, 'success');

      localStorage.setItem('physicsTrickyQuestions', JSON.stringify(trickyQuestions));
    }

    function askAssistant() {
      // Redirect to course assistants chat page
      window.location.href = 'course-assistants-chat.html?course=physics';
    }

    function askCommunity() {
      if (!currentAssignment || !currentAssignment.questions) return;

      const question = currentAssignment.questions[currentQuestionIndex];
      const questionText = question.text;
      const assignmentTitle = currentAssignment.title;

      // Build comprehensive question content for community message
      let messageContent = `Question from ${assignmentTitle}:\n\n${questionText}`;

      // Add choices for multiple choice questions
      if (question.type === 'multiple-choice' && question.options && question.options.length > 0) {
        messageContent += '\n\nChoices:';
        question.options.forEach((option, index) => {
          messageContent += `\n${String.fromCharCode(65 + index)}. ${option}`;
        });
      }

      // Add image if present
      if (question.image) {
        messageContent += `\n\n[Image: ${question.image}]`;
      }

      // Add question type and points info
      messageContent += `\n\nQuestion Type: ${question.type}`;
      if (question.points) {
        messageContent += `\nPoints: ${question.points}`;
      }

      // Redirect to community page with comprehensive question context
      const communityUrl = `community.html?message=${encodeURIComponent(messageContent)}&assignment=${encodeURIComponent(assignmentTitle)}&subject=physics`;
      window.open(communityUrl, '_blank');
    }

    function showNotification(message, type = 'info') {
      // Remove existing notifications
      document.querySelectorAll('.notification').forEach(n => n.remove());

      const notification = document.createElement('div');
      notification.className = `notification notification-${type}`;
      notification.innerHTML = `
        <div class="notification-content">
          <iconify-icon icon="material-symbols:${type === 'success' ? 'check-circle' : 'info'}"></iconify-icon>
          <span>${message}</span>
        </div>
      `;

      document.body.appendChild(notification);

      // Auto remove after 3 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 3000);
    }

    function nextQuestion() {
      // Only save answer if there are questions
      if (currentAssignment && currentAssignment.questions && currentAssignment.questions.length > 0) {
        saveCurrentAnswer();
      }

      if (currentAssignment && currentAssignment.questions && currentQuestionIndex < currentAssignment.questions.length - 1) {
        currentQuestionIndex++;
        displayCurrentQuestion();
      } else {
        // Show submit button on last question
        document.getElementById('submitBtn').style.display = 'inline-block';
        document.getElementById('nextBtn').style.display = 'none';
      }
    }

    function previousQuestion() {
      // Only save answer if there are questions
      if (currentAssignment && currentAssignment.questions && currentAssignment.questions.length > 0) {
        saveCurrentAnswer();
      }

      if (currentQuestionIndex > 0) {
        currentQuestionIndex--;
        displayCurrentQuestion();
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'inline-block';
      }
    }

    function saveCurrentAnswer() {
      // Check if assignment has questions
      if (!currentAssignment || !currentAssignment.questions || currentAssignment.questions.length === 0) {
        return;
      }

      const question = currentAssignment.questions[currentQuestionIndex];

      // Check if question exists
      if (!question) {
        return;
      }

      if (question.type === 'bullet-points') {
        // Check if using predefined bullet points, manual bullet points, or text area
        const predefinedContainer = document.querySelector(`.predefined-points`);
        const bulletContainer = document.getElementById(`bulletPointsContainer_${currentQuestionIndex}`);
        const textArea = document.getElementById(`textAnswer_${currentQuestionIndex}`);

        if (predefinedContainer && predefinedContainer.style.display !== 'none') {
          // Using predefined bullet points
          updateSelectedBulletPoints(currentQuestionIndex);
        } else if (bulletContainer && bulletContainer.style.display !== 'none') {
          // Using manual bullet points
          updateBulletPoints(currentQuestionIndex);
        } else if (textArea && textArea.style.display !== 'none') {
          // Using text area
          userAnswers[currentQuestionIndex] = textArea.value;
        }
      } else if (question.type === 'file-upload' || question.type === 'file-based') {
        const fileAnswer = document.getElementById(`fileAnswer_${currentQuestionIndex}`);
        if (fileAnswer && fileAnswer.files.length > 0) {
          userAnswers[currentQuestionIndex] = fileAnswer.files[0].name;
        }
      } else if (question.type === 'text' || question.type === 'essay') {
        const textAnswer = document.getElementById(`textAnswer_${currentQuestionIndex}`);
        if (textAnswer) {
          userAnswers[currentQuestionIndex] = textAnswer.value;

          // Text and essay questions are manually graded - no autocorrect
          // Just save the answer for manual review
        }
      } else if (question.type === 'file') {
        const fileAnswer = document.getElementById(`fileAnswer_${currentQuestionIndex}`);
        if (fileAnswer && fileAnswer.files.length > 0) {
          userAnswers[currentQuestionIndex] = fileAnswer.files[0].name;
        }

        // File questions are manually graded - no autocorrect
        // Just save the file for manual review
      }
    }

    // Helper functions for bullet points
    function addBulletPoint(questionIndex) {
      const container = document.getElementById(`bulletPointsContainer_${questionIndex}`);
      const newInput = document.createElement('div');
      newInput.className = 'bullet-point-input mb-2';
      newInput.innerHTML = `<input type="text" class="form-control" placeholder="Add another point..." oninput="updateBulletPoints(${questionIndex})">`;
      container.appendChild(newInput);
    }

    function updateBulletPoints(questionIndex) {
      const container = document.getElementById(`bulletPointsContainer_${questionIndex}`);
      const inputs = container.querySelectorAll('input');
      const bulletPoints = Array.from(inputs).map(input => input.value.trim()).filter(value => value.length > 0);
      userAnswers[questionIndex] = bulletPoints.join('\n• ');
    }

    function updateSelectedBulletPoints(questionIndex) {
      const checkboxes = document.querySelectorAll(`input[id^="predefinedPoint_${questionIndex}_"]`);
      const selectedPoints = Array.from(checkboxes)
        .filter(checkbox => checkbox.checked)
        .map(checkbox => checkbox.value);
      userAnswers[questionIndex] = selectedPoints.join('\n• ');
    }

    function toggleAnswerMode(questionIndex) {
      const bulletContainer = document.getElementById(`bulletPointsContainer_${questionIndex}`);
      const textArea = document.getElementById(`textAnswer_${questionIndex}`);
      const toggleButton = event.target;

      if (bulletContainer.style.display === 'none') {
        // Switch to bullet points
        bulletContainer.style.display = 'block';
        textArea.style.display = 'none';
        toggleButton.textContent = 'Switch to text area';
      } else {
        // Switch to text area
        bulletContainer.style.display = 'none';
        textArea.style.display = 'block';
        toggleButton.textContent = 'Switch to bullet points';
      }
    }

    function validateFileUpload(input, maxSizeMB) {
      const file = input.files[0];
      if (file) {
        const fileSizeMB = file.size / (1024 * 1024);
        if (fileSizeMB > maxSizeMB) {
          alert(`File size (${fileSizeMB.toFixed(1)}MB) exceeds maximum allowed size (${maxSizeMB}MB)`);
          input.value = '';
          return false;
        }
      }
      return true;
    }


    function checkTextAnswer(userAnswer, question) {
      if (!userAnswer || (typeof userAnswer === 'string' && !userAnswer.trim())) return;

      const correctAnswer = question.correctAnswer.toLowerCase().trim();
      const userAnswerLower = String(userAnswer).toLowerCase().trim();

      let isCorrect = false;

      // Check main correct answer
      if (userAnswerLower === correctAnswer) {
        isCorrect = true;
      }

      // Check alternative answers if they exist
      if (!isCorrect && question.alternativeAnswers && question.alternativeAnswers.length > 0) {
        isCorrect = question.alternativeAnswers.some(alt =>
          userAnswerLower === alt.toLowerCase().trim()
        );
      }

      // Show feedback
      if (isCorrect) {
        showNotification('✅ Correct answer!', 'success');
      } else {
        showNotification('❌ Incorrect answer! Question added to Wrong Questions folder.', 'success');
        addToWrongQuestions();
      }
    }

    function updateNavigationButtons() {
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      prevBtn.disabled = currentQuestionIndex === 0;

      if (currentQuestionIndex === currentAssignment.questions.length - 1) {
        nextBtn.style.display = 'none';
        document.getElementById('submitBtn').style.display = 'inline-block';
      } else {
        nextBtn.style.display = 'inline-block';
        document.getElementById('submitBtn').style.display = 'none';
      }
    }

    function startStopwatch() {
      startTime = new Date();
      isPaused = false;
      totalPausedTime = 0;
      stopwatchInterval = setInterval(updateStopwatch, 100);
    }

    function updateStopwatch() {
      if (!startTime || isPaused) return;

      const now = new Date();
      const elapsed = Math.floor((now - startTime - totalPausedTime) / 1000);

      const hours = Math.floor(elapsed / 3600);
      const minutes = Math.floor((elapsed % 3600) / 60);
      const seconds = elapsed % 60;

      const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      document.getElementById('stopwatchDisplay').textContent = timeString;
    }

    function pauseStopwatch() {
      if (isPaused) return;

      isPaused = true;
      pausedTime = new Date();
      clearInterval(stopwatchInterval);

      document.getElementById('pauseBtn').style.display = 'none';
      document.getElementById('resumeBtn').style.display = 'inline-block';
    }

    function resumeStopwatch() {
      if (!isPaused) return;

      const now = new Date();
      totalPausedTime += (now - pausedTime);
      isPaused = false;

      stopwatchInterval = setInterval(updateStopwatch, 100);

      document.getElementById('pauseBtn').style.display = 'inline-block';
      document.getElementById('resumeBtn').style.display = 'none';
    }


    // Function to grade bullet point questions
    function gradeBulletPointQuestion(question, userAnswer) {
      if (!question.correctBulletPoints || !userAnswer) {
        return 0; // No correct answers defined or no user answer
      }

      const correctPoints = question.correctBulletPoints;
      const userPoints = Array.isArray(userAnswer) ? userAnswer : [userAnswer];

      // Convert to lowercase for comparison
      const correctPointsLower = correctPoints.map(point => point.toLowerCase().trim());
      const userPointsLower = userPoints.map(point => String(point).toLowerCase().trim());

      let score = 0;
      const pointsPerCorrectAnswer = (question.points || 1) / correctPoints.length;

      // Check each user point against correct points
      userPointsLower.forEach(userPoint => {
        if (userPoint && correctPointsLower.includes(userPoint)) {
          score += pointsPerCorrectAnswer;
        }
      });

      // Also check for partial matches (keywords)
      if (question.allowPartialCredit) {
        userPointsLower.forEach(userPoint => {
          if (userPoint) {
            correctPointsLower.forEach(correctPoint => {
              // Check if user point contains key words from correct point
              const correctWords = correctPoint.split(' ').filter(word => word.length > 3);
              const userWords = userPoint.split(' ').filter(word => word.length > 3);

              const matchingWords = correctWords.filter(word =>
                userWords.some(userWord => userWord.includes(word) || word.includes(userWord))
              );

              if (matchingWords.length > 0) {
                const partialScore = (matchingWords.length / correctWords.length) * pointsPerCorrectAnswer * 0.5;
                score += partialScore;
              }
            });
          }
        });
      }

      return Math.min(score, question.points || 1); // Cap at maximum points
    }

    function submitAssignment() {
      // Only save answer if there are questions
      if (currentAssignment && currentAssignment.questions && currentAssignment.questions.length > 0) {
        saveCurrentAnswer();
      }

      // Check if assignment has questions
      if (!currentAssignment || !currentAssignment.questions || currentAssignment.questions.length === 0) {
        alert('This assignment has no questions to submit.');
        return;
      }

      // Calculate score
      let score = 0;
      let totalPoints = 0;
      let hasManualGradingQuestions = false;

      currentAssignment.questions.forEach((question, index) => {
        totalPoints += question.points || 1;

        if (question.type === 'multiple-choice') {
          if (userAnswers[index] === question.correctAnswer) {
            score += question.points || 1;
          }
        } else if (question.type === 'bullet-points') {
          // Grade bullet point questions automatically if correctBulletPoints are defined
          if (question.correctBulletPoints && question.correctBulletPoints.length > 0) {
            const bulletScore = gradeBulletPointQuestion(question, userAnswers[index]);
            score += bulletScore;
          } else {
            // No correct answers defined - manual grading required
            hasManualGradingQuestions = true;
          }
        } else if (question.type === 'text' || question.type === 'essay' || question.type === 'file' || question.type === 'file-upload' || question.type === 'file-based') {
          // For text, essay, file, file-upload, and file-based questions, no automatic scoring - manual grading required
          hasManualGradingQuestions = true;
        }
      });

      const percentage = Math.round((score / totalPoints) * 100);
      const timeSpent = Math.floor((new Date() - startTime - totalPausedTime) / 60000); // in minutes

      // Update assignment status
      const assignmentIndex = homework.findIndex(h => h.id === currentAssignment.id);
      if (assignmentIndex !== -1) {
        // Set status based on whether manual grading is needed
        if (hasManualGradingQuestions) {
          homework[assignmentIndex].status = 'pending';
          homework[assignmentIndex].gradingStatus = 'pending';
          homework[assignmentIndex].score = null; // No score yet
          homework[assignmentIndex].finalScore = null;

          // Push to pending grading
          pushToPendingGrading();
        } else {
          homework[assignmentIndex].status = 'completed';
          homework[assignmentIndex].gradingStatus = 'graded';
          homework[assignmentIndex].score = score; // Store actual points earned
          homework[assignmentIndex].finalScore = score; // Store actual points earned
        }

        // Preserve the published status to ensure assignment remains visible
        if (!homework[assignmentIndex].published && !homework[assignmentIndex].hasOwnProperty('published')) {
          homework[assignmentIndex].published = true;
        }

        homework[assignmentIndex].timeSpent = timeSpent;
        homework[assignmentIndex].completedAt = new Date().toISOString();
        homework[assignmentIndex].answers = userAnswers;
        homework[assignmentIndex].totalPoints = totalPoints;

        // Save to localStorage - update the full assignments array, not just the filtered homework
        const allAssignments = JSON.parse(localStorage.getItem('physicsAssignments') || '[]');
        const globalAssignmentIndex = allAssignments.findIndex(a => a.id === currentAssignment.id);
        if (globalAssignmentIndex !== -1) {
          allAssignments[globalAssignmentIndex] = homework[assignmentIndex];
          localStorage.setItem('physicsAssignments', JSON.stringify(allAssignments));

          // Dispatch event to update dashboard points
          document.dispatchEvent(new CustomEvent('localStorageUpdated', {
            detail: { key: 'physicsAssignments', type: 'assignment' }
          }));
        }

        // Also update the physicsAssessments data for consistency
        updatePhysicsAssessments(currentAssignment.id, homework[assignmentIndex]);
      }

      // Clear stopwatch
      if (stopwatchInterval) {
        clearInterval(stopwatchInterval);
        stopwatchInterval = null;
      }

      // Hide assignment stopwatch
      document.getElementById('assignmentStopwatch').style.display = 'none';

      // Close modal
      bootstrap.Modal.getInstance(document.getElementById('questionModal')).hide();

      // Show success message
      if (hasManualGradingQuestions) {
        alert(`Assignment submitted!\nYour answers are being reviewed.\nStatus: Waiting for assistant correction\nTime spent: ${timeSpent} minutes`);
      } else {
        alert(`Assignment completed!\nScore: ${score}/${totalPoints}\nTime spent: ${timeSpent} minutes`);
      }

      // Reload homework to show updated status
      loadHomework();
    }

    function updatePhysicsAssessments(assignmentId, updatedAssignment) {
      // Update the physicsAssignments data to reflect the submission
      const assessmentsData = localStorage.getItem('physicsAssignments');
      if (assessmentsData) {
        try {
          const assessments = JSON.parse(assessmentsData);
          const assessmentIndex = assessments.findIndex(a => a.id === assignmentId);

          if (assessmentIndex !== -1) {
            // Update the assessment with submission data
            assessments[assessmentIndex].status = updatedAssignment.status;
            assessments[assessmentIndex].gradingStatus = updatedAssignment.gradingStatus;
            assessments[assessmentIndex].score = updatedAssignment.score;
            assessments[assessmentIndex].finalScore = updatedAssignment.finalScore;
            assessments[assessmentIndex].timeSpent = updatedAssignment.timeSpent;
            assessments[assessmentIndex].completedAt = updatedAssignment.completedAt;
            assessments[assessmentIndex].submittedAt = updatedAssignment.submittedAt;
            assessments[assessmentIndex].answers = updatedAssignment.answers;
            assessments[assessmentIndex].totalPoints = updatedAssignment.totalPoints;

            // Save back to localStorage
            localStorage.setItem('physicsAssignments', JSON.stringify(assessments));
            console.log('Updated physicsAssignments with submission data');
          }
        } catch (error) {
          console.error('Error updating physicsAssignments:', error);
        }
      }
    }

    function pushToPendingGrading() {
      console.log('Creating pending grading submission...');
      console.log('Current assignment:', currentAssignment);
      console.log('User answers:', userAnswers);

      // Calculate total points and score
      let totalPoints = 0;
      let score = 0;

      currentAssignment.questions.forEach((question, index) => {
        totalPoints += question.points || 1;

        if (question.type === 'multiple-choice') {
          if (userAnswers[index] === question.correctAnswer) {
            score += question.points || 1;
          }
        }
        // For other question types (essay, text, etc.), no automatic scoring
      });

      // Create submission object for pending grading
      const submission = {
        id: 'submission_' + Date.now(),
        assignmentId: currentAssignment.id,
        assignmentTitle: currentAssignment.title,
        studentName: 'Student', // In a real app, this would come from user authentication
        studentId: 'student_001', // In a real app, this would come from user authentication
        submittedAt: new Date().toISOString(),
        status: 'pending',
        type: 'assignment', // This will be 'assignment', 'quiz', or 'exam'
        subject: 'physics',
        questions: currentAssignment.questions.map((question, index) => {
          const submissionQuestion = {
            id: question.id,
            text: question.text,
            type: question.type,
            points: question.points || 1,
            userAnswer: userAnswers[index] || '',
            correctAnswer: question.correctAnswer,
            sampleAnswer: question.sampleAnswer,
            gradingNotes: question.gradingNotes,
            expectedContent: question.expectedContent,
            gradingCriteria: question.gradingCriteria
          };

          // For file questions, include file information
          if (question.type === 'file' || question.type === 'file-upload' || question.type === 'file-based') {
            const fileInput = document.getElementById(`fileAnswer_${index}`);
            if (fileInput && fileInput.files.length > 0) {
              submissionQuestion.fileName = fileInput.files[0].name;
              submissionQuestion.fileSize = fileInput.files[0].size;
              submissionQuestion.fileType = fileInput.files[0].type;
            }
          }

          return submissionQuestion;
        }),
        answers: userAnswers, // Store user answers for grading
        totalPoints: totalPoints,
        timeSpent: Math.floor((new Date() - startTime - totalPausedTime) / 60000),
        score: score // Store actual points earned
      };

      console.log('Created submission:', submission);

      // Save to pending grading
      let pendingSubmissions = JSON.parse(localStorage.getItem('physicsPendingGrading')) || [];
      pendingSubmissions.push(submission);
      localStorage.setItem('physicsPendingGrading', JSON.stringify(pendingSubmissions));

      console.log('Saved to physicsPendingGrading:', pendingSubmissions);
      console.log('Assignment submitted for manual grading:', submission);
    }

    // Cleanup when modal is closed
    document.getElementById('questionModal').addEventListener('hidden.bs.modal', function () {
      if (stopwatchInterval) {
        clearInterval(stopwatchInterval);
        stopwatchInterval = null;
      }
      // Hide assignment stopwatch
      document.getElementById('assignmentStopwatch').style.display = 'none';
    });
    function reviewHomework(id) {
      console.log('Review button clicked for ID:', id);

      // Reload homework data to ensure we have the latest
      homework = getPublishedHomework();
      console.log('Current homework array:', homework);

      let a = homework.find(h => h.id === id);
      console.log('Found assignment in published list:', a);

      // If not found in published list, check the full assignments list
      if (!a) {
        console.log('Assignment not found in published list! Looking in full assignments...');
        const allAssignments = JSON.parse(localStorage.getItem('physicsAssignments') || '[]');
        a = allAssignments.find(assignment => assignment.id === id);
        console.log('Found assignment in full list:', a);
      }

      if (a) {
        openReviewModal(a);
      } else {
        console.error('Assignment not found with ID:', id);
        alert('Assignment not found. Please refresh the page and try again.');
      }
    }

    function openReviewModal(assignment) {
      // Create review modal if it doesn't exist
      if (!document.getElementById('reviewModal')) {
        createReviewModal();
      }

      // Load assignment data into modal
      loadAssignmentReview(assignment);

      // Show modal
      const modal = new bootstrap.Modal(document.getElementById('reviewModal'));
      modal.show();
    }

    function createReviewModal() {
      const modalHtml = `
        <div class="modal fade" id="reviewModal" tabindex="-1">
          <div class="modal-dialog modal-xl">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Assignment Review</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div id="reviewContent">
                  <!-- Review content will be loaded here -->
                </div>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', modalHtml);
    }

    function loadAssignmentReview(assignment) {
      console.log('Loading assignment review for:', assignment);
      const container = document.getElementById('reviewContent');

      if (!container) {
        console.error('Review content container not found');
        return;
      }

      // Calculate total points
      const totalPoints = assignment.totalPoints || (assignment.questions ? assignment.questions.reduce((sum, q) => sum + (q.points || 1), 0) : 0);
      const score = assignment.finalScore || assignment.score || 0;

      let reviewHtml = `
        <div class="assignment-review">
          <div class="review-header mb-4 p-3 bg-light rounded">
            <h4>${assignment.title || 'Untitled Assignment'}</h4>
            <div class="row">
              <div class="col-md-6">
                <p><strong>Status:</strong> <span class="badge bg-${assignment.status === 'graded' ? 'success' : assignment.status === 'completed' ? 'primary' : 'warning'}">${(assignment.status || 'pending').toUpperCase()}</span></p>
                <p><strong>Your Score:</strong> <span class="text-${assignment.status === 'graded' ? 'success' : 'info'}">${score}/${totalPoints}</span></p>
                <p><strong>Percentage:</strong> <span class="text-${score >= totalPoints * 0.8 ? 'success' : score >= totalPoints * 0.6 ? 'warning' : 'danger'}">${totalPoints > 0 ? Math.round((score / totalPoints) * 100) : 0}%</span></p>
              </div>
              <div class="col-md-6">
                <p><strong>Time Spent:</strong> ${assignment.timeSpent || 0} minutes</p>
                <p><strong>Completed:</strong> ${assignment.completedAt ? new Date(assignment.completedAt).toLocaleString() : 'Not completed'}</p>
                ${assignment.gradedAt ? `<p><strong>Graded:</strong> ${new Date(assignment.gradedAt).toLocaleString()}</p>` : ''}
              </div>
            </div>
          </div>
      `;

      if (assignment.questions && assignment.questions.length > 0) {
        reviewHtml += '<div class="questions-review">';

        assignment.questions.forEach((question, index) => {
          const userAnswer = assignment.answers ? assignment.answers[index] : '';
          const grading = assignment.grading ? assignment.grading.find(g => g.questionIndex === index) : null;
          const pointsAwarded = grading ? grading.pointsAwarded : (question.type === 'multiple-choice' ? (userAnswer === question.correctAnswer ? question.points : 0) : 0);
          const comments = grading ? grading.comments : '';

          // Determine if the user got this question correct
          let isCorrect = false;
          if (question.type === 'multiple-choice') {
            isCorrect = userAnswer === question.correctAnswer;
          } else if (question.type === 'essay' || question.type === 'text') {
            // For essay and text questions, check if full points were awarded
            isCorrect = pointsAwarded >= (question.points || 1);
          } else {
            // For other question types, check if full points were awarded
            isCorrect = pointsAwarded >= (question.points || 1);
          }

          console.log(`Question ${index + 1}:`, {
            question: question.text,
            userAnswer: userAnswer,
            correctAnswer: question.correctAnswer,
            pointsAwarded: pointsAwarded,
            isCorrect: isCorrect
          });

          reviewHtml += `
            <div class="question-review-item">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <h6>Question ${index + 1}</h6>
                <div class="points-display">Points: ${question.points}</div>
              </div>
              
              <p class="question-text">${question.text || (question.questionContent && question.questionContent.content) || 'Question text not available'}</p>
              
              ${question.type === 'multiple-choice' && question.options ? `
                ${!userAnswer || userAnswer === 'Not answered' || (typeof userAnswer === 'string' && userAnswer.trim() === '') ? `
                  <div class="not-answered-display p-3 bg-warning bg-opacity-25 border border-warning rounded">
                    <div class="d-flex align-items-center">
                      <iconify-icon icon="material-symbols:warning" class="text-warning me-2"></iconify-icon>
                      <span class="text-warning fw-bold">Question not answered - Time expired</span>
                    </div>
                    <div class="mt-2">
                      <small class="text-muted">Available options were:</small>
                      <ul class="list-unstyled mt-1">
                        ${question.options.map(option => `<li class="text-muted">• ${option}</li>`).join('')}
                      </ul>
                      <small class="text-success">
                        <strong>Correct answer:</strong> ${question.correctAnswer}
                      </small>
                    </div>
                  </div>
                ` : `
                <div class="answer-options">
                  ${question.options.map((option, optionIndex) => {
            // Handle both index-based and value-based correct answers
            const isUserSelected = userAnswer === optionIndex || userAnswer === option;
            const isCorrectOption = optionIndex === question.correctAnswer || option === question.correctAnswer;

            let optionClass = 'answer-option';
            let radioClass = 'option-radio';

            if (isCorrectOption) {
              optionClass += ' correct';
              radioClass += ' correct';
            } else if (isUserSelected && !isCorrectOption) {
              optionClass += ' incorrect';
              radioClass += ' incorrect';
            }

            if (isUserSelected) {
              optionClass += ' user-selected';
              radioClass += ' checked';
            }

            return `
                      <div class="${optionClass}">
                        <div class="${radioClass}"></div>
                        <span>${option}</span>
                          ${isCorrectOption ? '<span class="badge bg-success ms-2">Correct</span>' : ''}
                          ${isUserSelected && !isCorrectOption ? '<span class="badge bg-danger ms-2">Your Answer</span>' : ''}
                      </div>
                    `;
          }).join('')}
                </div>
                `}
              ` : `
                <div class="answer-section mb-3">
                  <strong>Your Answer:</strong>
                  ${!userAnswer || userAnswer === 'Not answered' || (typeof userAnswer === 'string' && userAnswer.trim() === '') ? `
                    <div class="not-answered-display p-3 bg-warning bg-opacity-25 border border-warning rounded mt-1">
                      <div class="d-flex align-items-center">
                        <iconify-icon icon="material-symbols:warning" class="text-warning me-2"></iconify-icon>
                        <span class="text-warning fw-bold">Question not answered - Time expired</span>
                      </div>
                    </div>
                  ` : `
                  <div class="answer-content p-2 bg-light rounded mt-1">
                    ${question.type === 'file' || question.type === 'file-upload' || question.type === 'file-based' ?
              `<p><strong>File:</strong> ${userAnswer || 'No file uploaded'}</p>` :
              question.type === 'bullet-points' ?
                `<p><strong>Answer:</strong><br>${userAnswer ? userAnswer.replace(/\n/g, '<br>') : 'No answer provided'}</p>` :
                question.type === 'essay' ?
                  `<p><strong>Essay Answer:</strong><br>${userAnswer ? userAnswer.replace(/\n/g, '<br>') : 'No answer provided'}</p>` :
                  `<p>${userAnswer || 'No answer provided'}</p>`
            }
                  </div>
                  `}
                </div>
                
                ${question.sampleAnswer ? `
                  <div class="sample-answer mb-3">
                    <strong>Sample Answer:</strong>
                    <div class="answer-content p-2 bg-success bg-opacity-10 rounded mt-1">
                      <p>${question.sampleAnswer}</p>
                    </div>
                  </div>
                ` : ''}
              `}
              
              ${comments ? `
                <div class="teacher-comments mb-3">
                  <strong>Teacher Comments:</strong>
                  <div class="answer-content p-2 bg-info bg-opacity-10 rounded mt-1">
                    <p>${comments}</p>
                  </div>
                </div>
              ` : ''}
            </div>
          `;
        });

        reviewHtml += '</div>';
      } else {
        reviewHtml += `
          <div class="alert alert-info">
            <h5>No Questions Available</h5>
            <p>This assignment doesn't have any questions to review.</p>
          </div>
        `;
      }

      reviewHtml += '</div>';

      container.innerHTML = reviewHtml;
      console.log('Review content loaded successfully');
    }

    function searchHomework(e) {
      const term = e.target.value.toLowerCase();
      homework = getPublishedHomework().filter(a =>
        a.title.toLowerCase().includes(term) ||
        a.description.toLowerCase().includes(term) ||
        a.category.toLowerCase().includes(term) ||
        a.difficulty.toLowerCase().includes(term)
      );
      const grid = document.getElementById('homeworkGrid');
      if (homework.length === 0) { grid.innerHTML = `<div class="col-12 text-center py-5"><h4>No assignments found</h4></div>`; return; }
      grid.innerHTML = homework.map(a => `
        <div class="homework-card">
          <div class="homework-card-header"><div class="homework-icon"><iconify-icon icon="material-symbols:assignment"></iconify-icon></div>
          <div><div class="homework-card-title">${a.title}</div><span class="status-badge status-${a.status || 'pending'}">${(a.status || 'pending').toUpperCase()}</span></div></div>
          <div class="homework-card-description">${a.description}</div>
        </div>`).join('');
    }

    function clearSearch() {
      document.getElementById('homeworkSearch').value = '';
      document.getElementById('searchClearBtn').style.display = 'none';
      loadHomework();
    }

    function clearAllFilters() {
      // Reset search
      document.getElementById('homeworkSearch').value = '';
      document.getElementById('searchClearBtn').style.display = 'none';

      // Reset category filter
      currentFilter = 'all';
      document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector('.filter-tab[onclick*="all"]').classList.add('active');

      // Reset sort
      document.getElementById('sortSelect').value = 'deadline-asc';
      document.getElementById('currentSort').textContent = 'Deadline';
      document.getElementById('sortClearBtn').style.display = 'none';

      // Reload homework
      loadHomework();
    }

    function clearAllHomework() {
      if (confirm('Are you sure you want to delete ALL mathematics content (assignments, quizzes, exams)? This action cannot be undone.')) {
        // Clear all mathematics-related content from localStorage
        clearMathematicsContent();

        // Clear the page display
        homework = [];
        document.getElementById('homeworkGrid').innerHTML = '<div class="col-12 text-center py-5"><h4>No assignments found</h4><p class="text-muted">Try adjusting your filters or search terms.</p></div>';

        // Update stats
        updateStats();

        console.log('All mathematics content cleared');
        alert('All mathematics content (assignments, quizzes, exams) has been deleted!');
      }
    }

    function clearMathematicsContent() {
      // Clear physicsAssignments - filter out mathematics assignments
      let physicsAssignments = JSON.parse(localStorage.getItem('physicsAssignments')) || [];
      physicsAssignments = physicsAssignments.filter(a => a.subject !== 'mathematics');
      localStorage.setItem('physicsAssignments', JSON.stringify(physicsAssignments));

      // Clear studentQuizzes - filter out mathematics quizzes
      let studentQuizzes = JSON.parse(localStorage.getItem('studentQuizzes')) || [];
      studentQuizzes = studentQuizzes.filter(q => q.subject !== 'mathematics');
      localStorage.setItem('studentQuizzes', JSON.stringify(studentQuizzes));

      // Clear studentExams - filter out mathematics exams
      let studentExams = JSON.parse(localStorage.getItem('studentExams')) || [];
      studentExams = studentExams.filter(e => e.subject !== 'mathematics');
      localStorage.setItem('studentExams', JSON.stringify(studentExams));

      // Clear physicsTeacherAssignments - filter out mathematics assignments
      let physicsTeacherAssignments = JSON.parse(localStorage.getItem('physicsTeacherAssignments')) || [];
      physicsTeacherAssignments = physicsTeacherAssignments.filter(a => a.subject !== 'mathematics');
      localStorage.setItem('physicsTeacherAssignments', JSON.stringify(physicsTeacherAssignments));

      // Clear teacherQuizzes - filter out mathematics quizzes
      let teacherQuizzes = JSON.parse(localStorage.getItem('teacherQuizzes')) || [];
      teacherQuizzes = teacherQuizzes.filter(q => q.subject !== 'mathematics');
      localStorage.setItem('teacherQuizzes', JSON.stringify(teacherQuizzes));

      // Clear teacherExams - filter out mathematics exams
      let teacherExams = JSON.parse(localStorage.getItem('teacherExams')) || [];
      teacherExams = teacherExams.filter(e => e.subject !== 'mathematics');
      localStorage.setItem('teacherExams', JSON.stringify(teacherExams));

      console.log('Mathematics content cleared from all localStorage keys');
    }

    // Delete all assignments function
    function deleteAllAssignments() {
      if (confirm('⚠️ Are you sure you want to delete ALL assignments? This action cannot be undone!')) {
        if (confirm('This is your last chance. Click OK to permanently delete all assignments.')) {
          // Clear student assignments
          localStorage.removeItem('physicsAssignments');

          // Clear teacher assignments
          localStorage.removeItem('physicsTeacherAssignments');

          // Clear alternative keys
          localStorage.removeItem('physicsAssignmentsList');

          d          // Reload the page to show empty state
          homework = [];
          loadHomework();
          updateStats();

          // Show success message
          alert('✅ All assignments have been deleted successfully!');

          console.log('All assignments deleted');
        }
      }
    }

    // Helper function to update physicsAssessments for consistency
    function updatePhysicsAssessments(assignmentId, updatedAssignment) {
      const physicsAssessments = JSON.parse(localStorage.getItem('physicsAssessments') || '[]');
      const assessmentIndex = physicsAssessments.findIndex(a => a.id === assignmentId);
      if (assessmentIndex !== -1) {
        physicsAssessments[assessmentIndex] = updatedAssignment;
        localStorage.setItem('physicsAssessments', JSON.stringify(physicsAssessments));
      }
    }

  </script>
</body>

</html>